<!doctype html>
<html lang="ru">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Digital Truth</title>
    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --bg: #0b0f14;
            --card: #0f1621;
            --ink: #eaf2ff;
            --muted: #9bb0cc;
            --acc: #53e2ae;
            --warn: #ff7a7a;
            --accent2: #7aa9ff;
            --shadow: rgba(0, 0, 0, .35);
        }

        * {
            box-sizing: border-box
        }

        body {
            margin: 0;
            font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial;
            background: radial-gradient(1200px 700px at 70% -10%, #132033 0%, #0b0f14 45%);
            color: var(--ink);
        }

        header {
            padding: 18px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #1f2a3a;
            backdrop-filter: blur(6px);
            position: sticky;
            top: 0;
            z-index: 5;
            background: linear-gradient(180deg, rgba(15, 22, 33, .9), rgba(15, 22, 33, .6));
        }

        header h1 {
            margin: 0;
            font-size: 18px;
            letter-spacing: .5px
        }

        #rep,
        #caseNo {
            font-size: 14px;
            color: var(--muted)
        }

        main {
            max-width: 980px;
            margin: 24px auto;
            padding: 0 16px 48px
        }

        .panel {
            background: var(--card);
            border: 1px solid #1e2a3b;
            border-radius: 14px;
            box-shadow: 0 10px 30px var(--shadow);
            padding: 18px;
            margin-bottom: 16px;
        }

        .hero {
            display: flex;
            gap: 16px;
            align-items: center
        }

        .hero .badge {
            font-size: 12px;
            color: #0b0f14;
            background: linear-gradient(135deg, var(--acc), #8ef8cd);
            padding: 6px 10px;
            border-radius: 999px;
            font-weight: 600
        }

        .title {
            font-size: 22px;
            margin: 6px 0 2px
        }

        .subtitle {
            font-size: 14px;
            color: var(--muted);
            margin: 0
        }

        .grid {
            display: grid;
            gap: 12px
        }

        @media(min-width:860px) {
            .grid {
                grid-template-columns: 1.1fr 1fr
            }
        }

        .evidence {
            display: grid;
            gap: 10px
        }

        .card {
            background: #0c121b;
            border: 1px solid #1e2a3b;
            border-radius: 12px;
            padding: 12px;
        }

        .meta {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 6px
        }

        .tag {
            font-size: 11px;
            color: var(--muted);
            border: 1px dashed #2a3a55;
            padding: 2px 6px;
            border-radius: 6px
        }

        .text {
            font-size: 15px;
            line-height: 1.45
        }

        .controls {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            flex-wrap: wrap
        }

        button {
            cursor: pointer;
            border: 1px solid #24354d;
            background: #101826;
            color: var(--ink);
            padding: 10px 14px;
            border-radius: 10px;
            font-weight: 600
        }

        button.primary {
            background: linear-gradient(135deg, var(--accent2), #5fe1ff);
            color: #09111c;
            border: none
        }

        button.truth {
            border-color: #2b4;
            background: rgba(83, 226, 174, .1)
        }

        button.lie {
            border-color: #b33;
            background: rgba(255, 122, 122, .1)
        }

        button.ghost {
            background: transparent
        }

        button:disabled {
            opacity: .55;
            cursor: not-allowed
        }

        .choice {
            display: grid;
            gap: 10px
        }

        .choice .opt {
            display: flex;
            gap: 10px;
            align-items: flex-start;
            padding: 12px;
            border: 1px solid #223047;
            border-radius: 10px;
            background: #0c121b
        }

        .opt input {
            transform: translateY(2px)
        }

        .footerRow {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 12px;
            flex-wrap: wrap
        }

        .scoreline {
            font-size: 14px;
            color: var(--muted)
        }

        .toast {
            position: fixed;
            right: 16px;
            bottom: 16px;
            background: #0f1a28;
            border: 1px solid #20324a;
            color: var(--ink);
            padding: 10px 12px;
            border-radius: 10px;
            box-shadow: 0 10px 30px var(--shadow);
            opacity: 0;
            transform: translateY(8px);
            transition: .25s
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0)
        }

        .end {
            text-align: center;
            padding: 24px 16px;
            display: grid;
            gap: 12px;
            place-items: center
        }

        .end h2 {
            margin: 0
        }

        .rank {
            font-size: 13px;
            color: #0b0f14;
            background: linear-gradient(135deg, var(--acc), #c0ffd9);
            padding: 6px 10px;
            border-radius: 999px;
            font-weight: 700
        }

        .kbd {
            font-family: ui-monospace, SFMono-Regular, Menlo, monospace;
            font-size: 12px;
            background: #0b1220;
            padding: 2px 6px;
            border: 1px solid #1e2a3b;
            border-radius: 6px;
            color: var(--muted)
        }

        .opt-radio {
            display: flex;
            gap: 8px;
            align-items: center;
            cursor: pointer;
            font-size: 14px
        }

        .opt-radio input {
            accent-color: var(--acc);
            cursor: pointer;
            margin: 0
        }

        input[type="text"],
        input[type="email"],
        select {
            transition: .2s;
            outline: none
        }

        input[type="text"]:focus,
        input[type="email"]:focus,
        select:focus {
            border-color: var(--acc);
            box-shadow: 0 0 0 2px rgba(83, 226, 174, .1)
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* –î–µ—Ç–µ–∫—Ç–∏–≤ */
        .detective-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 100;
            pointer-events: none;
        }

        .detective-wrapper {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 12px;
        }

        .detective-avatar {
            width: 120px;
            height: 180px;
            background: rgba(15, 22, 33, 0.9);
            border: 2px solid rgba(83, 226, 174, 0.3);
            border-radius: 12px;
            padding: 10px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .detective-avatar svg {
            width: 100%;
            height: 100%;
        }

        .detective-speech {
            max-width: 250px;
            animation: speechFadeIn 0.3s ease;
        }

        @keyframes speechFadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .speech-bubble {
            background: var(--card);
            border: 1px solid #1e2a3b;
            border-radius: 12px;
            padding: 12px 16px;
            position: relative;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .speech-bubble::after {
            content: '';
            position: absolute;
            bottom: -8px;
            right: 30px;
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-top: 8px solid var(--card);
        }

        .speech-bubble p {
            margin: 0;
            font-size: 13px;
            line-height: 1.4;
            color: var(--ink);
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–µ—Ç–µ–∫—Ç–∏–≤–∞ */
        @keyframes detectiveNod {
            0%, 100% { transform: translateY(0) rotate(0deg) scale(1); }
            30% { transform: translateY(-4px) rotate(1deg) scale(1.02); }
            60% { transform: translateY(-2px) rotate(-1deg) scale(1.01); }
        }

        @keyframes detectiveShake {
            0%, 100% { transform: translateX(0) rotate(0deg); }
            20% { transform: translateX(-4px) rotate(-1deg); }
            40% { transform: translateX(4px) rotate(1deg); }
            60% { transform: translateX(-2px) rotate(-0.5deg); }
            80% { transform: translateX(2px) rotate(0.5deg); }
        }

        @keyframes detectiveThink {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-2px) rotate(-2deg); }
            50% { transform: translateY(-4px) rotate(-3deg); }
            75% { transform: translateY(-2px) rotate(-1deg); }
        }

        @keyframes eyeBlink {
            0%, 90%, 100% { transform: scaleY(1); }
            95% { transform: scaleY(0.1); }
        }

        @keyframes subtleBreathe {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-1px); }
        }

        @keyframes tabletScan {
            0% { opacity: 0; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1.1); }
            100% { opacity: 0; transform: scale(0.8); }
        }

        @keyframes tabletGlow {
            0%, 100% { filter: drop-shadow(0 0 5px rgba(83, 226, 174, 0.5)); }
            50% { filter: drop-shadow(0 0 15px rgba(83, 226, 174, 0.9)); }
        }

        .detective-positive {
            animation: detectiveNod 0.8s ease;
        }

        .detective-negative {
            animation: detectiveShake 0.6s ease;
        }

        .detective-thinking {
            animation: detectiveThink 2s ease-in-out infinite;
        }

        /* –ú–æ—Ä–≥–∞–Ω–∏–µ –≥–ª–∞–∑ */
        #detectiveEye1, #detectiveEye2 {
            animation: eyeBlink 4s ease-in-out infinite;
            transform-origin: center;
        }

        #detectiveEye1 {
            animation-delay: 0s;
        }

        #detectiveEye2 {
            animation-delay: 0.1s;
        }

        /* –õ–µ–≥–∫–æ–µ –¥—ã—Ö–∞–Ω–∏–µ */
        #detectiveSvg {
            animation: subtleBreathe 3s ease-in-out infinite;
        }

        .tablet-scanning {
            animation: tabletScan 1.5s ease infinite;
        }

        .tablet-glow {
            animation: tabletGlow 2s ease infinite;
        }

        /* –ü–µ—Ä–µ—Ö–æ–¥ –º–µ–∂–¥—É –∫–µ–π—Å–∞–º–∏ */
        .case-transition {
            position: fixed;
            inset: 0;
            background: rgba(11, 15, 20, 0.95);
            z-index: 200;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 30px;
            animation: transitionFadeIn 0.4s ease;
        }

        @keyframes transitionFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .transition-detective {
            width: 200px;
            height: 300px;
        }

        .transition-text {
            font-size: 24px;
            color: var(--acc);
            font-weight: 600;
            text-align: center;
        }

        .admin-section {
            background: #0c121b;
            border: 1px solid #1e2a3b;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .admin-section h3 {
            margin: 0 0 12px 0;
            font-size: 18px;
            color: #ffc107;
            border-bottom: 1px solid #1e2a3b;
            padding-bottom: 8px;
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
            margin-top: 12px;
            table-layout: auto;
        }

        .admin-table thead {
            background: #0f1621;
        }

        .admin-table th {
            background: #0f1621;
            color: var(--muted);
            text-align: left;
            padding: 8px;
            border-bottom: 1px solid #1e2a3b;
            font-weight: 600;
            font-size: 11px;
            text-transform: uppercase;
            position: sticky;
            top: 0;
        }

        .admin-table td {
            padding: 8px;
            border-bottom: 1px solid #1e2a3b;
            color: var(--ink);
            word-break: break-word;
        }

        .admin-table tr {
            display: table-row;
        }

        .admin-table tr:hover {
            background: rgba(255, 193, 7, .05);
        }

        .admin-stat {
            display: inline-block;
            background: rgba(255, 193, 7, .1);
            border: 1px solid rgba(255, 193, 7, .3);
            padding: 8px 12px;
            border-radius: 8px;
            margin: 4px;
            font-size: 13px;
        }

        .admin-stat strong {
            color: #ffc107;
            display: block;
            font-size: 20px;
            margin-bottom: 4px;
        }

        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 193, 7, .3);
            border-top-color: #ffc107;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
    </style>
</head>

<body>
    <header>
        <h1 id="mainTitle"></h1>
        <div style="display:flex; gap:16px; align-items:center">
            <div id="caseNo"></div>
            <div id="rep"></div>
            <div id="levelBadge" style="display:none; font-size:12px; color:var(--acc); background:rgba(83,226,174,.1); padding:4px 10px; border-radius:8px; border:1px solid rgba(83,226,174,.3)"></div>
            <select id="langToggle"
                style="padding:4px 10px; border-radius:8px; font-size:14px; background:#101826; color:var(--ink); border:1px solid #24354d">
                <option value="ru" id="langRu"></option>
                <option value="kk" id="langKk"></option>
            </select>
        </div>
    </header>

    <main>
        <!-- –≠–∫—Ä–∞–Ω 0: Splash/Hook -->
        <section id="splash" class="panel" style="text-align:center; padding:40px 24px">
            <video id="introVideo" width="100%" height="100vh"
                style="position:fixed; top:0; left:0; width:100vw; height:100vh; object-fit:cover; z-index:10"
                playsinline>
                <source src="1110.mp4" type="video/mp4">
            </video>
            <div id="videoPlayBtn"
                style="position:fixed; top:0; left:0; width:100vw; height:100vh; display:flex; align-items:center; justify-content:center; z-index:11; background:rgba(0,0,0,.3); cursor:pointer">
                <div
                    style="width:100px; height:100px; border-radius:50%; background:rgba(255,255,255,.3); border:3px solid white; display:flex; align-items:center; justify-content:center">
                    <span style="color:white; font-size:50px; margin-left:8px">‚ñ∂</span>
                </div>
            </div>
            <div class="hero" style="justify-content:center; margin-bottom:16px">
                <div class="badge" id="splashBadgeEl"></div>
            </div>
            <h2 class="title" id="splashTitleEl" style="font-size:28px"></h2>
            <p class="subtitle" id="splashSubtitleEl" style="margin-bottom:24px"></p>
            <button class="primary" id="btnOnboard" style="padding:12px 24px; font-size:16px"></button>
        </section>

        <!-- –≠–∫—Ä–∞–Ω 1: –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –∑–∞—á–µ–º -->
        <section id="onboard-welcome" class="panel" style="display:none">
            <h2 class="title" id="onboardWelcomeTitleEl"></h2>
            <div
                style="background:#0c121b; border-left:3px solid var(--acc); padding:12px 14px; border-radius:6px; margin:16px 0; line-height:1.6; font-size:15px">
                <p style="margin:6px 0" id="onboardText1El"></p>
                <p style="margin:6px 0" id="onboardText2El"></p>
                <p style="margin:6px 0" id="onboardText3El"></p>
            </div>
            <div class="footerRow" style="justify-content:flex-start">
                <button class="primary" id="btnFormStart"></button>
            </div>
        </section>

        <!-- –≠–∫—Ä–∞–Ω 2: –§–æ—Ä–º–∞ "–ü–∞—Å–ø–æ—Ä—Ç –∞–≥–µ–Ω—Ç–∞" -->
        <section id="onboard-form" class="panel" style="display:none">
            <h2 class="title" id="formTitleEl"></h2>
            <p style="color:var(--muted); font-size:14px; margin-bottom:16px" id="formProgressEl"></p>
            <form id="agentForm" style="display:grid; gap:14px">
                <!-- –ü–æ–∑—ã–≤–Ω–æ–π -->
                <div>
                    <label style="display:block; font-weight:600; margin-bottom:6px">
                        <span id="formCallsignEl"></span> <span style="color:var(--warn)">*</span>
                    </label>
                    <input type="text" id="callsign" maxlength="32"
                        style="width:100%; padding:10px 12px; background:#0c121b; border:1px solid #223047; border-radius:10px; color:var(--ink); font-size:14px">
                    <small style="color:var(--muted); font-size:12px; margin-top:4px; display:block"
                        id="formCallsignSmallEl"></small>
                </div>

                <!-- –ü–æ–ª -->
                <div>
                    <label style="display:block; font-weight:600; margin-bottom:8px">
                        <span id="formGenderEl"></span> <span style="color:var(--warn)">*</span>
                        <span style="color:var(--muted); font-weight:400; font-size:12px" id="formGenderNoteEl"></span>
                    </label>
                    <div style="display:grid; gap:6px">
                        <label class="opt-radio"><input type="radio" name="gender" value="female" required> <span
                                id="genderFemaleEl"></span></label>
                        <label class="opt-radio"><input type="radio" name="gender" value="male" required> <span
                                id="genderMaleEl"></span></label>
                        <label class="opt-radio"><input type="radio" name="gender" value="nonbinary" required> <span
                                id="genderNonbinaryEl"></span></label>
                        <label class="opt-radio"><input type="radio" name="gender" value="skip" required> <span
                                id="genderSkipEl"></span></label>
                        <label class="opt-radio" style="position:relative">
                            <input type="radio" name="gender" value="other" required> <span
                                id="genderOtherLabelEl"></span>
                            <input type="text" id="genderOther" maxlength="20"
                                style="margin-left:24px; padding:6px 8px; width:150px; background:#0c121b; border:1px solid #223047; border-radius:6px; color:var(--ink); font-size:12px; display:none">
                        </label>
                    </div>
                </div>

                <!-- –í–æ–∑—Ä–∞—Å—Ç -->
                <div>
                    <label style="display:block; font-weight:600; margin-bottom:8px">
                        <span id="formAgeEl"></span> <span style="color:var(--warn)">*</span>
                    </label>
                    <div style="display:grid; gap:6px">
                        <label class="opt-radio"><input type="radio" name="age" value="under18" required> <span
                                id="ageUnder18El"></span></label>
                        <label class="opt-radio"><input type="radio" name="age" value="18-25" required> <span
                                id="age18_25El"></span></label>
                        <label class="opt-radio"><input type="radio" name="age" value="26-35" required> <span
                                id="age26_35El"></span></label>
                        <label class="opt-radio"><input type="radio" name="age" value="36-45" required> <span
                                id="age36_45El"></span></label>
                        <label class="opt-radio"><input type="radio" name="age" value="46plus" required> <span
                                id="age46plusEl"></span></label>
                    </div>
                </div>

                <!-- –†–µ–≥–∏–æ–Ω -->
                <div>
                    <label style="display:block; font-weight:600; margin-bottom:6px">
                        <span id="formRegionEl"></span> <span style="color:var(--warn)">*</span>
                    </label>
                    <select id="region" required
                        style="width:100%; padding:10px 12px; background:#0c121b; border:1px solid #223047; border-radius:10px; color:var(--ink); font-size:14px">
                        <option value="">‚Äî</option>
                        <option value="nur-sultan" id="regionNurSultanEl"></option>
                        <option value="almaty" id="regionAlmatyEl"></option>
                        <option value="shymkent" id="regionShymkentEl"></option>
                        <option value="karaganda" id="regionKaragandaEl"></option>
                        <option value="aktobe" id="regionAktobeEl"></option>
                        <option value="kostanay" id="regionKostanayEl"></option>
                        <option value="aktau" id="regionAktauEl"></option>
                        <option value="atyrau" id="regionAtyauEl"></option>
                        <option value="pavlodar" id="regionPavlodarEl"></option>
                        <option value="ekibastuz" id="regionEkibastuzEl"></option>
                        <option value="petropavlovsk" id="regionPetropavlovskEl"></option>
                        <option value="oral" id="regionOralEl"></option>
                        <option value="kokshetau" id="regionKokshetauEl"></option>
                        <option value="semey" id="regionSemeyEl"></option>
                        <option value="oskemen" id="regionOskemenEl"></option>
                        <option value="kyzylorda" id="regionKyzylordaEl"></option>
                        <option value="taraz" id="regionTarazEl"></option>
                        <option value="taldykorgan" id="regionTaldykorganEl"></option>
                        <option value="turkestan" id="regionTurkestanEl"></option>
                        <option value="zhanaozen" id="regionZhanaoenEl"></option>
                        <option value="zhezkazgan" id="regionZhezkazganEl"></option>
                        <option value="karatau" id="regionKaratauEl"></option>
                    </select>
                </div>


                <div class="footerRow" style="margin-top:20px; justify-content:space-between">
                    <button type="button" class="ghost" id="btnFormBack"></button>
                    <button type="button" class="primary" id="btnFormNext"></button>
                </div>
            </form>
        </section>

        <!-- –≠–∫—Ä–∞–Ω 3: –°–æ–≥–ª–∞—Å–∏–µ -->
        <section id="onboard-consent" class="panel" style="display:none">
            <h2 class="title" id="consentTitleEl"></h2>
            <p style="color:var(--muted); font-size:14px; margin-bottom:16px" id="consentProgressEl"></p>

            <!-- –†–µ–∑—é–º–µ -->
            <div
                style="background:#0c121b; border:1px solid #223047; border-radius:10px; padding:12px; margin-bottom:16px">
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px; font-size:13px">
                    <div><span style="color:var(--muted)" id="summaryCallsignLabelEl"></span> <span
                            id="summaryCallsign">‚Äî</span></div>
                    <div><span style="color:var(--muted)" id="summaryGenderLabelEl"></span> <span
                            id="summaryGender">‚Äî</span></div>
                    <div><span style="color:var(--muted)" id="summaryAgeLabelEl"></span> <span id="summaryAge">‚Äî</span>
                    </div>
                    <div><span style="color:var(--muted)" id="summaryRegionLabelEl"></span> <span
                            id="summaryRegion">‚Äî</span></div>
                </div>
            </div>

            <!-- –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö -->
            <div
                style="background:rgba(83,226,174,.05); border-left:3px solid var(--acc); padding:12px; border-radius:6px; margin-bottom:16px">
                <p style="margin:0; font-size:14px; line-height:1.5" id="consentExplainEl"></p>
            </div>

            <!-- –ß–µ–∫–±–æ–∫—Å—ã —Å–æ–≥–ª–∞—Å–∏—è -->
            <form id="consentForm" style="display:grid; gap:10px; margin-bottom:16px">
                <label style="display:flex; gap:10px; align-items:flex-start; cursor:pointer">
                    <input type="checkbox" id="consentData" style="margin-top:3px">
                    <span style="font-size:14px; line-height:1.4" id="consentDataTextEl"></span>
                </label>
                <label style="display:flex; gap:10px; align-items:flex-start; cursor:pointer">
                    <input type="checkbox" id="consentAge" style="margin-top:3px">
                    <span style="font-size:14px; line-height:1.4" id="consentAgeTextEl"></span>
                </label>
            </form>

            <!-- –õ–∏–Ω–∫ "–ü–æ–¥—Ä–æ–±–Ω–µ–µ" -->
            <p style="text-align:center; margin:12px 0">
                <button type="button" class="ghost" id="btnMoreInfo" style="text-decoration:underline; padding:0"
                    id="btnMoreInfoText"></button>
            </p>

            <div class="footerRow" style="justify-content:space-between; margin-top:20px">
                <button type="button" class="ghost" id="btnConsentBack"></button>
                <button type="button" class="primary" id="btnActivate" disabled></button>
            </div>
        </section>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ "–ü–æ–¥—Ä–æ–±–Ω–µ–µ" -->
        <div id="infoModal"
            style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.7); z-index:100; overflow:auto; padding:20px">
            <div
                style="background:var(--card); border:1px solid #1e2a3b; border-radius:14px; max-width:500px; margin:40px auto; padding:20px">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px">
                    <h3 style="margin:0" id="modalTitleEl"></h3>
                    <button type="button" class="ghost" id="btnCloseModal"
                        style="padding:4px 8px; font-size:16px">√ó</button>
                </div>
                <div style="font-size:13px; line-height:1.6; color:var(--ink)" id="modalContentEl"></div>
                <div class="footerRow" style="justify-content:center; margin-top:16px">
                    <button type="button" class="primary" id="btnCloseInfo"></button>
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ "–ê–¥–º–∏–Ω –ê–Ω–∞–ª–∏—Ç–∏–∫–∞" -->
        <div id="adminModal"
            style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.85); z-index:200; overflow:auto; padding:20px">
            <div
                style="background:var(--card); border:1px solid #1e2a3b; border-radius:14px; max-width:1200px; margin:20px auto; padding:24px; max-height:90vh; overflow-y:auto">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px">
                    <h2 style="margin:0; color:#ffc107">üìä –ê–¥–º–∏–Ω –ü–∞–Ω–µ–ª—å - –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h2>
                    <button type="button" class="ghost" id="btnCloseAdminModal"
                        style="padding:8px 12px; font-size:18px; color:var(--muted)">√ó</button>
                </div>
                <div id="adminContent" style="display:grid; gap:20px">
                    <div style="text-align:center; padding:20px; color:var(--muted)">
                        <div class="spinner" style="display:inline-block; width:40px; height:40px; border:4px solid rgba(255,193,7,.3); border-top-color:#ffc107; border-radius:50%; animation:spin 1s linear infinite"></div>
                        <p style="margin-top:12px">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω (–ø–æ—Å–ª–µ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞) -->
        <section id="start" class="panel" style="display:none">
            <div class="hero">
                <div class="badge" id="startBadgeEl"></div>
            </div>
            <h2 class="title" id="startTitleEl"></h2>
            <p class="subtitle" id="startSubtitleEl"></p>
            <div class="footerRow" style="justify-content:flex-start; margin-top:16px">
                <button class="primary" id="btnStart"></button>
                <button class="ghost" id="btnHow"></button>
                <button class="ghost" id="btnAdminAnalytics" style="display:none; background:rgba(255,193,7,.1); border-color:#ffc107; color:#ffc107">üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</button>
            </div>
        </section>

        <!-- –≠–∫—Ä–∞–Ω –¥–µ–ª–∞ -->
        <section id="case" class="grid" style="display:none">
            <!-- –î–µ—Ç–µ–∫—Ç–∏–≤ -->
            <div id="detectiveContainer" class="detective-panel" style="display:none">
                <div class="detective-wrapper">
                    <div id="detectiveAvatar" class="detective-avatar">
                        <svg id="detectiveSvg" viewBox="0 0 200 300" xmlns="http://www.w3.org/2000/svg">
                            <defs>
                                <!-- –ì—Ä–∞–¥–∏–µ–Ω—Ç—ã –¥–ª—è –æ–±—ä–µ–º–∞ -->
                                <linearGradient id="skinGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                    <stop offset="0%" style="stop-color:#e8c5a0;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#d4a574;stop-opacity:1" />
                                </linearGradient>
                                <linearGradient id="jacketGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                    <stop offset="0%" style="stop-color:#2a3a5a;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#1a1f3a;stop-opacity:1" />
                                </linearGradient>
                                <linearGradient id="shirtGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                    <stop offset="0%" style="stop-color:#f5f5f5;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#e8e8e8;stop-opacity:1" />
                                </linearGradient>
                                <radialGradient id="eyeGradient" cx="50%" cy="30%">
                                    <stop offset="0%" style="stop-color:#ffffff;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#1a1a1a;stop-opacity:1" />
                                </radialGradient>
                            </defs>
                            
                            <!-- –ù–æ–≥–∏ (—Å–Ω–∞—á–∞–ª–∞, —á—Ç–æ–±—ã –±—ã–ª–∏ –ø–æ–∑–∞–¥–∏) -->
                            <rect x="75" y="200" width="18" height="55" rx="8" fill="#0a0a0a" opacity="0.9"/>
                            <rect x="107" y="200" width="18" height="55" rx="8" fill="#0a0a0a" opacity="0.9"/>
                            <ellipse cx="84" cy="255" rx="9" ry="4" fill="#1a1a1a"/>
                            <ellipse cx="116" cy="255" rx="9" ry="4" fill="#1a1a1a"/>
                            
                            <!-- –¢–µ–ª–æ (–ø–∏–¥–∂–∞–∫) -->
                            <rect x="68" y="110" width="64" height="95" rx="8" fill="url(#jacketGradient)" stroke="#2a3a5a" stroke-width="1.5"/>
                            <!-- –¢–µ–Ω—å –Ω–∞ –ø–∏–¥–∂–∞–∫–µ -->
                            <rect x="68" y="110" width="64" height="20" rx="8" fill="#1a1f3a" opacity="0.3"/>
                            
                            <!-- –†—É–±–∞—à–∫–∞ -->
                            <rect x="72" y="115" width="56" height="80" rx="4" fill="url(#shirtGradient)"/>
                            <!-- –í–æ—Ä–æ—Ç–Ω–∏–∫ -->
                            <path d="M 72 115 L 100 125 L 128 115" stroke="#d0d0d0" stroke-width="1.5" fill="none"/>
                            <!-- –ü—É–≥–æ–≤–∏—Ü—ã -->
                            <circle cx="100" cy="140" r="1.5" fill="#c0c0c0"/>
                            <circle cx="100" cy="155" r="1.5" fill="#c0c0c0"/>
                            <circle cx="100" cy="170" r="1.5" fill="#c0c0c0"/>
                            
                            <!-- –†—É–∫–∏ -->
                            <ellipse cx="60" cy="125" rx="8" ry="12" fill="url(#skinGradient)"/>
                            <rect x="55" y="125" width="12" height="65" rx="6" fill="url(#skinGradient)"/>
                            <ellipse cx="140" cy="125" rx="8" ry="12" fill="url(#skinGradient)"/>
                            <rect x="133" y="125" width="12" height="65" rx="6" fill="url(#skinGradient)"/>
                            <!-- –ö–∏—Å—Ç–∏ —Ä—É–∫ -->
                            <ellipse cx="61" cy="190" rx="6" ry="8" fill="url(#skinGradient)"/>
                            <ellipse cx="139" cy="190" rx="6" ry="8" fill="url(#skinGradient)"/>
                            
                            <!-- –ü–ª–∞–Ω—à–µ—Ç -->
                            <rect id="detectiveTablet" x="82" y="135" width="36" height="48" rx="4" fill="#0a0f1a" stroke="#53e2ae" stroke-width="2" opacity="0.95"/>
                            <!-- –≠–∫—Ä–∞–Ω –ø–ª–∞–Ω—à–µ—Ç–∞ -->
                            <rect x="85" y="138" width="30" height="42" rx="2" fill="#1a2a3a" opacity="0.8"/>
                            <!-- –°–∫–∞–Ω–∏—Ä—É—é—â–∏–µ –ª–∏–Ω–∏–∏ -->
                            <line id="tabletScan1" x1="100" y1="145" x2="100" y2="175" stroke="#53e2ae" stroke-width="2" opacity="0" stroke-linecap="round">
                                <animate attributeName="opacity" values="0;0.8;0" dur="1.5s" repeatCount="indefinite"/>
                            </line>
                            <line id="tabletScan2" x1="88" y1="160" x2="112" y2="160" stroke="#53e2ae" stroke-width="2" opacity="0" stroke-linecap="round">
                                <animate attributeName="opacity" values="0;0.8;0" dur="1.5s" repeatCount="indefinite" begin="0.5s"/>
                            </line>
                            <!-- –ò–∫–æ–Ω–∫–∏ –Ω–∞ –ø–ª–∞–Ω—à–µ—Ç–µ -->
                            <circle cx="92" cy="152" r="2" fill="#53e2ae" opacity="0.6"/>
                            <circle cx="108" cy="152" r="2" fill="#53e2ae" opacity="0.6"/>
                            
                            <!-- –ì–æ–ª–æ–≤–∞ -->
                            <ellipse cx="100" cy="75" rx="38" ry="42" fill="url(#skinGradient)" stroke="#b8956a" stroke-width="1.5"/>
                            <!-- –¢–µ–Ω—å –Ω–∞ –ª–∏—Ü–µ -->
                            <ellipse cx="100" cy="85" rx="30" ry="25" fill="#c9a882" opacity="0.3"/>
                            
                            <!-- –í–æ–ª–æ—Å—ã -->
                            <path d="M 65 50 Q 70 45 75 50 Q 80 48 85 52 Q 90 50 95 54 Q 100 52 105 54 Q 110 50 115 52 Q 120 48 125 50 Q 130 45 135 50 L 135 65 Q 130 70 125 68 Q 120 70 115 68 Q 110 70 105 68 Q 100 70 95 68 Q 90 70 85 68 Q 80 70 75 68 Q 70 70 65 65 Z" 
                                  fill="#3a2a1a" opacity="0.9"/>
                            <!-- –ë–ª–∏–∫–∏ –Ω–∞ –≤–æ–ª–æ—Å–∞—Ö -->
                            <path d="M 75 55 Q 85 52 95 56 Q 105 54 115 56" stroke="#5a4a3a" stroke-width="1" fill="none" opacity="0.5"/>
                            
                            <!-- –ë—Ä–æ–≤–∏ -->
                            <path id="detectiveBrow1" d="M 85 68 Q 90 66 95 68" stroke="#2a1a0a" stroke-width="2.5" fill="none" stroke-linecap="round"/>
                            <path id="detectiveBrow2" d="M 105 68 Q 110 66 115 68" stroke="#2a1a0a" stroke-width="2.5" fill="none" stroke-linecap="round"/>
                            
                            <!-- –ì–ª–∞–∑–∞ -->
                            <ellipse id="detectiveEye1" cx="90" cy="76" rx="5" ry="6" fill="url(#eyeGradient)"/>
                            <ellipse id="detectiveEye2" cx="110" cy="76" rx="5" ry="6" fill="url(#eyeGradient)"/>
                            <!-- –ó—Ä–∞—á–∫–∏ -->
                            <circle id="detectivePupil1" cx="90" cy="76" r="2.5" fill="#1a1a1a"/>
                            <circle id="detectivePupil2" cx="110" cy="76" r="2.5" fill="#1a1a1a"/>
                            <!-- –ë–ª–∏–∫–∏ –≤ –≥–ª–∞–∑–∞—Ö -->
                            <circle cx="91" cy="75" r="1" fill="#ffffff" opacity="0.8"/>
                            <circle cx="111" cy="75" r="1" fill="#ffffff" opacity="0.8"/>
                            
                            <!-- –ù–æ—Å -->
                            <path d="M 100 80 Q 98 85 100 88 Q 102 85 100 80" stroke="#b8956a" stroke-width="1.5" fill="none" opacity="0.6"/>
                            <ellipse cx="98" cy="84" rx="1.5" ry="2" fill="#c9a882" opacity="0.4"/>
                            <ellipse cx="102" cy="84" rx="1.5" ry="2" fill="#c9a882" opacity="0.4"/>
                            
                            <!-- –†–æ—Ç -->
                            <path id="detectiveMouth" d="M 92 88 Q 100 91 108 88" stroke="#1a1a1a" stroke-width="2" fill="none" stroke-linecap="round"/>
                            
                            <!-- –©–µ—Ç–∏–Ω–∞ (–ª–µ–≥–∫–∞—è) -->
                            <circle cx="88" cy="92" r="1" fill="#9a8a7a" opacity="0.3"/>
                            <circle cx="95" cy="94" r="1" fill="#9a8a7a" opacity="0.3"/>
                            <circle cx="105" cy="94" r="1" fill="#9a8a7a" opacity="0.3"/>
                            <circle cx="112" cy="92" r="1" fill="#9a8a7a" opacity="0.3"/>
                            
                            <!-- –£–º–Ω—ã–µ —á–∞—Å—ã –Ω–∞ —Ä—É–∫–µ -->
                            <ellipse cx="139" cy="145" rx="6" ry="8" fill="#1a1a1a" stroke="#53e2ae" stroke-width="1"/>
                            <rect x="136" y="142" width="6" height="6" rx="1" fill="#0a0f1a"/>
                            <line x1="138" y1="144" x2="140" y2="146" stroke="#53e2ae" stroke-width="0.5"/>
                        </svg>
                    </div>
                    <div id="detectiveSpeech" class="detective-speech" style="display:none">
                        <div class="speech-bubble">
                            <p id="detectiveText"></p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="panel">
                <div class="meta">
                    <span class="tag" id="caseTag"></span>
                    <span class="tag" id="caseDifficulty"></span>
                </div>
                <h3 class="title" id="caseTitle"></h3>
                <p class="subtitle" id="caseNarrative"></p>

                <h4 style="margin:12px 0 8px" id="caseEvidenceTitleEl"></h4>
                <div class="evidence" id="evList"></div>

                <div class="footerRow">
                    <span class="scoreline" id="evScore"></span>
                </div>
            </div>

            <div class="panel">
                <h4 style="margin:8px 0" id="caseDecisionTitleEl"></h4>
                <div class="choice" id="choiceBox"></div>
                <div class="footerRow">
                    <button id="btnCheck" class="primary" disabled></button>
                    <button id="btnSkip" class=""></button>
                </div>
                <div style="margin-top:8px; font-size:13px; color:var(--muted)" id="caseTipEl"></div>
            </div>
        </section>

        <!-- –§–∏–Ω–∞–ª -->
        <section id="end" class="panel end" style="display:none">
            <div class="rank" id="rank"></div>
            <h2 id="endTitle"></h2>
            <p id="endText" style="white-space:pre-line; line-height:1.6"></p>
            <div class="footerRow" style="justify-content:center">
                <button class="primary" id="btnRestart"></button>
                <button id="btnShare"></button>
            </div>
        </section>
    </main>

    <div id="toast" class="toast"></div>

    <script>
        /** ======== SUPABASE CONFIGURATION ======== */
        // ‚ö†Ô∏è –í–ê–ñ–ù–û: –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ –≤–∞—à–∏ —Ä–µ–∞–ª—å–Ω—ã–µ –∏–∑ Supabase Dashboard
        const SUPABASE_URL = 'https://oilktmiqbqeopdddrgwm.supabase.co'; // –ù–∞–ø—Ä–∏–º–µ—Ä: 'https://xxxxx.supabase.co'
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9pbGt0bWlxYnFlb3BkZGRyZ3dtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ1NzY1NjUsImV4cCI6MjA4MDE1MjU2NX0.0D9pggpIuQZH5j60tkVmFG_64MczKIUjkEm7eq9LI6U'; // –í–∞—à –ø—É–±–ª–∏—á–Ω—ã–π anon key

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Supabase –∫–ª–∏–µ–Ω—Ç–∞
        let supabase = null;
        if (SUPABASE_URL !== 'YOUR_SUPABASE_URL' && SUPABASE_ANON_KEY !== 'YOUR_SUPABASE_ANON_KEY') {
            try {
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                console.log('‚úÖ Supabase –∫–ª–∏–µ–Ω—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω:', SUPABASE_URL);
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Supabase:', error);
            }
        } else {
            console.warn('‚ö†Ô∏è Supabase –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω. –£–∫–∞–∂–∏—Ç–µ SUPABASE_URL –∏ SUPABASE_ANON_KEY –≤ –∫–æ–¥–µ.');
        }

        /** ======== LEVEL SYSTEM ======== */
        // –§—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ —É—Ä–æ–≤–Ω—è –ø–æ —Ä–µ–ø—É—Ç–∞—Ü–∏–∏ (–∞–Ω–∞–ª–æ–≥ SQL —Ñ—É–Ω–∫—Ü–∏–∏ calculate_level)
        function calculateLevel(reputation) {
            let levelNum, levelRu, levelKz, praiseRu, praiseKz;
            
            if (reputation >= 17) {
                levelNum = 5;
                levelRu = '–ê—Ä–±–∏—Ç—Ä –∏—Å—Ç–∏–Ω—ã';
                levelKz = '–ê“õ–∏“õ–∞—Ç –∞—Ä–±–∏—Ç—Ä—ñ';
                praiseRu = '–¢—ã –æ–≥—Ä–æ–º–Ω—ã–π –º–æ–ª–æ–¥–µ—Ü! –¢—ã ‚Äî —ç—Ç–∞–ª–æ–Ω –∫–∞—á–µ—Å—Ç–≤–∞ –∏ —á–µ–ª–æ–≤–µ–∫, –∫–æ—Ç–æ—Ä—ã–π –¥–µ–ª–∞–µ—Ç –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ —á–µ—Å—Ç–Ω–µ–µ. –ú—ã –±—É–¥–µ–º –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —É–ª—É—á—à–∞—Ç—å –ª–æ–≥–∏–∫—É, —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã –∏ –ø–æ–¥—Ö–æ–¥ ‚Äî –≤–º–µ—Å—Ç–µ —Å —Ç–æ–±–æ–π.';
                praiseKz = '–¢–∞–º–∞—à–∞ –∂“±–º—ã—Å! –°–µ–Ω ‚Äî –∞“õ–ø–∞—Ä–∞—Ç—Ç—ã“õ –∫–µ“£—ñ—Å—Ç—ñ–∫—Ç—ñ —Ç–∞–∑–∞ “±—Å—Ç–∞–π—Ç—ã–Ω –Ω–µ–≥—ñ–∑–≥—ñ —Ç“±–ª“ì–∞—Å—ã“£. –ë—ñ–∑ –±“±–ª –∂“Ø–π–µ–Ω—ñ —Å–µ–Ω—ñ“£ –¥–µ“£–≥–µ–π—ñ“£–µ —Å–∞–π –æ–¥–∞–Ω ”ô—Ä—ñ –∫“Ø—à–µ–π—Ç–µ –±–µ—Ä–µ–º—ñ–∑.';
            } else if (reputation >= 13) {
                levelNum = 4;
                levelRu = '–í–µ–¥—É—â–∏–π —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –ø—Ä–æ–≤–µ—Ä–∫–µ —Ñ–∞–∫—Ç–æ–≤';
                levelKz = '–§–∞–∫—Ç—ñ–Ω—ñ —Ç–µ–∫—Å–µ—Ä—É–¥—ñ“£ –∂–µ—Ç–µ–∫—à—ñ —Å–∞—Ä–∞–ø—à—ã—Å—ã';
                praiseRu = '–¢—ã –º–æ—â–Ω—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç! –¢—ã —É–∂–µ –≤–ª–∏—è–µ—à—å –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–æ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã –∏ –∑–∞–¥–∞—ë—à—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç —Ç–æ—á–Ω–æ—Å—Ç–∏. –î–∞–ª—å—à–µ ‚Äî —É—Ä–æ–≤–µ–Ω—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–æ–≥–æ –º—ã—à–ª–µ–Ω–∏—è.';
                praiseKz = '”®—Ç–µ –º—ã“õ—Ç—ã –º–∞–º–∞–Ω—Å—ã“£! –°–µ–Ω –∂“Ø–π–µ–Ω—ñ“£ —Å–∞–ø–∞—Å—ã–Ω–∞ –Ω–∞“õ—Ç—ã ”ô—Å–µ—Ä –µ—Ç—ñ–ø –æ—Ç—ã—Ä—Å—ã“£. –ê–ª–¥–∞ ‚Äî —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–ª—ã“õ –æ–π–ª–∞—É –¥–µ“£–≥–µ–π—ñ.';
            } else if (reputation >= 9) {
                levelNum = 3;
                levelRu = '–§–∞–∫—Ç—á–µ–∫–µ—Ä';
                levelKz = '–§–∞–∫—Ç—á–µ–∫–µ—Ä';
                praiseRu = '–¢—ã –¥–µ–ª–∞–µ—à—å —ç—Ç–æ –æ—Ç–ª–∏—á–Ω–æ! –ò–¥—ë—à—å —É–≤–µ—Ä–µ–Ω–Ω–æ–π —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–µ–π –≤–≤–µ—Ä—Ö. –°–∏—Å—Ç–µ–º–∞ –≤–∏–¥–∏—Ç —Ç–≤–æ–π –≤–∫–ª–∞–¥, –∏ –æ–Ω —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤—Å—ë –±–æ–ª–µ–µ –∑–Ω–∞—á–∏–º—ã–º.';
                praiseKz = '”®—Ç–µ –∂–∞“õ—Å—ã –¥–µ“£–≥–µ–π! –°–µ–Ω—ñ“£ —ã“õ–ø–∞–ª—ã“£ –∞—Ä—Ç—ã–ø –∂–∞—Ç—ã—Ä, –∂“±–º—ã—Å—ã“£ –∞–π“õ—ã–Ω –∫”©—Ä—ñ–Ω–µ–¥—ñ. ”ò—Ä—ñ “õ–∞—Ä–∞–π ‚Äî –æ–¥–∞–Ω –¥–∞ –∂–æ“ì–∞—Ä—ã –∂–∞—É–∞–ø–∫–µ—Ä—à—ñ–ª—ñ–∫ –ø–µ–Ω —Å–µ–Ω—ñ–º.';
            } else if (reputation >= 5) {
                levelNum = 2;
                levelRu = '–ú–ª–∞–¥—à–∏–π –∞–Ω–∞–ª–∏—Ç–∏–∫ —Ñ–∞–∫—Ç–æ–≤';
                levelKz = '–§–∞–∫—Ç—ñ–Ω—ñ —Ç–∞–ª–¥–∞—É–¥—ã“£ –∂–∞—Å –∞–Ω–∞–ª–∏—Ç–∏–≥—ñ';
                praiseRu = '–°—É–ø–µ—Ä —Ä–∞–±–æ—Ç–∞! –¢—ã —É–≤–µ—Ä–µ–Ω–Ω–æ –Ω–∞–±–∏—Ä–∞–µ—à—å —Ç–µ–º–ø. –î–∞–ª–µ–µ –±—É–¥–µ—Ç —Å–ª–æ–∂–Ω–µ–µ ‚Äî –Ω–æ –∏ –≥–æ—Ä–∞–∑–¥–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–µ–µ.';
                praiseKz = '–ö–µ—Ä–µ–º–µ—Ç –Ω”ô—Ç–∏–∂–µ! “ö–∞—Ä“õ—ã–Ω—ã“£ –∂–∞“õ—Å—ã, —Å–µ–Ω —Ç“±—Ä–∞“õ—Ç—ã ”©—Å—É–¥–µ—Å—ñ“£. –ê–ª–¥–∞ –∫“Ø—Ä–¥–µ–ª—ñ—Ä–µ–∫ —Ç–∞–ø—Å—ã—Ä–º–∞–ª–∞—Ä –±–∞—Ä ‚Äî –±—ñ—Ä–∞“õ —Å–µ–Ω –æ“ì–∞–Ω –¥–∞–π—ã–Ω—Å—ã“£.';
            } else {
                levelNum = 1;
                levelRu = '–ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å –∏–Ω—Ñ–æ–ø–æ–ª—è';
                levelKz = '–ê“õ–ø–∞—Ä–∞—Ç –∞–ª–∞“£—ã–Ω –±–∞“õ—ã–ª–∞—É—à—ã';
                praiseRu = '–¢—ã –º–æ–ª–æ–¥–µ—Ü! –°–∞–º–æ–µ –≥–ª–∞–≤–Ω–æ–µ ‚Äî —Ç—ã –≤ –¥–≤–∏–∂–µ–Ω–∏–∏. –≠—Ç–æ –±–∞–∑–∞, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π —Å—Ç—Ä–æ–∏—Ç—Å—è –Ω–∞—Å—Ç–æ—è—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å. –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º ‚Äî —à–∞–≥ –∑–∞ —à–∞–≥–æ–º —Ç—ã —Å—Ç–∞–Ω–µ—à—å —Ç–æ—á–Ω–µ–µ, –±—ã—Å—Ç—Ä–µ–µ –∏ —É–≤–µ—Ä–µ–Ω–Ω–µ–µ.';
                praiseKz = '–ñ–∞—Ä–∞–π—Å—ã“£! –ï“£ –º–∞“£—ã–∑–¥—ã—Å—ã ‚Äî —Å–µ–Ω “õ–æ–∑“ì–∞–ª—ã—Å—Ç–∞—Å—ã“£. –û—Å—ã –±–µ—Ä—ñ–∫ –Ω–µ–≥—ñ–∑ –±–æ–ª–∞—à–∞“õ—Ç–∞ “Ø–ª–∫–µ–Ω –Ω”ô—Ç–∏–∂–µ–≥–µ –∂–µ—Ç–∫—ñ–∑–µ–¥—ñ. –ê–ª“ì–∞ “õ–∞—Ä–∞–π –±—ñ—Ä—Ç—ñ–Ω–¥–µ–ø –¥”ô–ª–¥—ñ–≥—ñ“£ –¥–µ, —Å–µ–Ω—ñ–º–¥—ñ–ª—ñ–≥—ñ“£ –¥–µ –∞—Ä—Ç–∞ –±–µ—Ä–µ–¥—ñ.';
            }
            
            return {
                level: levelNum,
                title_ru: levelRu,
                title_kz: levelKz,
                praise_ru: praiseRu,
                praise_kz: praiseKz
            };
        }

        /** ======== SUPABASE FUNCTIONS ======== */
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞
        async function saveAgentDataToSupabase(agentData) {
            if (!supabase) {
                console.warn('Supabase –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º localStorage');
                localStorage.setItem("agentData", JSON.stringify(agentData));
                return { success: true, fallback: true };
            }

            try {
                const existingAgentId = localStorage.getItem("agentId");
                
                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å (—Ä–µ–ø—É—Ç–∞—Ü–∏—è = 0)
                const initialLevel = calculateLevel(0);
                
                const dataToSave = {
                    callsign: agentData.callsign,
                    gender: agentData.gender,
                    age: agentData.age,
                    region: agentData.region,
                    gender_other: agentData.gender === 'other' ? document.getElementById("genderOther")?.value : null,
                    completed_at: new Date().toISOString(),
                    updated_at: new Date().toISOString()
                };

                let data, error;

                if (existingAgentId) {
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∞–≥–µ–Ω—Ç–∞
                    console.log('–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∞–≥–µ–Ω—Ç–∞:', existingAgentId);
                    const result = await supabase
                        .from('agents')
                        .update(dataToSave)
                        .eq('id', existingAgentId)
                        .select()
                        .single();
                    data = result.data;
                    error = result.error;
                } else {
                    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ —Å –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ —É—Ä–æ–≤–Ω—è
                    console.log('–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∞–≥–µ–Ω—Ç–∞');
                    dataToSave.created_at = new Date().toISOString();
                    dataToSave.total_reputation = 0;
                    dataToSave.current_level = initialLevel.level;
                    dataToSave.level_title_ru = initialLevel.title_ru;
                    dataToSave.level_title_kz = initialLevel.title_kz;
                    dataToSave.total_games_completed = 0;
                    const result = await supabase
                        .from('agents')
                        .insert([dataToSave])
                        .select()
                        .single();
                    data = result.data;
                    error = result.error;
                }

                if (error) throw error;

                // –°–æ—Ö—Ä–∞–Ω—è–µ–º ID –∞–≥–µ–Ω—Ç–∞
                if (data && data.id) {
                    localStorage.setItem("agentId", data.id);
                    console.log('Agent ID —Å–æ—Ö—Ä–∞–Ω–µ–Ω:', data.id);
                }

                // –¢–∞–∫–∂–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage –¥–ª—è –æ—Ñ–ª–∞–π–Ω-–¥–æ—Å—Ç—É–ø–∞
                localStorage.setItem("agentData", JSON.stringify(agentData));

                console.log('–î–∞–Ω–Ω—ã–µ –∞–≥–µ–Ω—Ç–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ Supabase:', data);
                return { success: true, data, id: data.id };
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞:', error);
                // Fallback –Ω–∞ localStorage
                localStorage.setItem("agentData", JSON.stringify(agentData));
                return { success: false, error: error.message, fallback: true };
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–≥—Ä–æ–≤–æ–π —Å–µ—Å—Å–∏–∏ (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏–µ)
        async function saveGameSessionToSupabase(gameData) {
            if (!supabase) {
                console.warn('Supabase –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –∏–≥—Ä–æ–≤–∞—è —Å–µ—Å—Å–∏—è –Ω–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞');
                return { success: false, fallback: true };
            }

            try {
                const agentId = localStorage.getItem("agentId");
                if (!agentId) {
                    console.warn('Agent ID –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏–≥—Ä–æ–≤–∞—è —Å–µ—Å—Å–∏—è –Ω–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞');
                    return { success: false, error: 'Agent ID not found' };
                }

                const sessionId = localStorage.getItem("gameSessionId");
                const sessionData = {
                    agent_id: agentId,
                    reputation: gameData.rep || 0,
                    total_cases: gameData.cases?.length || 0,
                    current_case_index: gameData.idx || 0,
                    answers: gameData.answers || {},
                    cases_played: gameData.cases?.map(c => ({
                        tag: c.tag,
                        difficulty: c.difficulty,
                        title: c.title
                    })) || [],
                    updated_at: new Date().toISOString(),
                    completed: gameData.idx >= (gameData.cases?.length || 0)
                };

                // –ï—Å–ª–∏ –µ—Å—Ç—å started_at –∏–∑ gameData, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ, –∏–Ω–∞—á–µ —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è
                if (gameData.startedAt) {
                    sessionData.started_at = gameData.startedAt;
                } else if (!sessionId) {
                    sessionData.started_at = new Date().toISOString();
                }

                let data, error;

                if (sessionId) {
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å–µ—Å—Å–∏—é
                    console.log('–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–≤–æ–π —Å–µ—Å—Å–∏–∏:', sessionId);
                    const result = await supabase
                        .from('game_sessions')
                        .update(sessionData)
                        .eq('id', sessionId)
                        .select()
                        .single();
                    data = result.data;
                    error = result.error;
                } else {
                    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é
                    console.log('–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∏–≥—Ä–æ–≤–æ–π —Å–µ—Å—Å–∏–∏');
                    if (!sessionData.started_at) {
                        sessionData.started_at = new Date().toISOString();
                    }
                    const result = await supabase
                        .from('game_sessions')
                        .insert([sessionData])
                        .select()
                        .single();
                    data = result.data;
                    error = result.error;
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º ID —Å–µ—Å—Å–∏–∏
                    if (data && data.id) {
                        localStorage.setItem("gameSessionId", data.id);
                        console.log('Game Session ID —Å–æ—Ö—Ä–∞–Ω–µ–Ω:', data.id);
                    }
                }

                if (error) throw error;

                console.log('–ò–≥—Ä–æ–≤–∞—è —Å–µ—Å—Å–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ Supabase:', data);
                return { success: true, data, sessionId: data.id };
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–≥—Ä–æ–≤–æ–π —Å–µ—Å—Å–∏–∏:', error);
                console.error('–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:', JSON.stringify(error, null, 2));
                return { success: false, error: error.message };
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–π –∏–≥—Ä—ã
        async function saveGameResultToSupabase(gameResult) {
            if (!supabase) {
                console.warn('Supabase –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–≥—Ä—ã –Ω–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω');
                return { success: false, fallback: true };
            }

            try {
                const agentId = localStorage.getItem("agentId");
                if (!agentId) {
                    console.warn('Agent ID –Ω–µ –Ω–∞–π–¥–µ–Ω, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω');
                    return { success: false, error: 'Agent ID not found' };
                }

                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —É—Ä–æ–≤–µ–Ω—å –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Ä–µ–ø—É—Ç–∞—Ü–∏–∏
                const levelInfo = calculateLevel(gameResult.rep || 0);

                const resultData = {
                    agent_id: agentId,
                    final_reputation: gameResult.rep || 0,
                    total_cases: gameResult.totalCases || 0,
                    max_reputation: gameResult.maxRep || 0,
                    accuracy_ratio: gameResult.ratio || 0,
                    rank: gameResult.rank || 'unknown',
                    level_achieved: levelInfo.level,
                    level_title_ru: levelInfo.title_ru,
                    level_title_kz: levelInfo.title_kz,
                    praise_text_ru: levelInfo.praise_ru,
                    praise_text_kz: levelInfo.praise_kz,
                    completed_at: new Date().toISOString()
                };

                console.log('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∏–≥—Ä—ã:', resultData);

                const { data, error } = await supabase
                    .from('game_results')
                    .insert([resultData])
                    .select()
                    .single();

                if (error) throw error;

                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∞–≥–µ–Ω—Ç–∞: total_reputation, current_level, level_title
                // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –∞–≥–µ–Ω—Ç–∞
                const { data: agentData, error: agentError } = await supabase
                    .from('agents')
                    .select('total_reputation, total_games_completed')
                    .eq('id', agentId)
                    .single();

                if (!agentError && agentData) {
                    const newTotalReputation = (agentData.total_reputation || 0) + (gameResult.rep || 0);
                    const newTotalGames = (agentData.total_games_completed || 0) + 1;
                    const newLevelInfo = calculateLevel(newTotalReputation);

                    const { error: updateError } = await supabase
                        .from('agents')
                        .update({
                            total_reputation: newTotalReputation,
                            current_level: newLevelInfo.level,
                            level_title_ru: newLevelInfo.title_ru,
                            level_title_kz: newLevelInfo.title_kz,
                            total_games_completed: newTotalGames,
                            updated_at: new Date().toISOString()
                        })
                        .eq('id', agentId);

                    if (updateError) {
                        console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∞–≥–µ–Ω—Ç–∞:', updateError);
                    } else {
                        console.log('–î–∞–Ω–Ω—ã–µ –∞–≥–µ–Ω—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω—ã:', {
                            total_reputation: newTotalReputation,
                            current_level: newLevelInfo.level,
                            level_title: newLevelInfo.title_ru
                        });
                    }
                }

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–µ—Å—Å–∏—é –∫–∞–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—É—é
                const sessionId = localStorage.getItem("gameSessionId");
                if (sessionId) {
                    await supabase
                        .from('game_sessions')
                        .update({ completed: true, updated_at: new Date().toISOString() })
                        .eq('id', sessionId);
                    localStorage.removeItem("gameSessionId"); // –û—á–∏—â–∞–µ–º –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
                }

                console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç –∏–≥—Ä—ã —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ Supabase:', data);
                return { success: true, data, resultId: data.id, levelInfo };
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∏–≥—Ä—ã:', error);
                console.error('–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:', JSON.stringify(error, null, 2));
                return { success: false, error: error.message };
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∞–≥–µ–Ω—Ç–∞ –≤ Supabase
        async function checkAgentExistsInSupabase(agentId) {
            if (!supabase || !agentId) {
                return false;
            }

            try {
                const { data, error } = await supabase
                    .from('agents')
                    .select('id')
                    .eq('id', agentId)
                    .single();

                if (error) {
                    // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ "–Ω–µ –Ω–∞–π–¥–µ–Ω–æ", –∑–Ω–∞—á–∏—Ç –∞–≥–µ–Ω—Ç–∞ –Ω–µ—Ç
                    if (error.code === 'PGRST116') {
                        return false;
                    }
                    throw error;
                }

                return !!data;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∞–≥–µ–Ω—Ç–∞:', error);
                return false;
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∞–≥–µ–Ω—Ç–∞ –∏–∑ Supabase
        async function loadAgentDataFromSupabase() {
            if (!supabase) {
                console.warn('Supabase –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º localStorage');
                return null;
            }

            try {
                const agentId = localStorage.getItem("agentId");
                if (!agentId) {
                    console.log('Agent ID –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ localStorage');
                    return null;
                }

                const { data, error } = await supabase
                    .from('agents')
                    .select('total_reputation, current_level, level_title_ru, level_title_kz, total_games_completed')
                    .eq('id', agentId)
                    .single();

                if (error) throw error;

                if (data) {
                    console.log('–î–∞–Ω–Ω—ã–µ –∞–≥–µ–Ω—Ç–∞ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ Supabase:', data);
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
                    localStorage.setItem("agentLevelData", JSON.stringify(data));
                    return data;
                }

                return null;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∞–≥–µ–Ω—Ç–∞:', error);
                return null;
            }
        }

        // ========== –ê–î–ú–ò–ù –§–£–ù–ö–¶–ò–ò ==========
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏–∑ –ë–î
        async function getAllAnalytics() {
            if (!supabase) {
                return { success: false, error: 'Supabase –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω' };
            }

            try {
                console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏–∑ Supabase...');

                // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
                const [agentsResult, sessionsResult, answersResult, resultsResult] = await Promise.all([
                    supabase.from('agents').select('*').order('created_at', { ascending: false }),
                    supabase.from('game_sessions').select('*').order('started_at', { ascending: false }),
                    supabase.from('case_answers').select('*').order('answered_at', { ascending: false }),
                    supabase.from('game_results').select('*').order('completed_at', { ascending: false })
                ]);

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—à–∏–±–∫–∏
                if (agentsResult.error) throw agentsResult.error;
                if (sessionsResult.error) throw sessionsResult.error;
                if (answersResult.error) throw answersResult.error;
                if (resultsResult.error) throw resultsResult.error;

                return {
                    success: true,
                    agents: agentsResult.data || [],
                    sessions: sessionsResult.data || [],
                    answers: answersResult.data || [],
                    results: resultsResult.data || []
                };
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏:', error);
                return { success: false, error: error.message };
            }
        }

        // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Å–æ—Ü–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –º–µ—Ç—Ä–∏–∫
        function calculateSociologicalMetrics(analytics) {
            const { agents, sessions, answers, results } = analytics;

            // 1. –î–µ–º–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑
            const genderDist = {};
            const ageDist = {};
            const regionDist = {};
            
            agents.forEach(a => {
                genderDist[a.gender] = (genderDist[a.gender] || 0) + 1;
                ageDist[a.age] = (ageDist[a.age] || 0) + 1;
                regionDist[a.region] = (regionDist[a.region] || 0) + 1;
            });

            // 2. –ê–Ω–∞–ª–∏–∑ –º–µ–¥–∏–∞–≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏ –ø–æ –¥–µ–º–æ–≥—Ä–∞—Ñ–∏–∏
            const accuracyByGender = {};
            const accuracyByAge = {};
            const accuracyByRegion = {};
            
            // –°–æ–∑–¥–∞–µ–º –º–∞–ø—É agent_id -> agent
            const agentMap = {};
            agents.forEach(a => agentMap[a.id] = a);

            results.forEach(r => {
                const agent = agentMap[r.agent_id];
                if (!agent) return;

                const accuracy = (r.accuracy_ratio || 0) * 100;

                if (!accuracyByGender[agent.gender]) {
                    accuracyByGender[agent.gender] = { sum: 0, count: 0 };
                }
                accuracyByGender[agent.gender].sum += accuracy;
                accuracyByGender[agent.gender].count += 1;

                if (!accuracyByAge[agent.age]) {
                    accuracyByAge[agent.age] = { sum: 0, count: 0 };
                }
                accuracyByAge[agent.age].sum += accuracy;
                accuracyByAge[agent.age].count += 1;

                if (!accuracyByRegion[agent.region]) {
                    accuracyByRegion[agent.region] = { sum: 0, count: 0 };
                }
                accuracyByRegion[agent.region].sum += accuracy;
                accuracyByRegion[agent.region].count += 1;
            });

            // 3. –ê–Ω–∞–ª–∏–∑ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –¥–µ–ª
            const difficultyStats = {};
            const tagStats = {};
            
            answers.forEach(a => {
                const diff = a.case_difficulty || 'unknown';
                const tag = a.case_tag || 'unknown';
                const points = a.points_earned || 0;
                const isCorrect = a.choice_made === a.correct_choice;

                if (!difficultyStats[diff]) {
                    difficultyStats[diff] = { total: 0, points: 0, correct: 0 };
                }
                difficultyStats[diff].total += 1;
                difficultyStats[diff].points += points;
                if (isCorrect) difficultyStats[diff].correct += 1;

                if (!tagStats[tag]) {
                    tagStats[tag] = { total: 0, points: 0, correct: 0 };
                }
                tagStats[tag].total += 1;
                tagStats[tag].points += points;
                if (isCorrect) tagStats[tag].correct += 1;
            });

            // 4. –ü–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑
            const completedSessions = sessions.filter(s => s.completed).length;
            const notCompletedSessions = sessions.filter(s => !s.completed).length;
            const dropoutRate = sessions.length > 0 ? (notCompletedSessions / sessions.length * 100).toFixed(1) : 0;

            // 5. –í—Ä–µ–º–µ–Ω–Ω–æ–π –∞–Ω–∞–ª–∏–∑
            const registrationsByDate = {};
            agents.forEach(a => {
                if (a.created_at) {
                    const date = new Date(a.created_at).toLocaleDateString('ru-RU');
                    registrationsByDate[date] = (registrationsByDate[date] || 0) + 1;
                }
            });

            // 6. –ê–Ω–∞–ª–∏–∑ —É—Ä–æ–≤–Ω–µ–π
            const levelDist = {};
            const levelByReputation = {};
            const avgReputationByLevel = {};
            const totalReputationByLevel = {};
            const gamesByLevel = {};
            
            agents.forEach(a => {
                const level = a.current_level || 1;
                const totalRep = a.total_reputation || 0;
                const games = a.total_games_completed || 0;
                
                levelDist[level] = (levelDist[level] || 0) + 1;
                
                if (!levelByReputation[level]) {
                    levelByReputation[level] = [];
                }
                levelByReputation[level].push(totalRep);
                
                if (!avgReputationByLevel[level]) {
                    avgReputationByLevel[level] = { sum: 0, count: 0 };
                }
                avgReputationByLevel[level].sum += totalRep;
                avgReputationByLevel[level].count += 1;
                
                if (!totalReputationByLevel[level]) {
                    totalReputationByLevel[level] = 0;
                }
                totalReputationByLevel[level] += totalRep;
                
                if (!gamesByLevel[level]) {
                    gamesByLevel[level] = 0;
                }
                gamesByLevel[level] += games;
            });

            // 7. –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            const totalAgents = agents.length;
            const totalSessions = sessions.length;
            const totalAnswers = answers.length;
            const totalResults = results.length;
            const activeSessions = sessions.filter(s => !s.completed).length;
            const avgReputation = results.length > 0 
                ? (results.reduce((sum, r) => sum + (r.final_reputation || 0), 0) / results.length).toFixed(1)
                : 0;
            const avgAccuracy = results.length > 0
                ? (results.reduce((sum, r) => sum + (r.accuracy_ratio || 0), 0) / results.length * 100).toFixed(1)
                : 0;
            
            // –°—Ä–µ–¥–Ω—è—è –æ–±—â–∞—è —Ä–µ–ø—É—Ç–∞—Ü–∏—è –∞–≥–µ–Ω—Ç–æ–≤
            const avgTotalReputation = agents.length > 0
                ? (agents.reduce((sum, a) => sum + (a.total_reputation || 0), 0) / agents.length).toFixed(1)
                : 0;

            return {
                // –î–µ–º–æ–≥—Ä–∞—Ñ–∏—è
                genderDist,
                ageDist,
                regionDist,
                // –ú–µ–¥–∏–∞–≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å
                accuracyByGender,
                accuracyByAge,
                accuracyByRegion,
                // –°–ª–æ–∂–Ω–æ—Å—Ç—å
                difficultyStats,
                tagStats,
                // –ü–æ–≤–µ–¥–µ–Ω–∏–µ
                completedSessions,
                notCompletedSessions,
                dropoutRate,
                // –í—Ä–µ–º—è
                registrationsByDate,
                // –£—Ä–æ–≤–Ω–∏
                levelDist,
                avgReputationByLevel,
                totalReputationByLevel,
                gamesByLevel,
                // –û–±—â–µ–µ
                totalAgents,
                totalSessions,
                totalAnswers,
                totalResults,
                activeSessions,
                avgReputation,
                avgAccuracy,
                avgTotalReputation
            };
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
        async function showAdminAnalytics() {
            const modal = $("#adminModal");
            const content = $("#adminContent");
            
            modal.style.display = "block";
            content.innerHTML = `
                <div style="text-align:center; padding:20px; color:var(--muted)">
                    <div class="spinner"></div>
                    <p style="margin-top:12px">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>
                </div>
            `;

            const analytics = await getAllAnalytics();

            if (!analytics.success) {
                content.innerHTML = `
                    <div class="admin-section">
                        <h3>‚ùå –û—à–∏–±–∫–∞</h3>
                        <p style="color:var(--warn)">${analytics.error || '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ'}</p>
                    </div>
                `;
                return;
            }

            const metrics = calculateSociologicalMetrics(analytics);

            // –§–æ—Ä–º–∏—Ä—É–µ–º HTML —Å –ø–æ–ª–Ω–æ–π —Å–æ—Ü–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π
            let html = `
                <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(150px, 1fr)); gap:12px; margin-bottom:20px">
                    <div class="admin-stat">
                        <strong>${metrics.totalAgents}</strong>
                        <span>–ê–≥–µ–Ω—Ç–æ–≤</span>
                    </div>
                    <div class="admin-stat">
                        <strong>${metrics.totalSessions}</strong>
                        <span>–°–µ—Å—Å–∏–π</span>
                    </div>
                    <div class="admin-stat">
                        <strong>${metrics.activeSessions}</strong>
                        <span>–ê–∫—Ç–∏–≤–Ω—ã—Ö</span>
                    </div>
                    <div class="admin-stat">
                        <strong>${metrics.totalAnswers}</strong>
                        <span>–û—Ç–≤–µ—Ç–æ–≤</span>
                    </div>
                    <div class="admin-stat">
                        <strong>${metrics.totalResults}</strong>
                        <span>–ó–∞–≤–µ—Ä—à–µ–Ω–æ</span>
                    </div>
                    <div class="admin-stat">
                        <strong>${metrics.avgReputation}</strong>
                        <span>–°—Ä–µ–¥–Ω—è—è —Ä–µ–ø—É—Ç–∞—Ü–∏—è</span>
                    </div>
                    <div class="admin-stat">
                        <strong>${metrics.avgAccuracy}%</strong>
                        <span>–°—Ä–µ–¥–Ω—è—è —Ç–æ—á–Ω–æ—Å—Ç—å</span>
                    </div>
                    <div class="admin-stat">
                        <strong>${metrics.avgTotalReputation}</strong>
                        <span>–°—Ä–µ–¥–Ω—è—è –æ–±—â–∞—è —Ä–µ–ø—É—Ç–∞—Ü–∏—è</span>
                    </div>
                    <div class="admin-stat">
                        <strong>${metrics.dropoutRate}%</strong>
                        <span>–û—Ç–∫–∞–∑ –æ—Ç –∏–≥—Ä—ã</span>
                    </div>
                </div>

                <!-- –î–ï–ú–û–ì–†–ê–§–ò–ß–ï–°–ö–ò–ô –ê–ù–ê–õ–ò–ó -->
                <div class="admin-section">
                    <h3>üìä –î–µ–º–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑</h3>
                    
                    <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(250px, 1fr)); gap:16px; margin-bottom:16px">
                        <div>
                            <h4 style="margin:0 0 8px 0; font-size:14px; color:var(--muted)">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø–æ–ª—É</h4>
                            <table class="admin-table" style="font-size:12px">
                                <thead>
                                    <tr>
                                        <th>–ü–æ–ª</th>
                                        <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                                        <th>%</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${Object.entries(metrics.genderDist).map(([gender, count]) => {
                                        const pct = ((count / metrics.totalAgents) * 100).toFixed(1);
                                        return `<tr>
                                            <td>${escapeHtml(gender)}</td>
                                            <td>${count}</td>
                                            <td>${pct}%</td>
                                        </tr>`;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>

                        <div>
                            <h4 style="margin:0 0 8px 0; font-size:14px; color:var(--muted)">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É</h4>
                            <table class="admin-table" style="font-size:12px">
                                <thead>
                                    <tr>
                                        <th>–í–æ–∑—Ä–∞—Å—Ç</th>
                                        <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                                        <th>%</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${Object.entries(metrics.ageDist).sort((a, b) => {
                                        const order = {'under18': 1, '18-25': 2, '26-35': 3, '36-45': 4, '46plus': 5};
                                        return (order[a[0]] || 99) - (order[b[0]] || 99);
                                    }).map(([age, count]) => {
                                        const pct = ((count / metrics.totalAgents) * 100).toFixed(1);
                                        const ageLabel = age === 'under18' ? '<18' : age === '18-25' ? '18-25' : age === '26-35' ? '26-35' : age === '36-45' ? '36-45' : '46+';
                                        return `<tr>
                                            <td>${ageLabel}</td>
                                            <td>${count}</td>
                                            <td>${pct}%</td>
                                        </tr>`;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>

                        <div>
                            <h4 style="margin:0 0 8px 0; font-size:14px; color:var(--muted)">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º</h4>
                            <div style="max-height:200px; overflow-y:auto">
                                <table class="admin-table" style="font-size:12px">
                                    <thead>
                                        <tr>
                                            <th>–†–µ–≥–∏–æ–Ω</th>
                                            <th>–ö–æ–ª-–≤–æ</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${Object.entries(metrics.regionDist).sort((a, b) => b[1] - a[1]).map(([region, count]) => {
                                            return `<tr>
                                                <td>${escapeHtml(region)}</td>
                                                <td>${count}</td>
                                            </tr>`;
                                        }).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –ê–ù–ê–õ–ò–ó –ú–ï–î–ò–ê–ì–†–ê–ú–û–¢–ù–û–°–¢–ò -->
                <div class="admin-section">
                    <h3>üéØ –ê–Ω–∞–ª–∏–∑ –º–µ–¥–∏–∞–≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏</h3>
                    
                    <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(250px, 1fr)); gap:16px">
                        <div>
                            <h4 style="margin:0 0 8px 0; font-size:14px; color:var(--muted)">–¢–æ—á–Ω–æ—Å—Ç—å –ø–æ –ø–æ–ª—É</h4>
                            <table class="admin-table" style="font-size:12px">
                                <thead>
                                    <tr>
                                        <th>–ü–æ–ª</th>
                                        <th>–¢–æ—á–Ω–æ—Å—Ç—å</th>
                                        <th>–ò–≥—Ä</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${Object.entries(metrics.accuracyByGender).map(([gender, data]) => {
                                        const avg = (data.sum / data.count).toFixed(1);
                                        return `<tr>
                                            <td>${escapeHtml(gender)}</td>
                                            <td><strong>${avg}%</strong></td>
                                            <td>${data.count}</td>
                                        </tr>`;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>

                        <div>
                            <h4 style="margin:0 0 8px 0; font-size:14px; color:var(--muted)">–¢–æ—á–Ω–æ—Å—Ç—å –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É</h4>
                            <table class="admin-table" style="font-size:12px">
                                <thead>
                                    <tr>
                                        <th>–í–æ–∑—Ä–∞—Å—Ç</th>
                                        <th>–¢–æ—á–Ω–æ—Å—Ç—å</th>
                                        <th>–ò–≥—Ä</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${Object.entries(metrics.accuracyByAge).sort((a, b) => {
                                        const order = {'under18': 1, '18-25': 2, '26-35': 3, '36-45': 4, '46plus': 5};
                                        return (order[a[0]] || 99) - (order[b[0]] || 99);
                                    }).map(([age, data]) => {
                                        const avg = (data.sum / data.count).toFixed(1);
                                        const ageLabel = age === 'under18' ? '<18' : age === '18-25' ? '18-25' : age === '26-35' ? '26-35' : age === '36-45' ? '36-45' : '46+';
                                        return `<tr>
                                            <td>${ageLabel}</td>
                                            <td><strong>${avg}%</strong></td>
                                            <td>${data.count}</td>
                                        </tr>`;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>

                        <div>
                            <h4 style="margin:0 0 8px 0; font-size:14px; color:var(--muted)">–¢–æ—á–Ω–æ—Å—Ç—å –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º (—Ç–æ–ø-10)</h4>
                            <div style="max-height:200px; overflow-y:auto">
                                <table class="admin-table" style="font-size:12px">
                                    <thead>
                                        <tr>
                                            <th>–†–µ–≥–∏–æ–Ω</th>
                                            <th>–¢–æ—á–Ω–æ—Å—Ç—å</th>
                                            <th>–ò–≥—Ä</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${Object.entries(metrics.accuracyByRegion)
                                            .sort((a, b) => (b[1].sum / b[1].count) - (a[1].sum / a[1].count))
                                            .slice(0, 10)
                                            .map(([region, data]) => {
                                                const avg = (data.sum / data.count).toFixed(1);
                                                return `<tr>
                                                    <td>${escapeHtml(region)}</td>
                                                    <td><strong>${avg}%</strong></td>
                                                    <td>${data.count}</td>
                                                </tr>`;
                                            }).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –ê–ù–ê–õ–ò–ó –£–†–û–í–ù–ï–ô -->
                <div class="admin-section">
                    <h3>‚≠ê –ê–Ω–∞–ª–∏–∑ —É—Ä–æ–≤–Ω–µ–π –∞–≥–µ–Ω—Ç–æ–≤</h3>
                    
                    <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(300px, 1fr)); gap:16px">
                        <div>
                            <h4 style="margin:0 0 8px 0; font-size:14px; color:var(--muted)">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —É—Ä–æ–≤–Ω—è–º</h4>
                            <table class="admin-table" style="font-size:12px">
                                <thead>
                                    <tr>
                                        <th>–£—Ä–æ–≤–µ–Ω—å</th>
                                        <th>–¢–∏—Ç—É–ª</th>
                                        <th>–ê–≥–µ–Ω—Ç–æ–≤</th>
                                        <th>%</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${[1, 2, 3, 4, 5].map(level => {
                                        const count = metrics.levelDist[level] || 0;
                                        const pct = ((count / metrics.totalAgents) * 100).toFixed(1);
                                        const levelInfo = calculateLevel(level === 1 ? 2 : level === 2 ? 6 : level === 3 ? 10 : level === 4 ? 14 : 18);
                                        return `<tr>
                                            <td><strong>${level}</strong></td>
                                            <td>${levelInfo.title_ru}</td>
                                            <td>${count}</td>
                                            <td>${pct}%</td>
                                        </tr>`;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>

                        <div>
                            <h4 style="margin:0 0 8px 0; font-size:14px; color:var(--muted)">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —É—Ä–æ–≤–Ω—è–º</h4>
                            <table class="admin-table" style="font-size:12px">
                                <thead>
                                    <tr>
                                        <th>–£—Ä–æ–≤–µ–Ω—å</th>
                                        <th>–°—Ä–µ–¥–Ω—è—è —Ä–µ–ø—É—Ç–∞—Ü–∏—è</th>
                                        <th>–í—Å–µ–≥–æ –∏–≥—Ä</th>
                                        <th>–°—Ä–µ–¥–Ω–µ–µ –∏–≥—Ä/–∞–≥–µ–Ω—Ç</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${[1, 2, 3, 4, 5].map(level => {
                                        const levelData = metrics.avgReputationByLevel[level];
                                        const avgRep = levelData && levelData.count > 0 
                                            ? (levelData.sum / levelData.count).toFixed(1) 
                                            : '0';
                                        const totalGames = metrics.gamesByLevel[level] || 0;
                                        const agentsCount = metrics.levelDist[level] || 1;
                                        const avgGames = (totalGames / agentsCount).toFixed(1);
                                        return `<tr>
                                            <td><strong>${level}</strong></td>
                                            <td>${avgRep}</td>
                                            <td>${totalGames}</td>
                                            <td>${avgGames}</td>
                                        </tr>`;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- –ê–ù–ê–õ–ò–ó –°–õ–û–ñ–ù–û–°–¢–ò –î–ï–õ -->
                <div class="admin-section">
                    <h3>üìà –ê–Ω–∞–ª–∏–∑ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –¥–µ–ª</h3>
                    
                    <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(300px, 1fr)); gap:16px">
                        <div>
                            <h4 style="margin:0 0 8px 0; font-size:14px; color:var(--muted)">–ü–æ —É—Ä–æ–≤–Ω—é —Å–ª–æ–∂–Ω–æ—Å—Ç–∏</h4>
                            <table class="admin-table" style="font-size:12px">
                                <thead>
                                    <tr>
                                        <th>–°–ª–æ–∂–Ω–æ—Å—Ç—å</th>
                                        <th>–û—Ç–≤–µ—Ç–æ–≤</th>
                                        <th>–°—Ä–µ–¥–Ω–∏–µ –æ—á–∫–∏</th>
                                        <th>–£—Å–ø–µ—Ö</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${Object.entries(metrics.difficultyStats).map(([diff, stats]) => {
                                        const avgPoints = (stats.points / stats.total).toFixed(1);
                                        const successRate = ((stats.correct / stats.total) * 100).toFixed(1);
                                        return `<tr>
                                            <td>${escapeHtml(diff)}</td>
                                            <td>${stats.total}</td>
                                            <td>${avgPoints}</td>
                                            <td><strong>${successRate}%</strong></td>
                                        </tr>`;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>

                        <div>
                            <h4 style="margin:0 0 8px 0; font-size:14px; color:var(--muted)">–ü–æ —Ç–∏–ø–∞–º –¥–µ–ª</h4>
                            <div style="max-height:300px; overflow-y:auto">
                                <table class="admin-table" style="font-size:12px">
                                    <thead>
                                        <tr>
                                            <th>–¢–∏–ø –¥–µ–ª–∞</th>
                                            <th>–û—Ç–≤–µ—Ç–æ–≤</th>
                                            <th>–°—Ä–µ–¥–Ω–∏–µ –æ—á–∫–∏</th>
                                            <th>–£—Å–ø–µ—Ö</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${Object.entries(metrics.tagStats).sort((a, b) => b[1].total - a[1].total).map(([tag, stats]) => {
                                            const avgPoints = (stats.points / stats.total).toFixed(1);
                                            const successRate = ((stats.correct / stats.total) * 100).toFixed(1);
                                            return `<tr>
                                                <td>${escapeHtml(tag)}</td>
                                                <td>${stats.total}</td>
                                                <td>${avgPoints}</td>
                                                <td><strong>${successRate}%</strong></td>
                                            </tr>`;
                                        }).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –ü–û–í–ï–î–ï–ù–ß–ï–°–ö–ò–ô –ê–ù–ê–õ–ò–ó -->
                <div class="admin-section">
                    <h3>üîÑ –ü–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑</h3>
                    <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:12px">
                        <div class="admin-stat">
                            <strong>${metrics.completedSessions}</strong>
                            <span>–ó–∞–≤–µ—Ä—à–µ–Ω–æ —Å–µ—Å—Å–∏–π</span>
                        </div>
                        <div class="admin-stat">
                            <strong>${metrics.notCompletedSessions}</strong>
                            <span>–ù–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ</span>
                        </div>
                        <div class="admin-stat">
                            <strong>${metrics.dropoutRate}%</strong>
                            <span>–ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç–∫–∞–∑–æ–≤</span>
                        </div>
                    </div>
                </div>

                <!-- –í–†–ï–ú–ï–ù–ù–û–ô –ê–ù–ê–õ–ò–ó -->
                <div class="admin-section">
                    <h3>üìÖ –í—Ä–µ–º–µ–Ω–Ω–æ–π –∞–Ω–∞–ª–∏–∑</h3>
                    <h4 style="margin:0 0 8px 0; font-size:14px; color:var(--muted)">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –¥–∞—Ç–∞–º (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π)</h4>
                    <div style="max-height:300px; overflow-y:auto">
                        <table class="admin-table" style="font-size:12px">
                            <thead>
                                <tr>
                                    <th>–î–∞—Ç–∞</th>
                                    <th>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${Object.entries(metrics.registrationsByDate)
                                    .sort((a, b) => new Date(b[0].split('.').reverse().join('-')) - new Date(a[0].split('.').reverse().join('-')))
                                    .slice(0, 30)
                                    .map(([date, count]) => {
                                        return `<tr>
                                            <td>${date}</td>
                                            <td><strong>${count}</strong></td>
                                        </tr>`;
                                    }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- –î–ï–¢–ê–õ–¨–ù–´–ï –¢–ê–ë–õ–ò–¶–´ -->
                <div class="admin-section">
                    <h3>üë• –í—Å–µ –∞–≥–µ–Ω—Ç—ã (${analytics.agents.length})</h3>
                    <div style="overflow-x:auto; max-height:400px; overflow-y:auto">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th style="width:200px">–ü–æ–∑—ã–≤–Ω–æ–π</th>
                                    <th style="width:80px">–£—Ä–æ–≤–µ–Ω—å</th>
                                    <th style="width:120px">–¢–∏—Ç—É–ª</th>
                                    <th style="width:100px">–û–±—â–∞—è —Ä–µ–ø—É—Ç–∞—Ü–∏—è</th>
                                    <th style="width:80px">–ò–≥—Ä</th>
                                    <th style="width:100px">–ü–æ–ª</th>
                                    <th style="width:100px">–í–æ–∑—Ä–∞—Å—Ç</th>
                                    <th style="width:150px">–†–µ–≥–∏–æ–Ω</th>
                                    <th style="width:180px">–°–æ–∑–¥–∞–Ω</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${analytics.agents.map(a => {
                                    const level = a.current_level || 1;
                                    const levelInfo = calculateLevel(a.total_reputation || 0);
                                    return `
                                    <tr>
                                        <td>${escapeHtml(a.callsign || '‚Äî')}</td>
                                        <td><strong>${level}</strong></td>
                                        <td>${escapeHtml(a.level_title_ru || levelInfo.title_ru || '‚Äî')}</td>
                                        <td>${a.total_reputation || 0}</td>
                                        <td>${a.total_games_completed || 0}</td>
                                        <td>${escapeHtml(a.gender || '‚Äî')}</td>
                                        <td>${escapeHtml(a.age || '‚Äî')}</td>
                                        <td>${escapeHtml(a.region || '‚Äî')}</td>
                                        <td>${formatDate(a.created_at)}</td>
                                    </tr>
                                `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="admin-section">
                    <h3>üèÜ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–≥—Ä (${analytics.results.length})</h3>
                    <div style="overflow-x:auto; max-height:400px; overflow-y:auto">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th style="width:80px">–†–µ–ø—É—Ç–∞—Ü–∏—è</th>
                                    <th style="width:70px">–£—Ä–æ–≤–µ–Ω—å</th>
                                    <th style="width:150px">–¢–∏—Ç—É–ª</th>
                                    <th style="width:80px">–î–µ–ª–∞</th>
                                    <th style="width:100px">–¢–æ—á–Ω–æ—Å—Ç—å</th>
                                    <th style="width:150px">–†–∞–Ω–≥</th>
                                    <th style="width:180px">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${analytics.results.map(r => {
                                    const level = r.level_achieved || calculateLevel(r.final_reputation || 0).level;
                                    const levelTitle = r.level_title_ru || calculateLevel(r.final_reputation || 0).title_ru;
                                    return `
                                    <tr>
                                        <td><strong>${r.final_reputation || 0}</strong></td>
                                        <td><strong>${level}</strong></td>
                                        <td>${escapeHtml(levelTitle || '‚Äî')}</td>
                                        <td>${r.total_cases || 0}</td>
                                        <td>${((r.accuracy_ratio || 0) * 100).toFixed(1)}%</td>
                                        <td>${escapeHtml(r.rank || '‚Äî')}</td>
                                        <td>${formatDate(r.completed_at)}</td>
                                    </tr>
                                `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- –î–ï–¢–ê–õ–¨–ù–ê–Ø –ê–ù–ê–õ–ò–¢–ò–ö–ê –ü–û –û–¢–í–ï–¢–ê–ú -->
                <div class="admin-section">
                    <h3>üìã –î–µ—Ç–∞–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –∏–≥—Ä–æ–∫–æ–≤</h3>
                    <p style="color:var(--muted); font-size:13px; margin-bottom:16px">
                        –ö–∞–∂–¥—ã–π –æ—Ç–≤–µ—Ç –∫–∞–∂–¥–æ–≥–æ –∏–≥—Ä–æ–∫–∞ –Ω–∞ –∫–∞–∂–¥—ã–π –∫–µ–π—Å —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π –ø–æ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞–º
                    </p>
                    <div style="overflow-x:auto; max-height:600px; overflow-y:auto">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th style="width:150px">–ò–≥—Ä–æ–∫</th>
                                    <th style="width:120px">–ö–µ–π—Å</th>
                                    <th style="width:100px">–°–ª–æ–∂–Ω–æ—Å—Ç—å</th>
                                    <th style="width:200px">–û—Ç–≤–µ—Ç—ã –Ω–∞ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞</th>
                                    <th style="width:150px">–í—ã–±–æ—Ä —Ä–µ—à–µ–Ω–∏—è</th>
                                    <th style="width:100px">–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–±–æ—Ä</th>
                                    <th style="width:80px">–û—á–∫–∏</th>
                                    <th style="width:180px">–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${analytics.answers.map(a => {
                                    const agent = analytics.agents.find(ag => ag.id === a.agent_id);
                                    const callsign = agent ? agent.callsign : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                                    
                                    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç—ã –Ω–∞ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞
                                    const evidenceAnswers = Array.isArray(a.evidence_answers) 
                                        ? a.evidence_answers.map((ans, idx) => {
                                            const isCorrect = ans !== null ? (ans ? '‚úì' : '‚úó') : '‚Äî';
                                            return `${idx + 1}:${isCorrect}`;
                                        }).join(' ')
                                        : '‚Äî';
                                    
                                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –≤—ã–±–æ—Ä–∞
                                    const choiceCorrect = a.choice_made === a.correct_choice ? '‚úì –î–∞' : '‚úó –ù–µ—Ç';
                                    const choiceDisplay = a.choice_made || '‚Äî';
                                    
                                    return `
                                    <tr>
                                        <td>${escapeHtml(callsign)}</td>
                                        <td>${escapeHtml(a.case_title || a.case_tag || '‚Äî')}</td>
                                        <td>${escapeHtml(a.case_difficulty || '‚Äî')}</td>
                                        <td style="font-size:11px; font-family:monospace">${evidenceAnswers}</td>
                                        <td>${escapeHtml(choiceDisplay)}</td>
                                        <td>${choiceCorrect}</td>
                                        <td><strong>${a.points_earned || 0}</strong></td>
                                        <td>${formatDate(a.answered_at)}</td>
                                    </tr>
                                `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- –ê–ù–ê–õ–ò–¢–ò–ö–ê –ü–û –ö–ï–ô–°–ê–ú -->
                <div class="admin-section">
                    <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞–∂–¥–æ–º—É –∫–µ–π—Å—É</h3>
                    <div style="overflow-x:auto; max-height:500px; overflow-y:auto">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th style="width:200px">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–µ–π—Å–∞</th>
                                    <th style="width:100px">–°–ª–æ–∂–Ω–æ—Å—Ç—å</th>
                                    <th style="width:100px">–¢–∏–ø</th>
                                    <th style="width:80px">–í—Å–µ–≥–æ –æ—Ç–≤–µ—Ç–æ–≤</th>
                                    <th style="width:100px">–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –≤—ã–±–æ—Ä–æ–≤</th>
                                    <th style="width:100px">% —É—Å–ø–µ—Ö–∞</th>
                                    <th style="width:100px">–°—Ä–µ–¥–Ω–∏–µ –æ—á–∫–∏</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${(() => {
                                    // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç—ã –ø–æ –∫–µ–π—Å–∞–º
                                    const caseStats = {};
                                    analytics.answers.forEach(a => {
                                        const key = `${a.case_title || a.case_tag || 'unknown'}_${a.case_difficulty || 'unknown'}`;
                                        if (!caseStats[key]) {
                                            caseStats[key] = {
                                                title: a.case_title || a.case_tag || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ',
                                                difficulty: a.case_difficulty || '‚Äî',
                                                tag: a.case_tag || '‚Äî',
                                                total: 0,
                                                correctChoices: 0,
                                                totalPoints: 0
                                            };
                                        }
                                        caseStats[key].total += 1;
                                        if (a.choice_made === a.correct_choice) {
                                            caseStats[key].correctChoices += 1;
                                        }
                                        caseStats[key].totalPoints += (a.points_earned || 0);
                                    });
                                    
                                    return Object.values(caseStats).map(stat => {
                                        const successRate = stat.total > 0 
                                            ? ((stat.correctChoices / stat.total) * 100).toFixed(1)
                                            : '0';
                                        const avgPoints = stat.total > 0
                                            ? (stat.totalPoints / stat.total).toFixed(1)
                                            : '0';
                                        return `
                                        <tr>
                                            <td>${escapeHtml(stat.title)}</td>
                                            <td>${escapeHtml(stat.difficulty)}</td>
                                            <td>${escapeHtml(stat.tag)}</td>
                                            <td><strong>${stat.total}</strong></td>
                                            <td>${stat.correctChoices}</td>
                                            <td><strong>${successRate}%</strong></td>
                                            <td>${avgPoints}</td>
                                        </tr>
                                    `;
                                    }).join('');
                                })()}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;

            content.innerHTML = html;
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
        function escapeHtml(text) {
            if (!text) return '‚Äî';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function formatDate(dateString) {
            if (!dateString) return '‚Äî';
            try {
                const date = new Date(dateString);
                return date.toLocaleString('ru-RU', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            } catch (e) {
                return dateString;
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –¥–µ–ª–æ
        async function saveCaseAnswerToSupabase(caseData) {
            if (!supabase) {
                return { success: false, fallback: true };
            }

            try {
                const agentId = localStorage.getItem("agentId");
                if (!agentId) {
                    console.warn('Agent ID –Ω–µ –Ω–∞–π–¥–µ–Ω, –æ—Ç–≤–µ—Ç –Ω–∞ –¥–µ–ª–æ –Ω–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω');
                    return { success: false, error: 'Agent ID not found' };
                }

                const answerData = {
                    agent_id: agentId,
                    case_tag: caseData.tag || 'unknown',
                    case_title: caseData.title || 'unknown',
                    case_difficulty: caseData.difficulty || 'unknown',
                    evidence_answers: caseData.evidenceAnswers || [], // –º–∞—Å—Å–∏–≤ –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞
                    choice_made: caseData.choice || '',
                    correct_choice: caseData.correctChoice || '',
                    points_earned: caseData.points || 0,
                    answered_at: new Date().toISOString()
                };

                console.log('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –¥–µ–ª–æ:', answerData);

                const { data, error } = await supabase
                    .from('case_answers')
                    .insert([answerData])
                    .select()
                    .single();

                if (error) throw error;

                console.log('–û—Ç–≤–µ—Ç –Ω–∞ –¥–µ–ª–æ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ Supabase:', data);
                return { success: true, data };
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –¥–µ–ª–æ:', error);
                console.error('–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:', JSON.stringify(error, null, 2));
                return { success: false, error: error.message };
            }
        }

        /** ======== I18N LOCALIZATION ======== */
        const TRANSLATIONS = {
            ru: {
                mainTitle: "Digital Truth: –°–ø–∞—Å–∏ –ü—Ä–∞–≤–¥—É",
                langRu: "–†—É—Å—Å–∫–∏–π",
                langKk: "“ö–∞–∑–∞“õ—à–∞",
                splashBadge: "–ù–æ–≤–∞—è –º–∏—Å—Å–∏—è ‚Ä¢ v2.0",
                splashTitle: "Digital Truth: –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∞–≥–µ–Ω—Ç–∞",
                splashSubtitle: "–î–æ—Å—Ç—É–ø –∫ –±–∞–∑–µ 'Digital Shield' –≤–æ–∑–º–æ–∂–µ–Ω —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∞–≥–µ–Ω—Ç–∞.",
                splashBtn: "–ù–∞—á–∞—Ç—å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é",
                onboardWelcomeTitle: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, –ê–≥–µ–Ω—Ç",
                onboardWelcomeText1: "‚Ä¢ –ú—ã —Ç–µ—Å—Ç–∏—Ä—É–µ–º –≤–∞—à—É —Ü–∏—Ñ—Ä–æ–≤—É—é –∏–Ω—Ç—É–∏—Ü–∏—é –∏ –Ω–∞–≤—ã–∫ —Ñ–∞–∫—Ç-—á–µ–∫–∞.",
                onboardWelcomeText2: "‚Ä¢ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω—É–∂–Ω–∞, —á—Ç–æ–±—ã –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –º–∏—Å—Å–∏–∏ –∏ —Å–æ–±—Ä–∞—Ç—å –∞–Ω–æ–Ω–∏–º–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É.",
                onboardWelcomeText3: "‚Ä¢ –≠—Ç–æ –∑–∞–π–º—ë—Ç < 1 –º–∏–Ω—É—Ç—ã.",
                onboardWelcomeBtn: "–ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø–∞—Å–ø–æ—Ä—Ç–∏—á–∫—É",
                onboardCompleteMsg: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${callsign}! –ù–∞—á–Ω–∏—Ç–µ —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ.",
                formTitle: "–ü–∞—Å–ø–æ—Ä—Ç –∞–≥–µ–Ω—Ç–∞",
                formProgress: "–ü—Ä–æ–≥—Ä–µ—Å—Å: –®–∞–≥ 2 –∏–∑ 3",
                formCallsign: "–ü–æ–∑—ã–≤–Ω–æ–π –∞–≥–µ–Ω—Ç–∞",
                formCallsignPlaceholder: "–ü—Ä–∏–º–µ—Ä: Agent Nova",
                formCallsignSmall: "–≠—Ç–æ –≤–∞—à –ø—É–±–ª–∏—á–Ω—ã–π –Ω–∏–∫; –ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–µ –ø—Ä–æ—Å–∏–º.",
                formGender: "–ü–æ–ª",
                formGenderNote: "(–¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –≤–æ—Å–ø—Ä–∏—è—Ç–∏—è)",
                formGenderFemale: "–ñ–µ–Ω—Å–∫–∏–π",
                formGenderMale: "–ú—É–∂—Å–∫–æ–π",
                formGenderNonbinary: "–ù–µ–±–∏–Ω–∞—Ä–Ω—ã–π",
                formGenderSkip: "–ù–µ —É–∫–∞–∑—ã–≤–∞—Ç—å",
                formGenderOther: "–î—Ä—É–≥–æ–µ",
                formGenderOtherPlaceholder: "–£–∫–∞–∂–∏—Ç–µ",
                formAge: "–í–æ–∑—Ä–∞—Å—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞",
                formAgeUnder18: "<18 –ª–µ—Ç",
                formAge18_25: "18‚Äì25 –ª–µ—Ç",
                formAge26_35: "26‚Äì35 –ª–µ—Ç",
                formAge36_45: "36‚Äì45 –ª–µ—Ç",
                formAge46plus: "46+ –ª–µ—Ç",
                formRegion: "–†–µ–≥–∏–æ–Ω / –ì–æ—Ä–æ–¥",
                formBtnBack: "–ù–∞–∑–∞–¥",
                formBtnNext: "–î–∞–ª–µ–µ",
                regionNurSultan: "–ù—É—Ä‚Äë–°—É–ª—Ç–∞–Ω",
                regionAlmaty: "–ê–ª–º–∞—Ç—ã",
                regionShymkent: "–®—ã–º–∫–µ–Ω—Ç",
                regionKaraganda: "–ö–∞—Ä–∞–≥–∞–Ω–¥–∞",
                regionAktobe: "–ê–∫—Ç–æ–±–µ",
                regionKostanay: "–ö–æ—Å—Ç–∞–Ω–∞–π",
                regionAktau: "–ê–∫—Ç–∞—É",
                regionAtyrau: "–ê—Ç—ã—Ä–∞—É",
                regionPavlodar: "–ü–∞–≤–ª–æ–¥–∞—Ä",
                regionEkibastuz: "–≠–∫–∏–±–∞—Å—Ç—É–∑",
                regionPetropavlovsk: "–ü–µ—Ç—Ä–æ–ø–∞–≤–ª–æ–≤—Å–∫",
                regionOral: "–£—Ä–∞–ª—å—Å–∫",
                regionKokshetau: "–ö–æ–∫—à–µ—Ç–∞—É",
                regionSemey: "–°–µ–º–µ–π",
                regionOskemen: "–£—Å—Ç—å-–ö–∞–º–µ–Ω–æ–≥–æ—Ä—Å–∫",
                regionKyzylorda: "–ö—ã–∑—ã–ª–æ—Ä–¥–∞",
                regionTaraz: "–¢–∞—Ä–∞–∑",
                regionTaldykorgan: "–¢–∞–ª–¥—ã–∫–æ—Ä–≥–∞–Ω",
                regionTurkestan: "–¢—É—Ä–∫–µ—Å—Ç–∞–Ω",
                regionZhanaozen: "–ñ–∞–Ω–∞–æ–∑–µ–Ω",
                regionZhezkazgan: "–ñ–µ–∑–∫–∞–∑–≥–∞–Ω",
                regionKaratau: "–ö–∞—Ä–∞—Ç–∞—É",
                consentTitle: "–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∞–≥–µ–Ω—Ç–∞",
                consentProgress: "–ü—Ä–æ–≥—Ä–µ—Å—Å: –®–∞–≥ 3 –∏–∑ 3",
                consentSummaryCallsign: "–ü–æ–∑—ã–≤–Ω–æ–π:",
                consentSummaryGender: "–ü–æ–ª:",
                consentSummaryAge: "–í–æ–∑—Ä–∞—Å—Ç:",
                consentSummaryRegion: "–†–µ–≥–∏–æ–Ω:",
                consentExplainTitle: "–û –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏:",
                consentExplainText: "–ú—ã —Å–æ–±–∏—Ä–∞–µ–º —Ç–æ–ª—å–∫–æ –∞–Ω–æ–Ω–∏–º–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –∏ –∏–≥—Ä–æ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (–≤—ã–±–æ—Ä—ã, –≤—Ä–µ–º—è —Ä–µ–∞–∫—Ü–∏–∏, –æ—à–∏–±–∫–∏/—É—Å–ø–µ—Ö–∏). –õ–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–§–ò–û, —Ç–µ–ª–µ—Ñ–æ–Ω –∏ —Ç.–ø.) ‚Äî –Ω–µ—Ç.",
                consentData: "–Ø —Å–æ–≥–ª–∞—Å–µ–Ω(—Å–Ω–∞) –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –º–æ–∏—Ö –∞–Ω–æ–Ω–∏–º–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ü–µ–ª–µ–π –∏ —É–ª—É—á—à–µ–Ω–∏—è –∏–≥—Ä—ã.",
                consentAge: "–ú–Ω–µ 16 –ª–µ—Ç –∏ –±–æ–ª—å—à–µ.",
                consentBtnMoreInfo: "–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ –∑–∞—â–∏—Ç–µ –¥–∞–Ω–Ω—ã—Ö",
                consentBtnBack: "–ù–∞–∑–∞–¥",
                consentBtnActivate: "–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –∞–≥–µ–Ω—Ç–∞",
                onboardCompleteMsg: "–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–∏—Å—Å–∏—é, {callsign}!",
                modalTitle: "–ö–∞–∫ –º—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ",
                modalWho: "–ö—Ç–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ:",
                modalWhoText: "–∫–æ–º–∞–Ω–¥–∞ –ø—Ä–æ–µ–∫—Ç–∞ 'Digital Truth'.",
                modalWhat: "–ß—Ç–æ —Å–æ–±–∏—Ä–∞–µ–º:",
                modalWhatText: "–ø–æ–ª, –≤–æ–∑—Ä–∞—Å—Ç–Ω–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω, —Ä–µ–≥–∏–æ–Ω, –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –∏ –∏–≥—Ä–æ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (–≤—Ä–µ–º—è —Ä–µ–∞–∫—Ü–∏–∏, —Ä–µ—à–µ–Ω–∏—è, —É—Å–ø–µ—Ö/–æ—à–∏–±–∫–∞).",
                modalGoal: "–¶–µ–ª—å:",
                modalGoalText: "–∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –≤–æ—Å–ø—Ä–∏—è—Ç–∏—è —Ü–∏—Ñ—Ä–æ–≤–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏ —É–ª—É—á—à–µ–Ω–∏–µ –º–µ—Ö–∞–Ω–∏–∫ –∏–≥—Ä—ã.",
                modalLaw: "–ü—Ä–∞–≤–æ–≤–∞—è –æ—Å–Ω–æ–≤–∞:",
                modalLawText: "–¥–æ–±—Ä–æ–≤–æ–ª—å–Ω–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞.",
                modalTerm: "–°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è:",
                modalTermText: "–¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è (–Ω–µ –±–æ–ª–µ–µ 24 –º–µ—Å—è—Ü–µ–≤), –∑–∞—Ç–µ–º –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª—è—é—Ç—Å—è –∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ.",
                modalThird: "–ü–µ—Ä–µ–¥–∞—á–∞ —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º:",
                modalThirdText: "—Ç–æ–ª—å–∫–æ –≤ –≤–∏–¥–µ –æ–±–µ–∑–ª–∏—á–µ–Ω–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏.",
                modalContact: "–ó–∞ –≤–æ–ø—Ä–æ—Å–∞–º–∏ –∏–ª–∏ –æ—Ç–∑—ã–≤–æ–º —Å–æ–≥–ª–∞—Å–∏—è: support@digitaltruth.game",
                modalBtn: "–ü–æ–Ω—è–ª",
                toastCaseClosed: "–î–µ–ª–æ –∑–∞–∫—Ä—ã—Ç–æ: +{points} —Ä–µ–ø—É—Ç–∞—Ü–∏–∏",
                toastSkipped: "–î–µ–ª–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ",
                toastCopied: "–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞",
                toastHintUnavailable: "–ü–æ–¥—Å–∫–∞–∑–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞",
                toastHow: "–û—Ç–º–µ—á–∞–π –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –∫–∞–∫ –ü—Ä–∞–≤–¥–∞/–õ–æ–∂—å –∏ –≤—ã–±–µ—Ä–∏, –∫–æ–≥–æ —Å–ø–∞—Å—Ç–∏. –ë–∞–ª–ª—ã = —Ç–æ—á–Ω–æ—Å—Ç—å + –≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä.",
                truthBtn: "–ü—Ä–∞–≤–¥–∞",
                lieBtn: "–õ–æ–∂—å",
                hintBtn: "–ü–æ–¥—Å–∫–∞–∑–∫–∞",
                choiceReputation: "–†–µ—à–µ–Ω–∏–µ –ø–æ–≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–µ–ø—É—Ç–∞—Ü–∏—é.",
                endRankNew: "–ê–Ω–∞–ª–∏—Ç–∏–∫-–Ω–æ–≤–æ–±—Ä–∞–Ω–µ—Ü",
                endPraiseNew: "–ù–µ–ø–ª–æ—Ö–æ. –ë–∞–∑–∞ –µ—Å—Ç—å ‚Äî –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º –∫–∞—á–µ—Å—Ç–≤–æ —Ä–µ—à–µ–Ω–∏–π.",
                endRankFact: "–§–∞–∫—Ç—á–µ–∫–µ—Ä",
                endPraiseFact: "–¢—ã —É–≤–µ—Ä–µ–Ω–Ω–æ –æ—Ç–ª–∏—á–∞–µ—à—å —à—É–º –æ—Ç —Å–∏–≥–Ω–∞–ª–æ–≤.",
                endRankCurator: "–ö—É—Ä–∞—Ç–æ—Ä –ø—Ä–∞–≤–¥—ã",
                endPraiseCurator: "–°—Ç–∞–±–∏–ª—å–Ω–æ —Å–ø–∞—Å–∞–µ—à—å —Ç–æ, —á—Ç–æ –≤–∞–∂–Ω–æ ‚Äî –ª—é–¥–µ–π –∏ –¥–∞–Ω–Ω—ã–µ.",
                endRankSavior: "–°–ø–∞—Å–∏—Ç–µ–ª—å –ø—Ä–∞–≤–¥—ã",
                endPraiseSavior: "–°–æ–≤–µ—Ç –∞–ø–ª–æ–¥–∏—Ä—É–µ—Ç —Å—Ç–æ—è. –¢–≤–æ–π —Ä–∞–∑–±–æ—Ä ‚Äî —ç—Ç–∞–ª–æ–Ω.",
                endResult: "–ò—Ç–æ–≥–æ–≤–∞—è —Ä–µ–ø—É—Ç–∞—Ü–∏—è",
                startBadge: "–¶–∏—Ñ—Ä–æ–≤–æ–π —Å–ø–∞—Å–æ—Ç—Ä—è–¥ ‚Ä¢ v2.0",
                startTitle: "–¢—ã ‚Äî –¥–µ—Ç–µ–∫—Ç–∏–≤ —Ñ–∞–∫—Ç–æ–≤",
                startSubtitle: "–ö–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–π: <span class=\"kbd\">–ü—Ä–∞–≤–¥–∞</span> –∏–ª–∏ <span class=\"kbd\">–õ–æ–∂—å</span>. –ó–∞—Ç–µ–º –ø—Ä–∏–º–∏ —Ä–µ—à–µ–Ω–∏–µ ‚Äî <b>–∫–æ–≥–æ —Å–ø–∞—Å—Ç–∏</b>. –ù–∞–±–µ—Ä–∏ —Ä–µ–ø—É—Ç–∞—Ü–∏—é –∏ –ø–æ–ª—É—á–∏ –ø–æ—Ö–≤–∞–ª—É –°–æ–≤–µ—Ç–∞.",
                btnStart: "–ù–∞—á–∞—Ç—å —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ",
                btnHow: "–ü—Ä–∞–≤–∏–ª–∞",
                btnRestart: "–°—ã–≥—Ä–∞—Ç—å –µ—â—ë",
                btnShare: "–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç",
                caseNo: "–î–µ–ª–æ ‚Äî {current} / {total}",
                rep: "–†–µ–ø—É—Ç–∞—Ü–∏—è: {rep}",
                caseTag: "–ò–Ω—Ü–∏–¥–µ–Ω—Ç ‚Ä¢ ",
                caseDifficulty: "–£—Ä–æ–≤–µ–Ω—å",
                caseTitle: "–ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–µ–ª–∞",
                caseNarrative: "–û–ø–∏—Å–∞–Ω–∏–µ",
                caseEvidenceTitle: "–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞:",
                caseDecisionTitle: "–†–µ—à–µ–Ω–∏–µ: –∫–æ–≥–æ —Å–ø–∞—Å—Ç–∏?",
                caseTip: "–°–æ–≤–µ—Ç: –æ—Ç–º–µ—Ç—å –≤—Å–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –∫–∞–∫ <i>–ü—Ä–∞–≤–¥–∞</i> –∏–ª–∏ <i>–õ–æ–∂—å</i>, –∑–∞—Ç–µ–º –≤—ã–±–µ—Ä–∏, –∫–æ–≥–æ —Å–ø–∞—Å–∞—Ç—å.",
                evidence: "–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ",
                evScore: "–û—Ç–º–µ—á–µ–Ω–æ: {done} / {total}",
                choiceTitle: "–†–µ—à–µ–Ω–∏–µ: –∫–æ–≥–æ —Å–ø–∞—Å—Ç–∏?",
                choiceReputation: "–†–µ—à–µ–Ω–∏–µ –ø–æ–≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–µ–ø—É—Ç–∞—Ü–∏—é.",
                btnCheck: "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–µ–ª–æ",
                btnSkip: "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å",
                endTitle: "–ú–∏—Å—Å–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞",
                endText: "–í—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏ —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ",
                rank: "–†–∞–Ω–≥",
            },
            kk: {
                mainTitle: "Digital Truth: –®—ã–Ω–¥—ã“õ—Ç—ã “ö“±—Ç“õ–∞—Ä",
                langRu: "–†—É—Å—Å–∫–∏–π",
                langKk: "“ö–∞–∑–∞“õ—à–∞",
                splashBadge: "–ñ–∞“£–∞ –º–∏—Å—Å–∏—è ‚Ä¢ v2.0",
                splashTitle: "Digital Truth: –ê–≥–µ–Ω—Ç—Ç—ñ —Å”ô–π–∫–µ—Å—Ç–µ–Ω–¥—ñ—Ä—É",
                splashSubtitle: "'Digital Shield' –±–∞–∑–∞—Å—ã–Ω–∞ –∫—ñ—Ä—É —Ç–µ–∫ –∞–≥–µ–Ω—Ç —Ç—ñ—Ä–∫–µ–ª–≥–µ–Ω–Ω–µ–Ω –∫–µ–π—ñ–Ω –º“Ø–º–∫—ñ–Ω.",
                splashBtn: "–°”ô–π–∫–µ—Å—Ç–µ–Ω–¥—ñ—Ä—É–¥—ñ –±–∞—Å—Ç–∞—É",
                onboardWelcomeTitle: "“ö–æ—à –∫–µ–ª–¥—ñ“£—ñ–∑, –ê–≥–µ–Ω—Ç",
                onboardWelcomeText1: "‚Ä¢ –ë—ñ–∑ —Å—ñ–∑–¥—ñ“£ —Ü–∏—Ñ—Ä–ª—ã“õ –∏–Ω—Ç—É–∏—Ü–∏—è“£—ã–∑–¥—ã –∂”ô–Ω–µ —Ñ–∞–∫—Ç—á–µ–∫–∏–Ω–≥ –¥–∞“ì–¥—ã“£—ã–∑–¥—ã —Ç–µ–∫—Å–µ—Ä–µ–º—ñ–∑.",
                onboardWelcomeText2: "‚Ä¢ –¢—ñ—Ä–∫–µ—É –º–∏—Å—Å–∏—è–Ω—ã –±–∞–ø—Ç–∞—É –∂”ô–Ω–µ –∞–Ω–æ–Ω–∏–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∂–∏–Ω–∞—É “Ø—à—ñ–Ω “õ–∞–∂–µ—Ç.",
                onboardWelcomeText3: "‚Ä¢ –ë“±–ª < 1 –º–∏–Ω—É—Ç –∞–ª–∞–¥—ã.",
                onboardWelcomeBtn: "–ü–∞—Å–ø–æ—Ä—Ç—Ç—ã —Ç–æ–ª—Ç—ã—Ä—É",
                onboardCompleteMsg: "“ö–æ—à –∫–µ–ª–¥—ñ“£—ñ–∑, ${callsign}! –¢–µ—Ä–≥–µ—É–¥—ñ –±–∞—Å—Ç–∞“£—ã–∑.",
                formTitle: "–ê–≥–µ–Ω—Ç –ø–∞—Å–ø–æ—Ä—Ç—ã",
                formProgress: "–ü—Ä–æ–≥—Ä–µ—Å—Å: 2-“õ–∞–¥–∞–º 3-—Ç–µ–Ω",
                formCallsign: "–ê–≥–µ–Ω—Ç—Ç—ñ“£ –ª–∞“õ–∞–ø –∞—Ç—ã",
                formCallsignPlaceholder: "–ú—ã—Å–∞–ª—ã: Agent Nova",
                formCallsignSmall: "–ë“±–ª —Å—ñ–∑–¥—ñ“£ –∂–∞—Ä–∏—è –Ω–∏–∫—ñ“£—ñ–∑; –∂–µ–∫–µ –¥–µ—Ä–µ–∫—Ç–µ—Ä —Å“±—Ä–∞–ª–º–∞–π–¥—ã.",
                formGender: "–ñ—ã–Ω—ã—Å—ã",
                formGenderNote: "(“õ–∞–±—ã–ª–¥–∞—É–¥—ã —Ç–∞–ª–¥–∞—É “Ø—à—ñ–Ω)",
                formGenderFemale: "”ò–π–µ–ª",
                formGenderMale: "–ï—Ä",
                formGenderNonbinary: "–ë–∏–Ω–∞—Ä –µ–º–µ—Å",
                formGenderSkip: "–ö”©—Ä—Å–µ—Ç–ø–µ—É",
                formGenderOther: "–ë–∞—Å“õ–∞",
                formGenderOtherPlaceholder: "–ö”©—Ä—Å–µ—Ç—ñ“£—ñ–∑",
                formAge: "–ñ–∞—Å —Ç–æ–±—ã",
                formAgeUnder18: "<18 –∂–∞—Å",
                formAge18_25: "18‚Äì25 –∂–∞—Å",
                formAge26_35: "26‚Äì35 –∂–∞—Å",
                formAge36_45: "36‚Äì45 –∂–∞—Å",
                formAge46plus: "46+ –∂–∞—Å",
                formRegion: "–ê–π–º–∞“õ / “ö–∞–ª–∞",
                formBtnBack: "–ê—Ä—Ç“õ–∞",
                formBtnNext: "–ö–µ–ª–µ—Å—ñ",
                regionNurSultan: "–ù“±—Ä‚Äë–°“±–ª—Ç–∞–Ω",
                regionAlmaty: "–ê–ª–º–∞—Ç—ã",
                regionShymkent: "–®—ã–º–∫–µ–Ω—Ç",
                regionKaraganda: "“ö–∞—Ä–∞“ì–∞–Ω–¥—ã",
                regionAktobe: "–ê“õ—Ç”©–±–µ",
                regionKostanay: "“ö–æ—Å—Ç–∞–Ω–∞–π",
                regionAktau: "–ê“õ—Ç–∞—É",
                regionAtyrau: "–ê—Ç—ã—Ä–∞—É",
                regionPavlodar: "–ü–∞–≤–ª–æ–¥–∞—Ä",
                regionEkibastuz: "–ï–∫—ñ–±–∞—Å—Ç“±–∑",
                regionPetropavlovsk: "–ü–µ—Ç—Ä–æ–ø–∞–≤–ª",
                regionOral: "–û—Ä–∞–ª",
                regionKokshetau: "–ö”©–∫—à–µ—Ç–∞—É",
                regionSemey: "–°–µ–º–µ–π",
                regionOskemen: "”®—Å–∫–µ–º–µ–Ω",
                regionKyzylorda: "“ö—ã–∑—ã–ª–æ—Ä–¥–∞",
                regionTaraz: "–¢–∞—Ä–∞–∑",
                regionTaldykorgan: "–¢–∞–ª–¥—ã“õ–æ—Ä“ì–∞–Ω",
                regionTurkestan: "–¢“Ø—Ä–∫—ñ—Å—Ç–∞–Ω",
                regionZhanaozen: "–ñ–∞–Ω–∞–æ–∑–µ–Ω",
                regionZhezkazgan: "–ñ–µ–∑“õ–∞–∑“ì–∞–Ω",
                regionKaratau: "“ö–∞—Ä–∞—Ç–∞—É",
                consentTitle: "–ê–≥–µ–Ω—Ç –¥–µ—Ä–µ–∫—Ç–µ—Ä—ñ–Ω —Ç–µ–∫—Å–µ—Ä—É",
                consentProgress: "–ü—Ä–æ–≥—Ä–µ—Å—Å: 3-“õ–∞–¥–∞–º 3-—Ç–µ–Ω",
                consentSummaryCallsign: "–õ–∞“õ–∞–ø –∞—Ç—ã:",
                consentSummaryGender: "–ñ—ã–Ω—ã—Å—ã:",
                consentSummaryAge: "–ñ–∞—Å—ã:",
                consentSummaryRegion: "–ê–π–º–∞“õ:",
                consentExplainTitle: "–î–µ—Ä–µ–∫—Ç–µ—Ä —Ç—É—Ä–∞–ª—ã “õ–∞—Ä–∞–ø–∞–π—ã–º —Å”©–∑–±–µ–Ω:",
                consentExplainText: "–ë—ñ–∑ —Ç–µ–∫ –∞–Ω–æ–Ω–∏–º –∂–∞—É–∞–ø—Ç–∞—Ä –º–µ–Ω –æ–π—ã–Ω ”ô—Ä–µ–∫–µ—Ç—Ç–µ—Ä—ñ–Ω –∂–∏–Ω–∞–π–º—ã–∑ (—Ç–∞“£–¥–∞—É, —Ä–µ–∞–∫—Ü–∏—è —É–∞“õ—ã—Ç—ã, “õ–∞—Ç–µ–ª–µ—Ä/—Å”ô—Ç—Ç—ñ–ª—ñ–∫). –ñ–µ–∫–µ –¥–µ—Ä–µ–∫—Ç–µ—Ä (–∞—Ç—ã-–∂”©–Ω—ñ, —Ç–µ–ª–µ—Ñ–æ–Ω –∂”ô–Ω–µ —Ç.–±.) ‚Äî –∂–æ“õ.",
                consentData: "–ú–µ–Ω—ñ“£ –∞–Ω–æ–Ω–∏–º –¥–µ—Ä–µ–∫—Ç–µ—Ä—ñ–º–¥—ñ –∑–µ—Ä—Ç—Ç–µ—É –∂”ô–Ω–µ –æ–π—ã–Ω–¥—ã –∂–∞“õ—Å–∞—Ä—Ç—É “Ø—à—ñ–Ω ”©“£–¥–µ—É–≥–µ –∫–µ–ª—ñ—Å–µ–º—ñ–Ω.",
                consentAge: "–ú–∞“ì–∞–Ω 16 –∂–∞—Å –∂”ô–Ω–µ –æ–¥–∞–Ω –∫”©–ø.",
                consentBtnMoreInfo: "–î–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ “õ–æ—Ä“ì–∞—É —Ç—É—Ä–∞–ª—ã —Ç–æ–ª—ã“ì—ã—Ä–∞“õ",
                consentBtnBack: "–ê—Ä—Ç“õ–∞",
                consentBtnActivate: "–ê–≥–µ–Ω—Ç –ø—Ä–æ—Ñ–∏–ª—ñ–Ω —ñ—Å–∫–µ “õ–æ—Å—É",
                onboardCompleteMsg: "–°”ô–π–∫–µ—Å—Ç–µ–Ω–¥—ñ—Ä—É –∞—è“õ—Ç–∞–ª–¥—ã. –ú–∏—Å—Å–∏—è“ì–∞ “õ–æ—à –∫–µ–ª–¥—ñ“£—ñ–∑, {callsign}!",
                modalTitle: "–î–µ—Ä–µ–∫—Ç–µ—Ä—ñ“£—ñ–∑–¥—ñ “õ–∞–ª–∞–π ”©“£–¥–µ–π–º—ñ–∑",
                modalWho: "–î–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ ”©“£–¥–µ—É—à—ñ:",
                modalWhoText: "'Digital Truth' –∂–æ–±–∞—Å—ã–Ω—ã“£ –∫–æ–º–∞–Ω–¥–∞—Å—ã.",
                modalWhat: "–ù–µ –∂–∏–Ω–∞–π–º—ã–∑:",
                modalWhatText: "–∂—ã–Ω—ã—Å—ã, –∂–∞—Å –¥–∏–∞–ø–∞–∑–æ–Ω—ã, –∞–π–º–∞“õ, —Å“±—Ä–∞“õ—Ç–∞—Ä“ì–∞ –∂–∞—É–∞–ø –∂”ô–Ω–µ –æ–π—ã–Ω ”ô—Ä–µ–∫–µ—Ç—Ç–µ—Ä—ñ (—Ä–µ–∞–∫—Ü–∏—è —É–∞“õ—ã—Ç—ã, —à–µ—à—ñ–º–¥–µ—Ä, —Å”ô—Ç—Ç—ñ–ª—ñ–∫/“õ–∞—Ç–µ).",
                modalGoal: "–ú–∞“õ—Å–∞—Ç:",
                modalGoalText: "—Ü–∏—Ñ—Ä–ª—ã“õ –∞“õ–ø–∞—Ä–∞—Ç—Ç—ã “õ–∞–±—ã–ª–¥–∞—É–¥—ã –∑–µ—Ä—Ç—Ç–µ—É –∂”ô–Ω–µ –æ–π—ã–Ω –º–µ—Ö–∞–Ω–∏–∫–∞—Å—ã–Ω –∂–∞“õ—Å–∞—Ä—Ç—É.",
                modalLaw: "“ö“±“õ—ã“õ—Ç—ã“õ –Ω–µ–≥—ñ–∑:",
                modalLawText: "“õ–∞—Ç—ã—Å—É—à—ã–Ω—ã“£ –µ—Ä—ñ–∫—Ç—ñ –∫–µ–ª—ñ—Å—ñ–º—ñ.",
                modalTerm: "–°–∞“õ—Ç–∞—É –º–µ—Ä–∑—ñ–º—ñ:",
                modalTermText: "–∑–µ—Ä—Ç—Ç–µ—É –∞—è“õ—Ç–∞–ª“ì–∞–Ω“ì–∞ –¥–µ–π—ñ–Ω (24 –∞–π–¥–∞–Ω –∞—Å–ø–∞–π–¥—ã), –∫–µ–π—ñ–Ω –¥–µ—Ä–µ–∫—Ç–µ—Ä –∂–æ–π—ã–ª–∞–¥—ã –Ω–µ–º–µ—Å–µ —Ç–µ–∫ –∞–≥—Ä–µ–≥–∞—Ç—Ç–∞–ª“ì–∞–Ω —Ç“Ø—Ä–¥–µ “õ–∞–ª–∞–¥—ã.",
                modalThird: "“Æ—à—ñ–Ω—à—ñ —Ç“±–ª“ì–∞–ª–∞—Ä“ì–∞ –±–µ—Ä—É:",
                modalThirdText: "—Ç–µ–∫ –∞–Ω–æ–Ω–∏–º–¥—ñ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç“Ø—Ä—ñ–Ω–¥–µ.",
                modalContact: "–°“±—Ä–∞“õ—Ç–∞—Ä –Ω–µ–º–µ—Å–µ –∫–µ–ª—ñ—Å—ñ–º–Ω–µ–Ω –±–∞—Å —Ç–∞—Ä—Ç—É “Ø—à—ñ–Ω: support@digitaltruth.game",
                modalBtn: "–¢“Ø—Å—ñ–Ω—ñ–∫—Ç—ñ",
                startBadge: "–°–∞–Ω–¥—ã“õ “õ“±—Ç“õ–∞—Ä—É—à—ã —Ç–æ–±—ã ‚Ä¢ v2.0",
                startTitle: "–°–µ–Ω ‚Äî —Ñ–∞–∫—Ç –¥–µ—Ç–µ–∫—Ç–∏–≤—ñ—Å—ñ“£",
                startSubtitle: "–°–∞—Ä–∞–ø—Ç–∞: <span class=\"kbd\">–®—ã–Ω–¥—ã“õ</span> –Ω–µ–º–µ—Å–µ <span class=\"kbd\">–ñ–∞–ª“ì–∞–Ω</span>. –°–æ—Å—ã–Ω —à–µ—à—ñ–º “õ–∞–±—ã–ª–¥–∞ ‚Äî <b>–∫—ñ–º–¥—ñ “õ“±—Ç“õ–∞—Ä—É</b>. –†–µ–ø—É—Ç–∞—Ü–∏—è –∂–∏–Ω–∞–ø, –ö–µ“£–µ—Å—Ç—ñ“£ –º–∞“õ—Ç–∞—É—ã–Ω –∞–ª.",
                btnStart: "–¢–µ—Ä–≥–µ—É–¥—ñ –±–∞—Å—Ç–∞—É",
                btnHow: "–ï—Ä–µ–∂–µ–ª–µ—Ä",
                btnRestart: "“ö–∞–π—Ç–∞ –æ–π–Ω–∞—É",
                btnShare: "–ù”ô—Ç–∏–∂–µ–Ω—ñ –∫”©—à—ñ—Ä—É",
                caseNo: "–Ü—Å ‚Äî {current} / {total}",
                rep: "–†–µ–ø—É—Ç–∞—Ü–∏—è: {rep}",
                caseTag: "–û“õ–∏“ì–∞ ‚Ä¢ ",
                caseDifficulty: "–î–µ“£–≥–µ–π",
                caseTitle: "–Ü—Å –∞—Ç–∞—É—ã",
                caseNarrative: "–°–∏–ø–∞—Ç—Ç–∞–º–∞",
                caseEvidenceTitle: "–î”ô–ª–µ–ª–¥–µ—Ä:",
                caseDecisionTitle: "–®–µ—à—ñ–º: –∫—ñ–º–¥—ñ “õ“±—Ç“õ–∞—Ä—É?",
                caseTip: "–ö–µ“£–µ—Å: –±–∞—Ä–ª—ã“õ –¥”ô–ª–µ–ª–¥—ñ <i>–®—ã–Ω–¥—ã“õ</i> –Ω–µ–º–µ—Å–µ <i>–ñ–∞–ª“ì–∞–Ω</i> –¥–µ–ø –±–µ–ª–≥—ñ–ª–µ, —Å–æ—Å—ã–Ω –∫—ñ–º–¥—ñ “õ“±—Ç“õ–∞—Ä—É–¥—ã —Ç–∞“£–¥–∞.",
                evidence: "–î”ô–ª–µ–ª",
                evScore: "–ë–µ–ª–≥—ñ–ª–µ–Ω–¥—ñ: {done} / {total}",
                choiceTitle: "–®–µ—à—ñ–º: –∫—ñ–º–¥—ñ “õ“±—Ç“õ–∞—Ä—É?",
                choiceReputation: "–®–µ—à—ñ–º —Ä–µ–ø—É—Ç–∞—Ü–∏—è“ì–∞ ”ô—Å–µ—Ä –µ—Ç–µ–¥—ñ.",
                truthBtn: "–®—ã–Ω–¥—ã“õ",
                lieBtn: "–ñ–∞–ª“ì–∞–Ω",
                hintBtn: "–ê–Ω—ã“õ—Ç–∞–º–∞",
                btnCheck: "–Ü—Å—Ç—ñ —Ç–µ–∫—Å–µ—Ä—É",
                btnSkip: "”®—Ç–∫—ñ–∑—ñ–ø –∂—ñ–±–µ—Ä—É",
                endTitle: "–ú–∏—Å—Å–∏—è –∞—è“õ—Ç–∞–ª–¥—ã",
                endText: "–°—ñ–∑ —Ç–µ—Ä–≥–µ—É–¥—ñ –∞—è“õ—Ç–∞–¥—ã“£—ã–∑",
                rank: "–î”ô—Ä–µ–∂–µ",
                toastCaseClosed: "–Ü—Å –∂–∞–±—ã–ª–¥—ã: +{points} —Ä–µ–ø—É—Ç–∞—Ü–∏—è",
                toastSkipped: "–Ü—Å ”©—Ç–∫—ñ–∑—ñ–ª–¥—ñ",
                toastCopied: "–ë—É—Ñ–µ—Ä–≥–µ –∫”©—à—ñ—Ä—ñ–ª–¥—ñ",
                toastHintUnavailable: "–ö–µ“£–µ—Å “õ–æ–ª–∂–µ—Ç—ñ–º—Å—ñ–∑",
                toastHow: "–î”ô–ª–µ–ª–¥–µ—Ä–¥—ñ –®—ã–Ω–¥—ã“õ/–ñ–∞–ª“ì–∞–Ω –¥–µ–ø –±–µ–ª–≥—ñ–ª–µ, —Å–æ—Å—ã–Ω –∫—ñ–º–¥—ñ “õ“±—Ç“õ–∞—Ä—É–¥—ã —Ç–∞“£–¥–∞. “∞–ø–∞–π = –¥”ô–ª–¥—ñ–∫ + –¥“±—Ä—ã—Å —Ç–∞“£–¥–∞—É.",
                endRankNew: "–ñ–∞“£–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫",
                endPraiseNew: "–ñ–∞–º–∞–Ω –µ–º–µ—Å. –ë–∞–∑–∞ –±–∞—Ä ‚Äî —à–µ—à—ñ–º —Å–∞–ø–∞—Å—ã–Ω –∞—Ä—Ç—Ç—ã—Ä–∞–º—ã–∑.",
                endRankFact: "–§–∞–∫—Ç—á–µ–∫–µ—Ä",
                endPraiseFact: "–°–µ–Ω —Å–∏–≥–Ω–∞–ª –º–µ–Ω —à—É–¥—ã –∂–∞“õ—Å—ã –∞–∂—ã—Ä–∞—Ç–∞ –∞–ª–∞—Å—ã“£.",
                endRankCurator: "–®—ã–Ω–¥—ã“õ –∫—É—Ä–∞—Ç–æ—Ä—ã",
                endPraiseCurator: "–ú–∞“£—ã–∑–¥—ã–Ω—ã ‚Äî –∞–¥–∞–º–¥–∞—Ä –º–µ–Ω –¥–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ ‚Äî —Ç“±—Ä–∞“õ—Ç—ã “õ“±—Ç“õ–∞—Ä–∞—Å—ã“£.",
                endRankSavior: "–®—ã–Ω–¥—ã“õ—Ç—ã “õ“±—Ç“õ–∞—Ä—É—à—ã",
                endPraiseSavior: "–ö–µ“£–µ—Å “õ–æ–ª —à–∞–ø–∞–ª–∞“õ—Ç–∞–π–¥—ã. –°–µ–Ω—ñ“£ —Ç–∞–ª–¥–∞—É—ã“£ ‚Äî —ç—Ç–∞–ª–æ–Ω.",
                endResult: "“ö–æ—Ä—ã—Ç—ã–Ω–¥—ã —Ä–µ–ø—É—Ç–∞—Ü–∏—è",
                // ...existing game translations...
            }
        };

        function getLang() {
            return localStorage.getItem("lang") || "ru";
        }
        function setLang(lang) {
            localStorage.setItem("lang", lang);
        }
        function t(key, vars = {}) {
            const lang = getLang();
            let str = TRANSLATIONS[lang][key] || TRANSLATIONS["ru"][key] || key;
            Object.entries(vars).forEach(([k, v]) => {
                str = str.replace(`{${k}}`, v);
            });
            return str;
        }

        function updateI18nUI() {
            // Language options
            $("#langRu").textContent = t("langRu");
            $("#langKk").textContent = t("langKk");

            // Header
            const headerTitle = $("#mainTitle");
            if (headerTitle) headerTitle.textContent = t("mainTitle");
            updateHeader();
            
            // –ï—Å–ª–∏ –∞–∫—Ç–∏–≤–µ–Ω —ç–∫—Ä–∞–Ω –∫–µ–π—Å–∞, –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –µ–≥–æ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–Ω–æ–ø–æ–∫
            const caseSection = $("#case");
            if (caseSection && caseSection.style.display !== "none") {
                renderCase();
            }

            // Splash screen
            const splashBadgeEl = $("#splashBadgeEl");
            if (splashBadgeEl) splashBadgeEl.textContent = t("splashBadge");
            const splashTitleEl = $("#splashTitleEl");
            if (splashTitleEl) splashTitleEl.textContent = t("splashTitle");
            const splashSubtitleEl = $("#splashSubtitleEl");
            if (splashSubtitleEl) splashSubtitleEl.textContent = t("splashSubtitle");
            const btnOnboard = $("#btnOnboard");
            if (btnOnboard) btnOnboard.textContent = t("splashBtn");

            // Onboard welcome
            const onboardWelcomeTitleEl = $("#onboardWelcomeTitleEl");
            if (onboardWelcomeTitleEl) onboardWelcomeTitleEl.textContent = t("onboardWelcomeTitle");
            const onboardText1El = $("#onboardText1El");
            if (onboardText1El) onboardText1El.textContent = t("onboardWelcomeText1");
            const onboardText2El = $("#onboardText2El");
            if (onboardText2El) onboardText2El.textContent = t("onboardWelcomeText2");
            const onboardText3El = $("#onboardText3El");
            if (onboardText3El) onboardText3El.textContent = t("onboardWelcomeText3");
            const btnFormStart = $("#btnFormStart");
            if (btnFormStart) btnFormStart.textContent = t("onboardWelcomeBtn");

            // Onboard form
            const formTitleEl = $("#formTitleEl");
            if (formTitleEl) formTitleEl.textContent = t("formTitle");
            const formProgressEl = $("#formProgressEl");
            if (formProgressEl) formProgressEl.textContent = t("formProgress");

            // Form callsign
            const formCallsignEl = $("#formCallsignEl");
            if (formCallsignEl) formCallsignEl.textContent = t("formCallsign");
            const callsign = $("#callsign");
            if (callsign) callsign.placeholder = t("formCallsignPlaceholder");
            const formCallsignSmallEl = $("#formCallsignSmallEl");
            if (formCallsignSmallEl) formCallsignSmallEl.textContent = t("formCallsignSmall");

            // Form gender
            const formGenderEl = $("#formGenderEl");
            if (formGenderEl) formGenderEl.textContent = t("formGender");
            const formGenderNoteEl = $("#formGenderNoteEl");
            if (formGenderNoteEl) formGenderNoteEl.textContent = t("formGenderNote");
            const genderFemaleEl = $("#genderFemaleEl");
            if (genderFemaleEl) genderFemaleEl.textContent = t("formGenderFemale");
            const genderMaleEl = $("#genderMaleEl");
            if (genderMaleEl) genderMaleEl.textContent = t("formGenderMale");
            const genderNonbinaryEl = $("#genderNonbinaryEl");
            if (genderNonbinaryEl) genderNonbinaryEl.textContent = t("formGenderNonbinary");
            const genderSkipEl = $("#genderSkipEl");
            if (genderSkipEl) genderSkipEl.textContent = t("formGenderSkip");
            const genderOtherLabelEl = $("#genderOtherLabelEl");
            if (genderOtherLabelEl) genderOtherLabelEl.textContent = t("formGenderOther");
            const genderOther = $("#genderOther");
            if (genderOther) genderOther.placeholder = t("formGenderOtherPlaceholder");

            // Form age
            const formAgeEl = $("#formAgeEl");
            if (formAgeEl) formAgeEl.textContent = t("formAge");
            const ageUnder18El = $("#ageUnder18El");
            if (ageUnder18El) ageUnder18El.textContent = t("formAgeUnder18");
            const age18_25El = $("#age18_25El");
            if (age18_25El) age18_25El.textContent = t("formAge18_25");
            const age26_35El = $("#age26_35El");
            if (age26_35El) age26_35El.textContent = t("formAge26_35");
            const age36_45El = $("#age36_45El");
            if (age36_45El) age36_45El.textContent = t("formAge36_45");
            const age46plusEl = $("#age46plusEl");
            if (age46plusEl) age46plusEl.textContent = t("formAge46plus");

            // Form region
            const formRegionEl = $("#formRegionEl");
            if (formRegionEl) formRegionEl.textContent = t("formRegion");
            const regionKeys = ["regionNurSultan", "regionAlmaty", "regionShymkent", "regionKaraganda", "regionAktobe", "regionKostanay", "regionAktau", "regionAtyrau", "regionPavlodar", "regionEkibastuz", "regionPetropavlovsk", "regionOral", "regionKokshetau", "regionSemey", "regionOskemen", "regionKyzylorda", "regionTaraz", "regionTaldykorgan", "regionTurkestan", "regionZhanaozen", "regionZhezkazgan", "regionKaratau"];
            regionKeys.forEach(key => {
                const el = $(`#region${key.charAt(6).toUpperCase() + key.slice(7)}El`);
                if (el) el.textContent = t(key);
            });


            // Form buttons
            const btnFormBack = $("#btnFormBack");
            if (btnFormBack) btnFormBack.textContent = t("formBtnBack");
            const btnFormNext = $("#btnFormNext");
            if (btnFormNext) btnFormNext.textContent = t("formBtnNext");

            // Pozyvnoy
            $all("#onboard-form label").forEach(label => {
                if (label.textContent.includes("–ü–æ–∑—ã–≤–Ω–æ–π –∞–≥–µ–Ω—Ç–∞") || label.textContent.includes("–ê–≥–µ–Ω—Ç—Ç—ñ“£ –ª–∞“õ–∞–ø –∞—Ç—ã")) {
                    label.innerHTML = `${t("formCallsign")} <span style='color:var(--warn)'>*</span>`;
                }
                if (label.textContent.includes("–ü–æ–ª") || label.textContent.includes("–ñ—ã–Ω—ã—Å—ã")) {
                    label.innerHTML = `${t("formGender")} <span style='color:var(--warn)'>*</span> <span style='color:var(--muted); font-weight:400; font-size:12px'>${t("formGenderNote")}</span>`;
                }
                if (label.textContent.includes("–í–æ–∑—Ä–∞—Å—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞") || label.textContent.includes("–ñ–∞—Å —Ç–æ–±—ã")) {
                    label.innerHTML = `${t("formAge")} <span style='color:var(--warn)'>*</span>`;
                }
                if (label.textContent.includes("–†–µ–≥–∏–æ–Ω") || label.textContent.includes("–ê–π–º–∞“õ")) {
                    label.innerHTML = `${t("formRegion")} <span style='color:var(--warn)'>*</span>`;
                }
            });



            // Region select
            const regionOptions = $all("#region option");
            if (regionOptions) {
                regionOptions.forEach((opt, i) => {
                    if (i === 0) opt.textContent = "‚Äî";
                    else if (regionKeys[i - 1]) opt.textContent = t(regionKeys[i - 1]);
                });
            }


            // Consent screen
            const consentTitle = $("#onboard-consent .title");
            if (consentTitle) consentTitle.textContent = t("consentTitle");
            const consentPs = $all("#onboard-consent > p");
            if (consentPs && consentPs[0]) consentPs[0].textContent = t("consentProgress");

            const summaryLabels = ["consentSummaryCallsign", "consentSummaryGender", "consentSummaryAge", "consentSummaryRegion"];
            $all("#onboard-consent .grid div span[style*='color:var(--muted)']").forEach((el, i) => {
                if (summaryLabels[i]) el.textContent = t(summaryLabels[i]);
            });
            $all("#onboard-consent .grid div span[id^='summary']").forEach((el) => { el.textContent = "‚Äî"; });

            const explainDiv = $("#onboard-consent div[style*='background:rgba']");
            if (explainDiv) {
                const strongEl = explainDiv.querySelector("strong");
                const pEl = explainDiv.querySelector("p");
                if (strongEl) strongEl.textContent = t("consentExplainTitle");
                if (pEl) pEl.textContent = t("consentExplainText");
            }

            const consentLabels = $all("#consentForm label");
            if (consentLabels && consentLabels.length >= 2) {
                const span0 = consentLabels[0].querySelector("span");
                if (span0) span0.textContent = t("consentData");
                const ageSpan = consentLabels[1].querySelector("span");
                if (ageSpan) ageSpan.innerHTML = t("consentAge") + " <span style='color:var(--muted)'>*</span>";
            }

            const btnMoreInfo = $("#btnMoreInfo");
            if (btnMoreInfo) btnMoreInfo.textContent = t("consentBtnMoreInfo");
            const btnConsentBack = $("#btnConsentBack");
            if (btnConsentBack) btnConsentBack.textContent = t("consentBtnBack");
            const btnActivate = $("#btnActivate");
            if (btnActivate) btnActivate.textContent = t("consentBtnActivate");

            // Modal
            const modalTitle = $("#infoModal h3");
            if (modalTitle) modalTitle.textContent = t("modalTitle");

            const btnCloseModal = $("#btnCloseModal");
            if (btnCloseModal) btnCloseModal.textContent = "√ó";

            const modalPs = $all("#infoModal div[style*='font-size:13px'] p");
            if (modalPs && modalPs.length >= 7) {
                modalPs[0].innerHTML = `<strong>${t("modalWho")}</strong> ${t("modalWhoText")}`;
                modalPs[1].innerHTML = `<strong>${t("modalWhat")}</strong> ${t("modalWhatText")}`;
                modalPs[2].innerHTML = `<strong>${t("modalGoal")}</strong> ${t("modalGoalText")}`;
                modalPs[3].innerHTML = `<strong>${t("modalLaw")}</strong> ${t("modalLawText")}`;
                modalPs[4].innerHTML = `<strong>${t("modalTerm")}</strong> ${t("modalTermText")}`;
                modalPs[5].innerHTML = `<strong>${t("modalThird")}</strong> ${t("modalThirdText")}`;
                modalPs[6].textContent = t("modalContact");
            }
            const btnCloseInfo = $("#btnCloseInfo");
            if (btnCloseInfo) btnCloseInfo.textContent = t("modalBtn");

            // Start screen
            const startBadgeEl = document.querySelector("#start .badge");
            if (startBadgeEl) startBadgeEl.textContent = t("startBadge");
            const startTitleEl = document.querySelector("#start .title");
            if (startTitleEl) startTitleEl.textContent = t("startTitle");
            const startSubEl = document.querySelector("#start .subtitle");
            if (startSubEl) startSubEl.innerHTML = t("startSubtitle");
            const btnStartEl = $("#btnStart");
            if (btnStartEl) btnStartEl.textContent = t("btnStart");
            const btnHowEl = $("#btnHow");
            if (btnHowEl) btnHowEl.textContent = t("btnHow");

            // Case screen
            const caseEvidTitleEl = $("#caseEvidenceTitleEl");
            if (caseEvidTitleEl) caseEvidTitleEl.textContent = t("caseEvidenceTitle");
            const caseDecTitleEl = $("#caseDecisionTitleEl");
            if (caseDecTitleEl) caseDecTitleEl.textContent = t("caseDecisionTitle");
            const btnCheckEl = $("#btnCheck");
            if (btnCheckEl) btnCheckEl.textContent = t("btnCheck");
            const btnSkipEl = $("#btnSkip");
            if (btnSkipEl) btnSkipEl.textContent = t("btnSkip");
            const caseTipEl = $("#caseTipEl");
            if (caseTipEl) caseTipEl.innerHTML = t("caseTip");

            // End screen
            const endTitle = $("#endTitle");
            if (endTitle) endTitle.textContent = t("endTitle");
            const btnRestart = $("#btnRestart");
            if (btnRestart) btnRestart.textContent = t("btnRestart");
            const btnShare = $("#btnShare");
            if (btnShare) btnShare.textContent = t("btnShare");
            const rank = $("#rank");
            if (rank) rank.textContent = t("rank");
        }

        /** ======== –ù–û–í–´–ï –ö–ê–ó–ê–•–°–ö–ò–ï –ö–ï–ô–°–´ (12 —à—Ç) ======== */
        const CASES_ALL_NEW = [
            {
                tag: "–§–µ–π–∫-–Ω–æ–≤–æ—Å—Ç–∏",
                difficulty: "–û—Ä—Ç–∞—à–∞",
                title: "–ê—É—Ä—É—Ö–∞–Ω–∞–¥–∞ –≤–∞–∫—Ü–∏–Ω–∞–Ω—ã –∂–∞—Å—ã—Ä—ã–Ω –∞—É—ã—Å—Ç—ã—Ä—ã–ø –∂–∞—Ç—ã—Ä",
                narrative: "–ñ–µ–ª—ñ–¥–µ “õ–∞–ª–∞–¥–∞“ì—ã ‚Ññ5 –∞—É—Ä—É—Ö–∞–Ω–∞–¥–∞ –≤–∞–∫—Ü–∏–Ω–∞–Ω—ã ‚Äú–∞—Ä–∑–∞–Ω—ã–Ω–∞ –∞—É—ã—Å—Ç—ã—Ä—ã–ø –∂–∞—Ç—ã—Ä‚Äù –¥–µ–≥–µ–Ω —Ö–∞–±–∞—Ä —Ç–∞—Ä–∞–ø –∫–µ—Ç—Ç—ñ. –ü–∞–π–¥–∞–ª–∞–Ω—É—à—ã–ª–∞—Ä –±—ñ—Ä –º–µ–¥–±–∏–∫–µ —Ç—É—Ä–∞–ª—ã –≤–∏–¥–µ–æ“ì–∞ —Å“Ø–π–µ–Ω—ñ–ø, ‚Äú–º–µ–¥“õ—ã–∑–º–µ—Ç–∫–µ—Ä–ª–µ—Ä ”©–∑–¥–µ—Ä—ñ –∞–π—Ç—ã–ø “õ–æ–π–¥—ã‚Äù –¥–µ–ø —Ç–∞—Ä–∞—Ç—ã–ø –∂–∞—Ç—ã—Ä.",
                evidence: [
                    {
                        text: "–ë—ñ—Ä TikTok –≤–∏–¥–µ–æ–¥–∞ –º–µ–¥–±–∏–∫–µ '–±“±–ª –≤–∞–∫—Ü–∏–Ω–∞ –º“Ø–ª–¥–µ –±–∞—Å“õ–∞—à–∞ –±–æ–ª—ã–ø –∫–µ—Ç—Ç—ñ' –¥–µ–π–¥—ñ. –í–∏–¥–µ–æ –∞—Å—Ç—ã–Ω–¥–∞:'–¥–µ–º–µ–∫, –∞—É—ã—Å—Ç—ã—Ä—ã–ø –∂–∞—Ç—ã—Ä' –¥–µ–≥–µ–Ω —Å“±—Ä–∞“õ.",
                        isTruth: false,
                        hint: "–í–∏–¥–µ–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—Ç–µ–Ω –∂“±–ª—ã–Ω—ã–ø –∞–ª—ã–Ω“ì–∞–Ω –±–æ–ª—É—ã –º“Ø–º–∫—ñ–Ω. –ú–µ–¥–±–∏–∫–µ –±–∞—Å“õ–∞ –∂–∞“ì–¥–∞–π–¥—ã –∞–π—Ç–∞–¥—ã, –∞–ª –º–æ–Ω—Ç–∞–∂ —ç–º–æ—Ü–∏—è —Ç—É–¥—ã—Ä–∞–¥—ã."
                    },
                    {
                        text: "–í–∞–∫—Ü–∏–Ω–∞–Ω—ã“£ –µ–∫—ñ–Ω—à—ñ –∞–º–ø—É–ª–∞—Å—ã–Ω–¥–∞ —Å—Ç–∏–∫–µ—Ä “õ–∏—Å–∞–π—ã–ø –∂–∞–±—ã—Å—ã–ø —Ç“±—Ä ‚Äî “õ–æ–ª–¥–∞–Ω –∂–∞—Å–∞–ª“ì–∞–Ω —Å–∏—è“õ—Ç—ã.",
                        isTruth: false,
                        hint: "–°—Ç–∏–∫–µ—Ä–¥—ñ“£ “õ–∏—Å—ã“õ –±–æ–ª—É—ã –º—ñ–Ω–¥–µ—Ç—Ç—ñ —Ç“Ø—Ä–¥–µ “õ–æ–ª–¥–∞–Ω –∂–∞—Å–∞–ª–¥—ã –¥–µ–≥–µ–Ω–¥—ñ –±—ñ–ª–¥—ñ—Ä–º–µ–π–¥—ñ; ”©–Ω–¥—ñ—Ä—ñ—Å—Ç—ñ–∫ “õ–∞—Ç–µ–ª–µ—Ä –±–æ–ª—É—ã –º“Ø–º–∫—ñ–Ω."
                    },
                    {
                        text: "–ê—É—Ä—É—Ö–∞–Ω–∞ ”ô–∫—ñ–º—à—ñ–ª—ñ–≥—ñ –≤–∞–∫—Ü–∏–Ω–∞–ª–∞—Ä —Ç–µ–∫ –º–µ–º–ª–µ–∫–µ—Ç—Ç—ñ–∫ “õ–æ–π–º–∞–¥–∞–Ω –∫–µ–ª–µ—Ç—ñ–Ω—ñ–Ω —Ä–µ—Å–º–∏ —Ç“Ø—Ä–¥–µ –∂–∞—Ä–∏—è–ª–∞–¥—ã.",
                        isTruth: true,
                        hint: "–†–µ—Å–º–∏ –º”ô–ª—ñ–º–¥–µ–º–µ –±–∞—Ä, –±—ñ—Ä–∞“õ –∞–¥–∞–º–¥–∞—Ä —ç–º–æ—Ü–∏—è–ª—ã“õ –∫–æ–Ω—Ç–µ–Ω—Ç–∫–µ —Å–µ–Ω—É—ñ –º“Ø–º–∫—ñ–Ω."
                    },
                    {
                        text: "–¢–µ–ª–µ–≥—Ä–∞–º-–∫–∞–Ω–∞–ª: '–ë—ñ–∑–≥–µ –∞–Ω–æ–Ω–∏–º “õ—ã–∑–º–µ—Ç–∫–µ—Ä –∞–π—Ç—Ç—ã, –∞—Ä–∑–∞–Ω “õ—ã—Ç–∞–π –≤–∞–∫—Ü–∏–Ω–∞—Å—ã–Ω “õ—ã–º–±–∞—Ç –µ—É—Ä–æ–ø–∞–ª—ã“õ“õ–∞ –∞—É—ã—Å—Ç—ã—Ä—ã–ª–∞–¥—ã'.",
                        isTruth: false,
                        hint: "–ê–Ω–æ–Ω–∏–º –∫”©–∑–¥–µ—Ä ‚Äî —Ñ–µ–π–∫ –∂–∞“£–∞–ª—ã“õ—Ç–∞—Ä–¥—ã“£ –∂–∏—ñ “õ–æ–ª–¥–∞–Ω–∞—Ç—ã–Ω —Ç–∞–∫—Ç–∏–∫–∞—Å—ã."
                    },
                    {
                        text: "–ü—ñ–∫—ñ—Ä–¥–µ –∞–¥–∞–º: '–ú–µ–Ω—ñ“£ ”ô–∫–µ–º –∞—É—Ä—É—Ö–∞–Ω–∞–¥–∞ –∂“±–º—ã—Å —ñ—Å—Ç–µ–π–¥—ñ, –±”ô—Ä—ñ —Ä–∞—Å!' ‚Äî –∞–∫–∫–∞—É–Ω—Ç –ø—Ä–æ—Ñ–∏–ª—å—Å—ñ–∑.",
                        isTruth: false,
                        hint: "–§–µ–π–∫ –ø—ñ–∫—ñ—Ä–ª–µ—Ä ”ô–ª–µ—É–º–µ—Ç—Ç—ñ–∫ —Ä–∞—Å—Ç–∞—É –∏–ª–ª—é–∑–∏—è—Å—ã–Ω –∂–∞—Å–∞—É “Ø—à—ñ–Ω –∞—Ä–Ω–∞–π—ã –∂–∞–∑—ã–ª–∞–¥—ã."
                    }
                ],
                choices: [
                    { id: "hospital", label: "–°–ø–∞—Å—Ç–∏ –∞—É—Ä—É—Ö–∞–Ω–∞–Ω—ã: —Ñ–µ–π–∫—Ç—ñ —Ç–æ“õ—Ç–∞—Ç—ã–ø, –∞“õ–ø–∞—Ä–∞—Ç—Ç—ã“õ –µ—Å–∫–µ—Ä—Ç—É –∂–∞—Ä–∏—è–ª–∞—É" },
                    { id: "users", label: "–°–ø–∞—Å—Ç–∏ “õ–æ–ª–¥–∞–Ω—É—à—ã–ª–∞—Ä–¥—ã: –∞—É—Ä—É—Ö–∞–Ω–∞“ì–∞ “õ–æ—Å—ã–º—à–∞ —Ç–µ–∫—Å–µ—Ä—ñ—Å –µ–Ω–≥—ñ–∑—É –∂”ô–Ω–µ –µ—Å–∫–µ—Ä—Ç—É —Ç–∞—Ä–∞—Ç—É" }
                ],
                correctChoice: "hospital",
                praise: "–î“±—Ä—ã—Å. –°—ñ–∑ –∞—É–¥–∏—Ç–æ—Ä–∏—è–Ω—ã “õ–æ—Ä“ì–∞–ø, –º–∞–Ω–∏–ø—É–ª—è—Ü–∏—è–Ω—ã“£ —Ç–∞—Ä–∞–ª—É—ã–Ω–∞ –∂–æ–ª –±–µ—Ä–º–µ–¥—ñ“£—ñ–∑."
            },

            {
                tag: "–§–µ–π–∫-–Ω–æ–≤–æ—Å—Ç–∏",
                difficulty: "–û—Ä—Ç–∞—à–∞-–∫“Ø—Ä–¥–µ–ª—ñ",
                title: "Kaspi –ê–ª–∞“õ–∞–Ω: –∂–∞“£–∞ —Ñ—É–Ω–∫—Ü–∏—è–Ω—ã –∂–∞—Å—ã—Ä—ã–ø –æ—Ç—ã—Ä –º–∞?",
                narrative: "–ñ–µ–ª—ñ–¥–µ –∂–∞“£–∞ –≤–∏–¥–µ–æ —Ç–∞—Ä–∞–¥—ã: 'Kaspi –ê–ª–∞“õ–∞–Ω' –¥–µ–≥–µ–Ω –∂–∞—Å—ã—Ä—ã–Ω —Ñ—É–Ω–∫—Ü–∏—è “õ–æ—Å—ã–ª—ã–ø—Ç—ã. –ê–≤—Ç–æ—Ä: '–ê–ª–∞“õ–∞–Ω—ã“£–¥—ã –∫–∞–º–µ—Ä–∞“ì–∞ “õ–æ–π—Å–∞“£, Kaspi –±–∏–æ–º–µ—Ç—Ä–∏—è –∞—Ä“õ—ã–ª—ã –∂–∞–±—ã“õ –Ω–µ—Å–∏–µ –ª–∏–º–∏—Ç—ñ–Ω –∞—à–∞–¥—ã.' Kaspi —Ä–µ—Å–º–∏ —Ç“Ø—Ä–¥–µ —Ç–µ—Ä—ñ—Å–∫–µ —à—ã“ì–∞—Ä“ì–∞–Ω—ã–º–µ–Ω, “õ–æ–ª–¥–∞–Ω—É—à—ã–ª–∞—Ä–¥—ã“£ –±—ñ—Ä –±”©–ª—ñ–≥—ñ '–º–µ–Ω–¥–µ —à—ã“õ—Ç—ã' –¥–µ–ø –∂–∞–∑—ã–ø –∂–∞—Ç—ã—Ä.",
                evidence: [
                    {
                        text: "–í–∏–¥–µ–æ–¥–∞ –∞–≤—Ç–æ—Ä –∞–ª–∞“õ–∞–Ω—ã–Ω –∫”©—Ä—Å–µ—Ç–∫–µ–Ω–Ω–µ–Ω –∫–µ–π—ñ–Ω –ª–∏–º–∏—Ç –∞—à—ã–ª“ì–∞–Ω–¥–∞–π —ç—Ñ—Ñ–µ–∫—Ç “õ–æ—Å—ã–ª“ì–∞–Ω ‚Äî –∫–∞–¥—Ä–¥–∞ '–ë–µ–∫—ñ—Ç—ñ–ª–¥—ñ: 450 000 —Ç–≥' –¥–µ–≥–µ–Ω pop-up –∫”©—Ä—Å–µ—Ç—ñ–ª–µ–¥—ñ.",
                        isTruth: false,
                        hint: "–í–∏–¥–µ–æ–Ω—ã“£ –∫–µ–π –∫–∞–¥—Ä–ª–∞—Ä—ã –∫–µ—Å—ñ–ª–≥–µ–Ω, pop-up –¥”ô–ª —Å–æ–ª —Å”ô—Ç—Ç–µ —à—ã“õ“õ–∞–Ω—ã –∫”©—Ä—ñ–Ω–±–µ–π–¥—ñ. –≠—Ñ—Ñ–µ–∫—Ç –∫–µ–π—ñ–Ω “õ–æ—Å—ã–ª“ì–∞–Ω –±–æ–ª—É—ã –º“Ø–º–∫—ñ–Ω"
                    },
                    {
                        text: "–ú–µ—Ç–∞–¥–µ—Ä–µ–∫—Ç–µ—Ä–¥–µ 'biometric-hand-test' –¥–µ–≥–µ–Ω —Ñ–∞–π–ª –∞—Ç–∞—É—ã –±–∞—Ä —Å–∏—è“õ—Ç—ã.",
                        isTruth: false,
                        hint: "–§–∞–π–ª –∞—Ç–∞—É—ã–Ω –æ“£–∞–π ”©–∑–≥–µ—Ä—Ç—É–≥–µ –±–æ–ª–∞–¥—ã; –º–µ—Ç–∞–¥–µ—Ä–µ–∫—Ç–µ—Ä –∂–∞–ª“ì–∞–Ω –±–æ–ª—É—ã –º“Ø–º–∫—ñ–Ω."
                    },
                    {
                        text: "Kaspi —Ä–µ—Å–º–∏ —Ç“Ø—Ä–¥–µ: '–ë—ñ–∑–¥–µ –∞–ª–∞“õ–∞–Ω –±–∏–æ–º–µ—Ç—Ä–∏—è—Å—ã –∂–æ“õ' –¥–µ–ø —Ö–∞–±–∞—Ä–ª–∞–¥—ã.",
                        isTruth: true,
                        hint: "–†–µ—Å–º–∏ –º”ô–ª—ñ–º–¥–µ–º–µ —Å–µ–Ω—ñ–º–¥—ñ –¥–µ—Ä–µ–∫ —Ä–µ—Ç—ñ–Ω–¥–µ “õ–∞—Ä–∞–ª—É—ã —Ç–∏—ñ—Å."
                    },
                    {
                        text: "–ë–ª–æ–≥–µ—Ä: 'Kaspi –ê–ª–∞“õ–∞–Ω —Ç–µ–∫ –∫–µ–π –∞–∫–∫–∞—É–Ω—Ç—Ç–∞—Ä“ì–∞ “õ–æ—Å—ã–ª–¥—ã' –¥–µ–ø –∂–∞–∑“ì–∞–Ω.",
                        isTruth: false,
                        hint: "–ë–ª–æ–≥–µ—Ä–ª–µ—Ä engagement “Ø—à—ñ–Ω –æ—Å—ã–Ω–¥–∞–π –º”ô–ª—ñ–º–¥–µ–º–µ –∂–∞—Å–∞–ø, –∂–∞–ª“ì–∞–Ω ”ô—Å–µ—Ä —Ç—É–¥—ã—Ä—É—ã –º“Ø–º–∫—ñ–Ω."
                    },
                    {
                        text: "–ö–æ–º–º–µ–Ω—Ç—Ç–µ: '–ú–µ–Ω “õ–∞–∑—ñ—Ä 200 000 —Ç–≥ –∞–ª—ã–ø “õ–æ–π–¥—ã–º, –∂“±–º—ã—Å —ñ—Å—Ç–µ–π–¥—ñ' ‚Äî –∞–∫–∫–∞—É–Ω—Ç –∞–≤–∞—Ç–∞—Ä—ã–Ω–¥–∞ —à–µ—Ç–µ–ª –∞–∑–∞–º–∞—Ç—ã–Ω—ã“£ —Ñ–æ—Ç–æ—Å—ã –±–∞—Ä.",
                        isTruth: false,
                        hint: "–ú“±–Ω–¥–∞–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π–ª–µ—Ä —Ñ–µ–π–∫ —Å—Ö–µ–º–∞–ª–∞—Ä–¥–∞ –µ“£ –∂–∏—ñ “õ–æ–ª–¥–∞–Ω—ã–ª–∞—Ç—ã–Ω —Å–µ–Ω–¥—ñ—Ä—É—à—ñ —ç–ª–µ–º–µ–Ω—Ç."
                    }
                ],
                choices: [
                    { id: "user", label: "–°–ø–∞—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: –µ—Å–∫–µ—Ä—Ç—É –±–µ—Ä—É “ì–∞–Ω–∞" },
                    { id: "system", label: "–°–ø–∞—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—É: —Ñ–µ–π–∫—Ç—ñ —Ç–æ“õ—Ç–∞—Ç—ã–ø, —à–µ–∫—Ç–µ—É –µ–Ω–≥—ñ–∑—É" }
                ],
                correctChoice: "system",
                praise: "–¢–∞–∑–∞! –ö–ª–æ–Ω –∂–æ–π—ã–ª–¥—ã, —Å–µ–Ω—ñ–º —Å–∞“õ—Ç–∞–ª–¥—ã."
            },

            {
                tag: "–°–æ—Ü—Å–µ—Ç–∏",
                difficulty: "–û—Ä—Ç–∞—à–∞-–∫“Ø—Ä–¥–µ–ª—ñ",
                title: "–ë–ª–æ–≥–µ—Ä–¥—ñ“£ —Ñ–µ–π–∫ “õ–∞–π—ã—Ä—ã–º–¥—ã–ª—ã“õ –∂–∏–Ω–∞—É—ã",
                narrative: "–ñ–µ–ª—ñ–¥–µ —Ç–∞–Ω—ã–º–∞–ª –±–ª–æ–≥–µ—Ä —Å—ã—Ä“õ–∞—Ç –±–∞–ª–∞“ì–∞ –∞“õ—à–∞ –∂–∏–Ω–∞–ø –∂–∞—Ç“õ–∞–Ω—ã–Ω –∞–π—Ç—ã–ø, —à“±“ì—ã–ª –ø–æ—Å—Ç –∂–∞—Ä–∏—è–ª–∞–¥—ã. –û–ª –±–∞–ª–∞–Ω—ã“£ —Å—É—Ä–µ—Ç—ñ–Ω, –¥–∏–∞–≥–Ω–æ–∑—ã–Ω –∂”ô–Ω–µ '—à–µ—Ç –µ–ª–≥–µ –æ—Ç–∞“ì–∞ –∞“õ—à–∞ –∂–µ—Ç–ø–µ–π –∂–∞—Ç—ã—Ä' –¥–µ–≥–µ–Ω –º”ô—Ç—ñ–Ω “õ–æ—Å“õ–∞–Ω. –ü–∞–π–¥–∞–ª–∞–Ω—É—à—ã–ª–∞—Ä–¥—ã“£ –±—ñ—Ä –±”©–ª—ñ–≥—ñ —Å–µ–Ω–¥—ñ, –∞–ª –∫–µ–π–±—ñ—Ä—ñ —Ñ–µ–π–∫ –±–æ–ª—É—ã –º“Ø–º–∫—ñ–Ω –¥–µ–ø –∫“Ø–º”ô–Ω–¥–∞–Ω—É–¥–∞.",
                evidence: [
                    {
                        text: "–ë–ª–æ–≥–µ—Ä —Å–∞–ª“ì–∞–Ω —Å—É—Ä–µ—Ç –±–∞—Å“õ–∞ –µ–ª–¥–µ–≥—ñ –±–∞–ª–∞–Ω—ã“£ 2021 –∂—ã–ª“ì—ã —Ñ–æ—Ç–æ—Å—ã–º–µ–Ω —Å”ô–π–∫–µ—Å –∫–µ–ª–µ—Ç—ñ–Ω—ñ –∞–Ω—ã“õ—Ç–∞–ª–¥—ã.",
                        isTruth: true,
                        hint: "–ò–Ω—Ç–µ—Ä–Ω–µ—Ç—Ç–µ–≥—ñ –∫–µ–π —Å—É—Ä–µ—Ç—Ç–µ—Ä —Ñ–µ–π–∫ –∂–∏–Ω–∞–ª—ã–º–¥–∞—Ä–¥–∞ –∂–∏—ñ “õ–∞–π—Ç–∞ “õ–æ–ª–¥–∞–Ω—ã–ª–∞–¥—ã."
                    },
                    {
                        text: "–®–æ—Ç —Ä–µ–∫–≤–∏–∑–∏—Ç—Ç–µ—Ä—ñ –±–ª–æ–≥–µ—Ä–¥—ñ“£ –∂–µ–∫–µ –∫–∞—Ä—Ç–∞—Å—ã–Ω–∞ —Ç—ñ—Ä–∫–µ–ª–≥–µ–Ω.",
                        isTruth: true,
                        hint: "–ñ–µ–∫–µ –∫–∞—Ä—Ç–∞“ì–∞ –∂–∏–Ω–∞—É ‚Äî –∞–ª–∞—è“õ—Ç—ã“õ—Ç—ã“£ –∫–ª–∞—Å—Å–∏–∫–∞–ª—ã“õ –±–µ–ª–≥—ñ—Å—ñ."
                    },
                    {
                        text: "–ë–∞–ª–∞–Ω—ã“£ –∞—Ç–∞-–∞–Ω–∞—Å—ã: '–ë—ñ–∑ –∞“õ—à–∞ –∂–∏–Ω–∞–ø –∂–∞—Ç“õ–∞–Ω –∂–æ“õ–ø—ã–∑, –±“±–ª –∞–∫–∫–∞—É–Ω—Ç –±—ñ–∑–≥–µ “õ–∞—Ç—ã—Å—ã –∂–æ“õ.' ‚Äî –¥–µ–≥–µ–Ω –º”ô–ª—ñ–º–¥–µ–º–µ –±–∞—Ä.",
                        isTruth: true,
                        hint: "–¢—ñ–∫–µ–ª–µ–π –∞—Ç–∞-–∞–Ω–∞–Ω—ã“£ –∞–π—Ç“õ–∞–Ω—ã ‚Äî —Å–µ–Ω—ñ–º–¥—ñ –¥–µ—Ä–µ–∫–∫”©–∑."
                    },
                    {
                        text: "–ë–ª–æ–≥–µ—Ä —Å—Ç–æ—Ä–∏—Å—Ç–µ —ç–º–æ—Ü–∏—è–ª—ã“õ “õ—ã—Å—ã–º “õ–æ–ª–¥–∞–Ω–¥—ã: '–ú–∞“ì–∞–Ω —Å–µ–Ω—ñ“£—ñ–∑–¥–µ—Ä. –£–∞“õ—ã—Ç –∞–∑ “õ–∞–ª–¥—ã!'",
                        isTruth: false,
                        hint: "–≠–º–æ—Ü–∏—è–ª—ã“õ “õ—ã—Å—ã–º ‚Äî –º–∞–Ω–∏–ø—É–ª—è—Ü–∏—è–Ω—ã“£ –Ω–µ–≥—ñ–∑–≥—ñ “õ“±—Ä–∞–ª—ã."
                    },
                    {
                        text: "–ü—ñ–∫—ñ—Ä–ª–µ—Ä–¥–µ 3 –∞–∫–∫–∞—É–Ω—Ç –±—ñ—Ä–¥–µ–π –º”ô—Ç—ñ–Ω–º–µ–Ω –∂–∞–∑–¥—ã; –∞–∫–∫–∞—É–Ω—Ç—Ç–∞—Ä—Ç–∞ 0 –∂–∞–∑—ã–ª—É—à—ã –±–∞—Ä.",
                        isTruth: false,
                        hint: "–ö–ª–æ–Ω –∞–∫–∫–∞—É–Ω—Ç—Ç–∞—Ä –∂”ô–Ω–µ –±—ñ—Ä–¥–µ–π –ø—ñ–∫—ñ—Ä–ª–µ—Ä ‚Äî –∂–∞—Å–∞–Ω–¥—ã “õ–æ–ª–¥–∞—É –±–µ–ª–≥—ñ—Å—ñ."
                    }
                ],
                choices: [
                    { id: "audience", label: "–°–ø–∞—Å—Ç–∏ –∞—É–¥–∏—Ç–æ—Ä–∏—è–Ω—ã: –∂–∏–Ω–∞“õ—Ç—ã —Ç–æ“õ—Ç–∞—Ç—ã–ø, –µ—Å–∫–µ—Ä—Ç—É –∂–∞—Ä–∏—è–ª–∞—É" },
                    { id: "blogger", label: "–°–ø–∞—Å—Ç–∏ –±–ª–æ–≥–µ—Ä–¥—ñ: “õ–æ—Å—ã–º—à–∞ —Ç–µ–∫—Å–µ—Ä—ñ—Å –∂“Ø—Ä–≥—ñ–∑—É" }
                ],
                correctChoice: "audience",
                praise: "–¢–∞–∑–∞! –§–µ–π–∫—Ç—ñ —Ç–æ“õ—Ç–∞—Ç—Ç—ã“£—ã–∑."
            },

            {
                tag: "–ê–ª–∞—è“õ—Ç—ã“õ",
                difficulty: "–û—Ä—Ç–∞—à–∞-–∫“Ø—Ä–¥–µ–ª—ñ",
                title: "Telegram-–¥–∞“ì—ã '”©–∑—ñ“£–¥—ñ –±–∏—Ç–∫–æ–∏–Ω–º–µ–Ω –±–∞–π—ã—Ç' —á–∞—Ç—ã",
                narrative: "Telegram-–¥–∞ 'Bitcoin Club ‚Äì –ö“Ø–Ω—ñ–Ω–µ 50 000 —Ç–≥ —Ç–∞–±—ã—Å' –¥–µ–≥–µ–Ω —Ç–æ–ø –ø–∞–π–¥–∞ –±–æ–ª–¥—ã. –¢–æ–ø ”ô–∫—ñ–º—à—ñ–ª–µ—Ä—ñ '—Ç–µ–∫ 10 000 —Ç–µ“£–≥–µ –¥–µ–ø–æ–∑–∏—Ç —Å–∞–ª—Å–∞“£, –±—ñ—Ä –∫“Ø–Ω–¥–µ –µ–∫—ñ –µ—Å–µ “õ—ã–ª—ã–ø “õ–∞–π—Ç–∞—Ä–∞–º—ã–∑' –¥–µ–ø —É”ô–¥–µ –±–µ—Ä–µ–¥—ñ. –ß–∞—Ç—Ç–∞ –∂–∞–ª“ì–∞–Ω —Ç–∞–±—ã—Å —Å–∫—Ä–∏–Ω–¥–µ—Ä—ñ –º–µ–Ω '–º–µ–Ω –∞–ª—ã–ø “õ–æ–π–¥—ã–º' –¥–µ–≥–µ–Ω –ø—ñ–∫—ñ—Ä–ª–µ—Ä —Ç–æ–ª—ã–ø —Ç“±—Ä.",
                evidence: [
                    {
                        text: "–ß–∞—Ç—Ç–∞ –±—ñ—Ä–Ω–µ—à–µ –∞–¥–∞–º –±—ñ—Ä–¥–µ–π —Ñ–æ—Ä–º–∞—Ç—Ç–∞ —Å–∫—Ä–∏–Ω –∂—ñ–±–µ—Ä–≥–µ–Ω: '–ë“Ø–≥—ñ–Ω 120 000 —Ç–≥ –∞–ª–¥—ã–º!' –ë–∞—Ä–ª—ã“ì—ã–Ω–¥–∞ –¥–∞—Ç–∞ “õ–∏—ã–ª—ã–ø —Ç“±—Ä.",
                        isTruth: true,
                        hint: "–ë—ñ—Ä–¥–µ–π —Å—Ç–∏–ª—å–¥–µ–≥—ñ —Å–∫—Ä–∏–Ω–¥–µ—Ä –∞–ª–∞—è“õ –±–æ—Ç—Ç–∞—Ä–¥—ã“£ –∂–∏—ñ “õ–æ–ª–¥–∞–Ω–∞—Ç—ã–Ω –º–∞—Ç–µ—Ä–∏–∞–ª—ã."
                    },
                    {
                        text: "–ê–¥–º–∏–Ω: '–ë—ñ–∑ –∫—Ä–∏–ø—Ç–æ—ç–∫—Å–ø–µ—Ä—Ç—Ç–µ—Ä–º—ñ–∑, Binance-–ø–µ–Ω —Å–µ—Ä—ñ–∫—Ç–µ—Å–ø—ñ–∑' –¥–µ–ø –∂–∞–∑–∞–¥—ã ‚Äî —Ä–∞—Å—Ç–∞–π—Ç—ã–Ω “õ“±–∂–∞—Ç –∂–æ“õ.",
                        isTruth: true,
                        hint: "–°–µ—Ä—ñ–∫—Ç–µ—Å—Ç—ñ–∫ —Ç—É—Ä–∞–ª—ã –º”ô–ª—ñ–º–¥–µ–º–µ–ª–µ—Ä–¥—ñ —Ä–µ—Å–º–∏ —Å–∞–π—Ç—Ç–∞—Ä–¥–∞–Ω —Ç–µ–∫—Å–µ—Ä—É –∫–µ—Ä–µ–∫."
                    },
                    {
                        text: "Telegram “õ–∞—É—ñ–ø—Å—ñ–∑–¥—ñ–∫ –µ—Å–∫–µ—Ä—Ç—É—ñ–Ω–¥–µ: 'High-risk investment scam' –¥–µ–ø –±–µ–ª–≥—ñ–ª–µ–Ω–≥–µ–Ω —Ö–∞–±–∞—Ä–ª–∞–º–∞–ª–∞—Ä –±–∞—Ä.",
                        isTruth: true,
                        hint: "–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞–Ω—ã“£ “õ–∞—É—ñ–ø—Å—ñ–∑–¥—ñ–∫ –±–µ–ª–≥—ñ–ª–µ—Ä—ñ ‚Äî “õ–æ—Å—ã–º—à–∞ —Å–∏–≥–Ω–∞–ª."
                    },
                    {
                        text: "–ê–∫–∫–∞—É–Ω—Ç: '–ú–µ–Ω 30 –º–∏–Ω—É—Ç—Ç–∞ 50 –º—ã“£ –∞–ª—ã–ø “õ–æ–π–¥—ã–º' ‚Äî stock —Ñ–æ—Ç–æ –∞–≤–∞—Ç–∞—Ä—ã–Ω–¥–∞.",
                        isTruth: false,
                        hint: "–°—Ç–æ–∫ —Ñ–æ—Ç–æ ‚Äî —Ñ–µ–π–∫ –∞–∫–∫–∞—É–Ω—Ç—Ç—ã“£ –±–µ–ª–≥—ñ—Å—ñ."
                    },
                    {
                        text: "–ê–¥–º–∏–Ω: '–ë—ñ—Ä—ñ–Ω—à—ñ 5 –∞–¥–∞–º“ì–∞ —Ç–µ–≥—ñ–Ω –±–æ–Ω—É—Å' –¥–µ–π–¥—ñ.",
                        isTruth: false,
                        hint: "'–®“±“ì—ã–ª –±–æ–Ω—É—Å' ‚Äî –∫–ª–∞—Å—Å–∏–∫–∞–ª—ã“õ “õ–∞—Ä–º–∞“õ."
                    }
                ],
                choices: [
                    { id: "users", label: "–°–ø–∞—Å—Ç–∏ “õ–æ–ª–¥–∞–Ω—É—à—ã–ª–∞—Ä–¥—ã: —á–∞—Ç—Ç—ã —Ñ–µ–π–∫ –¥–µ–ø –±–µ–ª–≥—ñ–ª–µ—É, –±“±“ì–∞—Ç—Ç–∞—É" },
                    { id: "admins", label: "–°–ø–∞—Å—Ç–∏ —á–∞—Ç ”ô–∫—ñ–º–¥–µ—Ä—ñ–Ω: —Ç–µ–∫—Å–µ—Ä—É “Ø—à—ñ–Ω —É–∞“õ—ã—Ç –±–µ—Ä—É" }
                ],
                correctChoice: "users",
                praise: "“ö–∞—É—ã–º–¥–∞—Å—Ç—ã“õ —Ä–∞—Ö–º–µ—Ç –∞–π—Ç–∞–¥—ã."
            },

            {
                tag: "–ñ“±–º—ã—Å",
                difficulty: "–û—Ä—Ç–∞—à–∞",
                title: "–ñ–∞–ª–∞“õ—ã 700 000, –æ—Ñ–∏—Å –∂–æ“õ —Ä–µ–∫—Ä—É—Ç–∏–Ω–≥ —Ñ–µ–π–∫—ñ",
                narrative: "–ñ–µ–ª—ñ–¥–µ '–Ü—Ä—ñ —Ö–∞–ª—ã“õ–∞—Ä–∞–ª—ã“õ –∫–æ–º–ø–∞–Ω–∏—è“ì–∞ –æ–Ω–ª–∞–π–Ω-–æ–ø–µ—Ä–∞—Ç–æ—Ä–ª–∞—Ä “õ–∞–∂–µ—Ç. –ñ–∞–ª–∞“õ—ã ‚Äì 700 000 —Ç–≥. –û—Ñ–∏—Å–∫–µ –±–∞—Ä—É–¥—ã“£ “õ–∞–∂–µ—Ç—ñ –∂–æ“õ. –¢–µ–∫ —Ç–µ–ª–µ—Ñ–æ–Ω –∂”ô–Ω–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –∂–µ—Ç–∫—ñ–ª—ñ–∫—Ç—ñ' –¥–µ–≥–µ–Ω —Ö–∞–±–∞—Ä–ª–∞–º–∞ —Ç–∞—Ä–∞–ø –∂–∞—Ç—ã—Ä. –•–∞–±–∞—Ä–ª–∞–º–∞–¥–∞ —Ä–µ–∫—Ä—É—Ç–µ—Ä '–¢–µ–∫ “õ–∞–∑—ñ—Ä 15 –∞–¥–∞–º “õ–∞–±—ã–ª–¥–∞–π–º—ã–∑' –¥–µ–ø –∂–∞–∑–∞–¥—ã.",
                evidence: [
                    {
                        text: "–õ–æ–≥–æ—Ç–∏–ø ”ô–ª–µ–º–≥–µ —Ç–∞–Ω—ã–º–∞–ª –∫–æ–º–ø–∞–Ω–∏—è“ì–∞ “±“õ—Å–∞–π–¥—ã, –±—ñ—Ä–∞“õ —à—Ä–∏—Ñ—Ç—ñ –º–µ–Ω —Ç“Ø—Å—Ç–µ—Ä—ñ –∞–∑–¥–∞–ø ”©–∑–≥–µ—à–µ.",
                        isTruth: true,
                        hint: "–ê–ª–∞—è“õ—Ç–∞—Ä –∂–∏—ñ —Ç–∞–Ω—ã–º–∞–ª –±—Ä–µ–Ω–¥ –ª–æ–≥–æ—Ç–∏–ø—ñ–Ω–µ “±“õ—Å–∞—Å —Ñ–µ–π–∫ –Ω“±—Å“õ–∞—Å—ã–Ω “õ–æ–ª–¥–∞–Ω–∞–¥—ã."
                    },
                    {
                        text: "–†–µ–∫—Ä—É—Ç–µ—Ä: '–ë—ñ–∑ LinkedIn-–≥–µ –∂–∞—Ä–Ω–∞–º–∞ –±–µ—Ä–µ –∞–ª–º–∞–π –∂–∞—Ç—ã—Ä–º—ã–∑, —Å–æ–Ω–¥—ã“õ—Ç–∞–Ω Telegram –∞—Ä“õ—ã–ª—ã “õ–∞–±—ã–ª–¥–∞–ø –∂–∞—Ç—ã—Ä–º—ã–∑' –¥–µ–π–¥—ñ.",
                        isTruth: true,
                        hint: "–Ü—Ä—ñ –∫–æ–º–ø–∞–Ω–∏—è–ª–∞—Ä ”ô–¥–µ—Ç—Ç–µ —Ä–µ—Å–º–∏ –∞—Ä–Ω–∞–ª–∞—Ä—ã–Ω “õ–æ–ª–¥–∞–Ω–∞–¥—ã; —Ç–µ–∫ Telegram –∞—Ä“õ—ã–ª—ã –∂“±–º—ã—Å“õ–∞ –∞–ª—É –∫“Ø–º”ô–Ω —Ç—É–¥—ã—Ä–∞–¥—ã."
                    },
                    {
                        text: "–ö–æ–º–ø–∞–Ω–∏—è–Ω—ã“£ —Ä–µ—Å–º–∏ —Å–∞–π—Ç—ã–Ω–¥–∞ –º“±–Ω–¥–∞–π –≤–∞–∫–∞–Ω—Å–∏—è –∂–æ“õ.",
                        isTruth: true,
                        hint: "–†–µ—Å–º–∏ —Å–∞–π—Ç ‚Äî —Å–µ–Ω—ñ–º–¥—ñ –¥–µ—Ä–µ–∫–∫”©–∑."
                    },
                    {
                        text: "“ö“±–∂–∞—Ç —Ç–∞–ø—Å—ã—Ä—É “Ø—à—ñ–Ω '—Ç—ñ—Ä–∫–µ—É –∂–∞—Ä–Ω–∞—Å—ã' —Ç”©–ª–µ—É —Ç–∞–ª–∞–ø –µ—Ç—ñ–ª–µ–¥—ñ.",
                        isTruth: true,
                        hint: "–ñ“±–º—ã—Å“õ–∞ “õ–∞–±—ã–ª–¥–∞—É “Ø—à—ñ–Ω –∂–∞—Ä–Ω–∞ —Ç–∞–ª–∞–ø –µ—Ç—É ‚Äî –∞–ª–∞—è“õ—Ç—ã“õ –±–µ–ª–≥—ñ—Å—ñ."
                    },
                    {
                        text: "–ü—ñ–∫—ñ—Ä–ª–µ—Ä–¥–µ: '700 000 –∂–∞–ª–∞“õ—ã —Ä–∞—Å!' 0 –∂–∞–∑—ã–ª—É—à—ã –∞–∫–∫–∞—É–Ω—Ç—Ç–∞—Ä–¥–∞–Ω.",
                        isTruth: false,
                        hint: "–ú“±–Ω–¥–∞–π –ø—ñ–∫—ñ—Ä–ª–µ—Ä –±–æ—Ç—Ç–∞—Ä –∞—Ä“õ—ã–ª—ã –∂–∞—Å–∞–ª–∞–¥—ã."
                    }
                ],
                choices: [
                    { id: "users", label: "–°–ø–∞—Å—Ç–∏ “õ–æ–ª–¥–∞–Ω—É—à—ã–ª–∞—Ä–¥—ã: –≤–∞–∫–∞–Ω—Å–∏—è–Ω—ã –∞–ª–∞—è“õ—Ç—ã“õ –¥–µ–ø –±–µ–ª–≥—ñ–ª–µ—É" },
                    { id: "post", label: "–°–ø–∞—Å—Ç–∏ –ø–æ—Å—Ç—ã–Ω: —Ç–µ–∫—Å–µ—Ä—É “Ø—à—ñ–Ω —É–∞“õ—ã—Ç –±–µ—Ä—É" }
                ],
                correctChoice: "users",
                praise: "–ü–∞–π–¥–∞–ª–∞–Ω—É—à—ã–ª–∞—Ä–¥—ã “õ–æ—Ä“ì–∞—É ‚Äî –µ“£ –¥“±—Ä—ã—Å —à–µ—à—ñ–º."
            },

            {
                tag: "–ú–µ–¥–∏–∞–º–∞–Ω–∏–ø—É–ª—è—Ü–∏—è",
                difficulty: "–ö“Ø—Ä–¥–µ–ª—ñ",
                title: "–ê–Ω–æ–Ω–∏–º –∂—É—Ä–Ω–∞–ª–∏—Å—Ç—ñ–∫ –º–∞—Ç–µ—Ä–∏–∞–ª: '–®–µ–Ω–µ—É–Ω—ñ–∫ 12 –º–ª–Ω –∂—ã–º“õ—ã—Ä–¥—ã'",
                narrative: "–ë–µ–ª–≥—ñ—Å—ñ–∑ Telegram –∞—Ä–Ω–∞—Å—ã–Ω–¥–∞ '—Ç–∞–Ω—ã–º–∞–ª –º–µ–º–ª–µ–∫–µ—Ç—Ç—ñ–∫ –±–∞—Å“õ–∞—Ä–º–∞ –±–∞—Å—à—ã—Å—ã 12 –º–ª–Ω —Ç–µ“£–≥–µ–Ω—ñ –∂—ã–º“õ—ã—Ä–¥—ã' –¥–µ–≥–µ–Ω '–∂—É—Ä–Ω–∞–ª–∏—Å—Ç—ñ–∫ –∑–µ—Ä—Ç—Ç–µ—É' –∂–∞—Ä–∏—è–ª–∞–Ω–¥—ã. –ú–∞—Ç–µ—Ä–∏–∞–ª–¥–∞ —Ñ–æ—Ç–æ, '“õ“±–∂–∞—Ç' –∂”ô–Ω–µ –∞–Ω–æ–Ω–∏–º –¥–µ—Ä–µ–∫–∫”©–∑ —Å”©–∑—ñ –±–∞—Ä. –ñ–µ–ª—ñ “õ–æ–ª–¥–∞–Ω—É—à—ã–ª–∞—Ä—ã —à–µ–Ω–µ—É–Ω—ñ–∫—Ç—ñ –±—ñ—Ä–¥–µ–Ω –∫—ñ–Ω”ô–ª—ñ –¥–µ–ø –∂–∞–∑–∞ –±–∞—Å—Ç–∞–¥—ã.",
                evidence: [
                    {
                        text: "–ú–∞—Ç–µ—Ä–∏–∞–ª–¥–∞ '–±—ñ–∑–≥–µ –∞–Ω–æ–Ω–∏–º “õ—ã–∑–º–µ—Ç–∫–µ—Ä —Ö–∞–±–∞—Ä–ª–∞–¥—ã' –¥–µ–≥–µ–Ω —Å”©–π–ª–µ–º –±–∞—Ä. –ù–∞“õ—Ç—ã –∞—Ç—ã-–∂”©–Ω—ñ –∂–æ“õ.",
                        isTruth: true,
                        hint: "–ê–Ω–æ–Ω–∏–º –¥–µ—Ä–µ–∫–∫”©–∑ ‚Äî —Ñ–µ–π–∫ –∑–µ—Ä—Ç—Ç–µ—É–ª–µ—Ä–¥–µ –µ“£ –∂–∏—ñ “õ–æ–ª–¥–∞–Ω—ã–ª–∞—Ç—ã–Ω “õ“±—Ä–∞–ª."
                    },
                    {
                        text: "'“ö“±–∂–∞—Ç' —Ñ–æ—Ç–æ—Å—ã–Ω–¥–∞ –º”©—Ä –±“±–ª—ã“£“ì—ã—Ä, –¥–∞—Ç–∞ “õ–æ–ª–º–µ–Ω ”©–∑–≥–µ—Ä—Ç—ñ–ª–≥–µ–Ω —Å–∏—è“õ—Ç—ã.",
                        isTruth: true,
                        hint: "–°–∞–ø–∞—Å—ã–∑ “õ“±–∂–∞—Ç —Ñ–æ—Ç–æ ‚Äî —Ñ–µ–π–∫ –±–µ–ª–≥—ñ—Å—ñ."
                    },
                    {
                        text: "–ú–µ–º–ª–µ–∫–µ—Ç—Ç—ñ–∫ –ø–æ—Ä—Ç–∞–ª—å–¥–∞ 12 –º–ª–Ω —Ç–µ“£–≥–µ–ª—ñ–∫ –∫–µ–ª—ñ—Å—ñ–º-—à–∞—Ä—Ç –º“Ø–ª–¥–µ —Ç—ñ—Ä–∫–µ–ª–º–µ–≥–µ–Ω.",
                        isTruth: true,
                        hint: "–ú–µ–º–ª–µ–∫–µ—Ç—Ç—ñ–∫ –∫–µ–ª—ñ—Å—ñ–º-—à–∞—Ä—Ç—Ç–∞—Ä —Ä–µ–µ—Å—Ç—Ä—ñ–Ω–µ–Ω —Ç–µ–∫—Å–µ—Ä—ñ“£—ñ–∑."
                    },
                    {
                        text: "–ñ—É—Ä–Ω–∞–ª–∏—Å—Ç: '–ê–¥–∞–º —Ö–∞–ª—ã“õ—Ç—ã“£ –∞“õ—à–∞—Å—ã–Ω –∂–µ–ø –∫–µ–ª–µ–¥—ñ' –¥–µ–π–¥—ñ ‚Äî —ç–º–æ—Ü–∏—è“ì–∞ –Ω–µ–≥—ñ–∑–¥–µ–ª–≥–µ–Ω –∞–π—ã–ø.",
                        isTruth: false,
                        hint: "–≠–º–æ—Ü–∏—è–ª—ã“õ “õ–æ—Ä—ã—Ç—ã–Ω–¥—ã ‚Äî –¥”ô–ª–µ–ª –µ–º–µ—Å."
                    },
                    {
                        text: "–§–∞–∫—Ç—á–µ–∫–∏–Ω–≥ –ø–æ—Ä—Ç–∞–ª—ã —Ñ–æ—Ç–æ–ª–∞—Ä –º–µ–Ω “õ“±–∂–∞—Ç—Ç–∞—Ä–¥—ã“£ –∂–∞–ª“ì–∞–Ω –µ–∫–µ–Ω—ñ–Ω –∞–Ω—ã“õ—Ç–∞–¥—ã.",
                        isTruth: true,
                        hint: "–†–µ—Å–º–∏ —Ñ–∞–∫—Ç—á–µ–∫–∏–Ω–≥ ‚Äî —Å–µ–Ω—ñ–º–¥—ñ –¥–µ—Ä–µ–∫–∫”©–∑."
                    }
                ],
                choices: [
                    { id: "official", label: "–°–ø–∞—Å—Ç–∏ —à–µ–Ω–µ—É–Ω—ñ–∫—Ç—ñ: —Ñ–µ–π–∫—Ç—ñ —Ç–æ“õ—Ç–∞—Ç—É, –∂–∞–ª“ì–∞–Ω –∞–π—ã–ø—Ç—ã –∂–æ“õ“õ–∞ —à—ã“ì–∞—Ä—É" },
                    { id: "material", label: "–°–ø–∞—Å—Ç–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–¥—ã: “õ–æ—Å—ã–º—à–∞ —Ç–µ–∫—Å–µ—Ä—ñ—Å –∂“Ø—Ä–≥—ñ–∑—É" }
                ],
                correctChoice: "official",
                praise: "–§–µ–π–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–¥–∞ —Å–µ–Ω—É “õ–∞—É—ñ–ø—Ç—ñ."
            },

            {
                tag: "–ú–µ–¥–∏–∞–º–∞–Ω–∏–ø—É–ª—è—Ü–∏—è",
                difficulty: "–ö“Ø—Ä–¥–µ–ª—ñ",
                title: "–¢–µ–∫—Å–µ—Ä—ñ—Å –∫–µ–∑—ñ–Ω–¥–µ –∂–∞–ª“ì–∞–Ω —Ö–∞—Ç—Ç–∞–º–∞ —à—ã“õ—Ç—ã",
                narrative: "“ö–∞–ª–∞–¥–∞“ì—ã –º–µ–º–ª–µ–∫–µ—Ç—Ç—ñ–∫ –º–µ–∫–µ–º–µ–¥–µ –∂–æ—Å–ø–∞—Ä–ª—ã —Ç–µ–∫—Å–µ—Ä—ñ—Å –∂“Ø—Ä—ñ–ø –∂–∞—Ç“õ–∞–Ω–¥–∞, Telegram-–¥–∞ '–¢–µ–∫—Å–µ—Ä—É—à—ñ–ª–µ—Ä –±–∞—Å –º–∞–º–∞–Ω–Ω—ã“£ 3 –º–ª–Ω —Ç–µ“£–≥–µ–Ω—ñ –º–∞“õ—Å–∞—Ç—Å—ã–∑ –∂“±–º—Å–∞“ì–∞–Ω—ã–Ω –∞–Ω—ã“õ—Ç–∞–¥—ã' –¥–µ–≥–µ–Ω —Ö–∞—Ç—Ç–∞–º–∞–Ω—ã“£ —Ñ–æ—Ç–æ—Å—ã —Ç–∞—Ä–∞–¥—ã. –•–∞—Ç—Ç–∞–º–∞ —Ç–µ–∑ —Ç–∞—Ä–∞–ª—É “õ–∞—Ä“õ—ã–Ω—ã–Ω–¥–∞ –±–æ–ª—ã–ø, “õ–æ–ª–¥–∞–Ω—É—à—ã–ª–∞—Ä –±–∞—Å –º–∞–º–∞–Ω–¥—ã –∫—ñ–Ω”ô–ª—ñ –¥–µ–ø –∂–∞–∑–∞ –±–∞—Å—Ç–∞–¥—ã.",
                evidence: [
                    {
                        text: "–¢–∞—Ä–∞“ì–∞–Ω '—Ö–∞—Ç—Ç–∞–º–∞' —Ñ–æ—Ç–æ—Å—ã–Ω–¥–∞ –±”©–ª—ñ–º –∞—Ç–∞—É—ã –µ—Å–∫—ñ —Ñ–æ—Ä–º–∞—Ç–ø–µ–Ω –∂–∞–∑—ã–ª“ì–∞–Ω. –ë“±–ª —Ñ–æ—Ä–º–∞—Ç 2020 –∂—ã–ª–¥–∞–Ω –±–µ—Ä—ñ “õ–æ–ª–¥–∞–Ω—ã–ª–º–∞–π–¥—ã.",
                        isTruth: true,
                        hint: "“ö—ã–∑–º–µ—Ç—Ç—ñ–∫ —Ö–∞—Ç—Ç–∞–º–∞–ª–∞—Ä–¥–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç “õ–∞—Ç–∞“£ —Å–∞“õ—Ç–∞–ª–∞–¥—ã; –µ—Å–∫—ñ —Ñ–æ—Ä–º–∞—Ç ‚Äî —Ñ–µ–π–∫—Ç—ñ“£ –±–µ–ª–≥—ñ—Å—ñ."
                    },
                    {
                        text: "–§–æ—Ç–æ–¥–∞“ì—ã “õ–æ–ª—Ç–∞“£–±–∞ —Å–∫–∞–Ω–µ—Ä–ª–µ–Ω–≥–µ–Ω –±–µ–ª–≥—ñ–≥–µ “±“õ—Å–∞–π–¥—ã.",
                        isTruth: true,
                        hint: "–°–∫–∞–Ω–¥–∞–ª“ì–∞–Ω “õ–æ–ª—Ç–∞“£–±–∞ ‚Äî “õ“±–∂–∞—Ç—Ç—ã“£ –∂–∞–ª“ì–∞–Ω –µ–∫–µ–Ω—ñ–Ω –∫”©—Ä—Å–µ—Ç—É—ñ –º“Ø–º–∫—ñ–Ω."
                    },
                    {
                        text: "–†–µ—Å–º–∏ –∫–æ–º–∏—Å—Å–∏—è: '–ë—ñ–∑ –º“±–Ω–¥–∞–π —Ö–∞—Ç—Ç–∞–º–∞ –∂–∞—Å–∞–º–∞–¥—ã“õ. –ú“±—Ä–∞“ì–∞—Ç—Ç–∞ –∂–æ“õ.' ‚Äî –¥–µ–¥—ñ.",
                        isTruth: true,
                        hint: "–†–µ—Å–º–∏ –º”ô–ª—ñ–º–¥–µ–º–µ ‚Äî –µ“£ —Å–µ–Ω—ñ–º–¥—ñ –¥–µ—Ä–µ–∫."
                    },
                    {
                        text: "–•–∞–±–∞—Ä–¥—ã —Ç–∞—Ä–∞—Ç“õ–∞–Ω –∞—Ä–Ω–∞: '–û–ª –∞–¥–∞–º –±“±—Ä—ã–Ω–Ω–∞–Ω –∫“Ø–º”ô–Ω–¥—ñ' –¥–µ–π–¥—ñ ‚Äî —Ñ–∞–∫—Ç –∂–æ“õ.",
                        isTruth: false,
                        hint: "–≠–º–æ—Ü–∏—è–ª—ã“õ —à–∞–±—É—ã–ª ‚Äî –¥”ô–ª–µ–ª –µ–º–µ—Å."
                    },
                    {
                        text: "–®—Ç—Ä–∏—Ö–∫–æ–¥ –±–∞—Å“õ–∞ –º–µ–∫–µ–º–µ–≥–µ —Ç–∏–µ—Å—ñ–ª—ñ –µ–∫–µ–Ω—ñ –∞–Ω—ã“õ—Ç–∞–ª–¥—ã.",
                        isTruth: true,
                        hint: "”ò—Ä –º–µ–∫–µ–º–µ–Ω—ñ“£ —à—Ç—Ä–∏—Ö–∫–æ–¥—ã –µ—Ä–µ–∫—à–µ; –º“±–Ω–¥–∞–π —Å”ô–π–∫–µ—Å—Å—ñ–∑–¥—ñ–∫ ‚Äî —Ñ–µ–π–∫ –±–µ–ª–≥—ñ—Å—ñ."
                    }
                ],
                choices: [
                    { id: "official", label: "–°–ø–∞—Å—Ç–∏ “õ—ã–∑–º–µ—Ç–∫–µ—Ä–¥—ñ: —Ö–∞—Ç—Ç–∞–º–∞–Ω—ã“£ –∂–∞–ª“ì–∞–Ω –µ–∫–µ–Ω—ñ–Ω –∂–∞—Ä–∏—è–ª–∞—É" },
                    { id: "material", label: "–°–ø–∞—Å—Ç–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–¥—ã: “õ–æ—Å—ã–º—à–∞ —Ç–µ–∫—Å–µ—Ä—ñ—Å –∂“Ø—Ä–≥—ñ–∑—É" }
                ],
                correctChoice: "official",
                praise: "–†–µ—Å–º–∏ “õ“±–∂–∞—Ç —Ñ–µ–π–∫ –±–æ–ª—ã–ø —à—ã“õ—Ç—ã ‚Äî –¥“±—Ä—ã—Å —à–µ—à—ñ–º."
            },

            {
                tag: "–°–∞—è—Å–∏ –¥–∞“ì–¥–∞—Ä—ã—Å",
                difficulty: "–ö“Ø—Ä–¥–µ–ª—ñ",
                title: "“ö–∞–ª–∞–¥–∞“ì—ã —Ç”ô—Ä—Ç—ñ–ø—Å—ñ–∑–¥—ñ–∫ –∂–∞–π–ª—ã –∂–∞–ª“ì–∞–Ω '–∫—É”ô–≥–µ—Ä –≤–∏–¥–µ–æ—Å—ã'",
                narrative: "–ï–ª–¥—ñ“£ –±–∞—Ç—ã—Å ”©“£—ñ—Ä—ñ–Ω–¥–µ–≥—ñ '–ê–π“õ–∞–ª' “õ–∞–ª–∞—Å—ã–Ω–¥–∞ —Ç“Ø–Ω–¥–µ –∂–∞–ø–ø–∞–π —Ç”ô—Ä—Ç—ñ–ø—Å—ñ–∑–¥—ñ–∫ –±–æ–ª–¥—ã –¥–µ–≥–µ–Ω —Ö–∞–±–∞—Ä —Ç–∞—Ä–∞–¥—ã. Telegram-–∫–∞–Ω–∞–ª–¥–∞—Ä '”ô—Å–∫–µ—Ä —Ö–∞–ª—ã“õ“õ–∞ –æ“õ –∞—Ç—Ç—ã' –¥–µ–≥–µ–Ω –≤–∏–¥–µ–æ–Ω—ã –±”©–ª—ñ—Å–µ –±–∞—Å—Ç–∞–¥—ã. –ö”©–ø—à—ñ–ª—ñ–∫ –±—ñ—Ä–¥–µ–Ω —à–∞—Ä–∞ “õ–æ–ª–¥–∞–Ω—É–¥—ã —Ç–∞–ª–∞–ø –µ—Ç–µ–¥—ñ, –±—ñ—Ä–∞“õ –∫–µ–π —Ñ–∞–∫—Ç—ñ–ª–µ—Ä –∫“Ø–º”ô–Ω —Ç—É–¥—ã—Ä–∞–¥—ã.",
                evidence: [
                    {
                        text: "–í–∏–¥–µ–æ–¥–∞ –¥—ã–±—ã—Å –ø–µ–Ω –∫–∞–¥—Ä —Å–∏–Ω—Ö—Ä–æ–Ω –µ–º–µ—Å: –¥—ã–±—ã—Å—Ç–∞ '–æ—Ç' –±–∞—Ä, –∫–∞–¥—Ä–¥–∞ –∂–∞—Ä“õ—ã–ª—ã –∂–æ“õ.",
                        isTruth: true,
                        hint: "–§–µ–π–∫ –≤–∏–¥–µ–æ–ª–∞—Ä–¥–∞ –∫–∞–¥—Ä –º–µ–Ω –¥—ã–±—ã—Å—Ç—ã –±”©–ª–µ–∫ –±—ñ—Ä—ñ–∫—Ç—ñ—Ä–µ–¥—ñ."
                    },
                    {
                        text: "–í–∏–¥–µ–æ–Ω—ã“£ –±“±—Ä—ã—à—ã–Ω–¥–∞ –¥–∞—Ç–∞ '2021' –¥–µ–ø –∫”©—Ä—Å–µ—Ç—ñ–ª–≥–µ–Ω, –±—ñ—Ä–∞“õ –±“Ø–∫—ñ–ª –∫–∞–¥—Ä –º”ô–Ω–º”ô—Ç—ñ–Ω–¥–µ–≥—ñ —Å”ô–π–∫–µ—Å—Å—ñ–∑–¥—ñ–∫—Ç—ñ –∫”©—Ä—Å–µ—Ç–µ–¥—ñ.",
                        isTruth: true,
                        hint: "–î–∞—Ç–∞–Ω—ã“£ –∂–æ“ì–∞–ª—É—ã –Ω–µ–º–µ—Å–µ —Å”ô–π–∫–µ—Å –µ–º–µ—Å—Ç—ñ–≥—ñ ‚Äî –º–æ–Ω—Ç–∞–∂ –±–µ–ª–≥—ñ—Å—ñ."
                    },
                    {
                        text: "“ö–∞–ª–∞–ª—ã“õ ”ô–∫—ñ–º–¥—ñ–∫: '“ö–∞–ª–∞–¥–∞ –µ—à“õ–∞–Ω–¥–∞–π –æ“õ–∏“ì–∞ –±–æ–ª“ì–∞–Ω –∂–æ“õ' ‚Äî –¥–µ–ø —Ä–µ—Å–º–∏ –º”ô–ª—ñ–º–¥–µ–¥—ñ.",
                        isTruth: true,
                        hint: "–†–µ—Å–º–∏ –æ—Ä–≥–∞–Ω–¥–∞—Ä–¥—ã“£ –¥–µ—Ä–µ—É –º”ô–ª—ñ–º–¥–µ–º–µ–ª–µ—Ä—ñ —Ç–µ–∫—Å–µ—Ä—ñ–ª–µ–¥—ñ."
                    },
                    {
                        text: "–§–µ–π–∫ –∫–∞–Ω–∞–ª: '–ë”ô—Ä—ñ–Ω ”©–∑ –∫”©–∑—ñ–º—ñ–∑–±–µ–Ω –∫”©—Ä—ñ–ø —Ç“±—Ä–º—ã–∑!' ‚Äî –±—ñ—Ä–∞“õ –Ω–∞“õ—Ç—ã –¥”ô–ª–µ–ª –∂–æ“õ.",
                        isTruth: false,
                        hint: "–≠–º–æ—Ü–∏—è–ª—ã“õ “õ–æ—Ä—ã—Ç—ã–Ω–¥—ã ‚Äî –¥”ô–ª–µ–ª –µ–º–µ—Å."
                    },
                    {
                        text: "Fact-checking —Ç–æ–±—ã –≤–∏–¥–µ–æ–Ω—ã –∞–Ω—ã“õ—Ç–∞–ø, 2020 –∂—ã–ª“ì—ã –±–∞—Å“õ–∞ –µ–ª–¥–µ–≥—ñ –æ“õ–∏“ì–∞ –µ–∫–µ–Ω—ñ–Ω –¥”ô–ª–µ–ª–¥–µ–¥—ñ.",
                        isTruth: true,
                        hint: "–í–∏–¥–µ–æ–Ω—ã“£ “õ–∞–π–Ω–∞—Ä—ã–Ω —Å”ô–π–∫–µ—Å—Ç–µ–Ω–¥—ñ—Ä—É –∞—Ä“õ—ã–ª—ã –∂–∞–ª“ì–∞–Ω–¥—ã“ì—ã–Ω –¥”ô–ª–µ–ª–¥–µ—É–≥–µ –±–æ–ª–∞–¥—ã."
                    }
                ],
                choices: [
                    { id: "people", label: "–°–ø–∞—Å—Ç–∏ —Ö–∞–ª—ã“õ—Ç—ã: —Ñ–µ–π–∫—Ç—ñ —Ç–æ“õ—Ç–∞—Ç—ã–ø, –≤–∏–¥–µ–æ–Ω—ã“£ —Ç–∞—Ä–∞–ª—É—ã–Ω —à–µ–∫—Ç–µ—É" },
                    { id: "info", label: "–°–ø–∞—Å—Ç–∏ –∞“õ–ø–∞—Ä–∞—Ç—Ç—ã: –∫—Ä–∏—Ç–∏–∫–∞–ª—ã“õ –∂–∞“ì–¥–∞–π–¥–∞ —Ç–µ–∫—Å–µ—Ä—É “Ø—à—ñ–Ω —É–∞“õ—ã—Ç –±–µ—Ä—É" }
                ],
                correctChoice: "people",
                praise: "–í–∏–¥–µ–æ–Ω—ã —Ñ–µ–π–∫ –¥–µ–ø —Ç–æ“õ—Ç–∞—Ç—É ‚Äî –µ“£ –¥“±—Ä—ã—Å —à–µ—à—ñ–º."
            }
        ];
        const CASES_ALL = CASES_ALL_NEW; // –í –±—É–¥—É—â–µ–º –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –∫–µ–π—Å—ã —Å—é–¥–∞

        /** ========== RANDOM CASE SELECTION ========== */
        function shuffleArray(arr) {
            const copy = [...arr];
            for (let i = copy.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [copy[i], copy[j]] = [copy[j], copy[i]];
            }
            return copy;
        }

        function getRandomCases() {
            const shuffled = shuffleArray(CASES_ALL);
            return shuffled.slice(0, 4);
        }

        /** ======== –°–û–°–¢–û–Ø–ù–ò–ï –ò –õ–û–ì–ò–ö–ê ======== */
        let state = {
            idx: 0,
            rep: 0,
            answers: {} // { evIndex: true/false }, choiceId
        };

        const $ = sel => document.querySelector(sel);
        const $all = sel => document.querySelectorAll(sel);

        // ========== ONBOARDING STATE ==========
        let agentData = JSON.parse(localStorage.getItem("agentData") || "null");

        function hideAllSections() {
            ["splash", "onboard-welcome", "onboard-form", "onboard-consent", "start", "case", "end"].forEach(id => {
                const el = $(`#${id}`);
                if (el) el.style.display = "none";
            });
            hideDetective();
        }

        function toast(msg) {
            const t = $("#toast"); t.textContent = msg; t.classList.add("show");
            setTimeout(() => t.classList.remove("show"), 2300);
        }

        // ========== ONBOARDING FLOW ==========
        function showOnboardWelcome() {
            hideAllSections();
            $("#onboard-welcome").style.display = "block";
        }

        function showOnboardForm() {
            hideAllSections();
            $("#onboard-form").style.display = "block";
            // Reset form
            $("#agentForm").reset();
            updateFormValidation();
        }

        function showOnboardConsent() {
            hideAllSections();
            const form = document.getElementById("agentForm");
            const fd = new FormData(form);

            agentData = {
                callsign: document.getElementById("callsign").value || "–ê–≥–µ–Ω—Ç",
                gender: fd.get("gender") || "‚Äî",
                age: fd.get("age") || "‚Äî",
                region: fd.get("region") || "‚Äî",
            };

            // Update summary
            const genderLabels = { female: "–ñ–µ–Ω—Å–∫–∏–π", male: "–ú—É–∂—Å–∫–æ–π", nonbinary: "–ù–µ–±–∏–Ω–∞—Ä–Ω—ã–π", skip: "–ù–µ —É–∫–∞–∑–∞–Ω", other: document.getElementById("genderOther").value };
            const ageLabels = { "under18": "<18", "18-25": "18‚Äì25", "26-35": "26‚Äì35", "36-45": "36‚Äì45", "46plus": "46+" };
            const regionOptions = document.getElementById("region").options;
            const regionLabel = regionOptions[regionOptions.selectedIndex]?.textContent || "‚Äî";

            $("#summaryCallsign").textContent = agentData.callsign;
            $("#summaryGender").textContent = genderLabels[agentData.gender] || agentData.gender;
            $("#summaryAge").textContent = ageLabels[agentData.age] || agentData.age;
            $("#summaryRegion").textContent = regionLabel;

            // Reset consent checkboxes
            document.getElementById("consentData").checked = false;
            document.getElementById("consentAge").checked = false;
            updateConsentValidation();

            $("#onboard-consent").style.display = "block";
        }

        async function completeOnboarding() {
            // –î–æ–±–∞–≤–ª—è–µ–º timestamp
            agentData.completedAt = new Date().toISOString();
            
            console.log('–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∞–≥–µ–Ω—Ç–∞...', agentData);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Supabase
            const result = await saveAgentDataToSupabase(agentData);
            
            if (result.success) {
                console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –∞–≥–µ–Ω—Ç–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ Supabase, Agent ID:', result.id);
                const msg = t("onboardCompleteMsg", { callsign: agentData.callsign });
                toast(msg);
            } else {
                console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∞–≥–µ–Ω—Ç–∞:', result.error);
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–∞–∂–µ –µ—Å–ª–∏ Supabase –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (fallback –Ω–∞ localStorage)
                const msg = t("onboardCompleteMsg", { callsign: agentData.callsign });
                toast(msg);
            }
            
            hideAllSections();
            $("#start").style.display = "block";
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –∞–¥–º–∏–Ω–∞, –µ—Å–ª–∏ callsign —Å–æ–¥–µ—Ä–∂–∏—Ç "admin"
            const isAdmin = agentData.callsign && agentData.callsign.toLowerCase().includes('admin');
            $("#btnAdminAnalytics").style.display = isAdmin ? "inline-block" : "none";
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ —É—Ä–æ–≤–Ω—è –∞–≥–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞
            loadAgentDataFromSupabase().then(data => {
                if (data) {
                    console.log('–î–∞–Ω–Ω—ã–µ —É—Ä–æ–≤–Ω—è –∞–≥–µ–Ω—Ç–∞ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –ø–æ—Å–ª–µ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞');
                    updateLevelDisplay();
                }
            });
            
            updateHeader();
        }

        function updateFormValidation() {
            const callsign = document.getElementById("callsign").value.trim();
            const gender = [...document.querySelectorAll('input[name="gender"]')].some(r => r.checked);
            const age = [...document.querySelectorAll('input[name="age"]')].some(r => r.checked);
            const region = document.getElementById("region").value;

            const isValid = callsign && gender && age && region;
            document.getElementById("btnFormNext").disabled = !isValid;
        }

        function updateConsentValidation() {
            const data = document.getElementById("consentData").checked;
            const age = document.getElementById("consentAge").checked;
            document.getElementById("btnActivate").disabled = !(data && age);
        }

        function showInfoModal() {
            document.getElementById("infoModal").style.display = "block";
        }

        function closeInfoModal() {
            document.getElementById("infoModal").style.display = "none";
        }

        // ========== GENDER "OTHER" FIELD ==========
        document.addEventListener("DOMContentLoaded", () => {
            // Language setup
            $("#langToggle").value = getLang();
            $("#langToggle").addEventListener("change", e => {
                setLang(e.target.value);
                updateI18nUI();
            });
            updateI18nUI();

            // Form gender handling
            const genderOther = document.getElementById("genderOther");
            document.querySelectorAll('input[name="gender"]').forEach(radio => {
                radio.addEventListener("change", () => {
                    if (radio.value === "other") {
                        genderOther.style.display = "block";
                        genderOther.focus();
                    } else {
                        genderOther.style.display = "none";
                        genderOther.value = "";
                    }
                });
            });

            // Form listeners
            document.getElementById("callsign").addEventListener("input", updateFormValidation);
            document.getElementById("region").addEventListener("change", updateFormValidation);
            document.querySelectorAll('input[name="gender"], input[name="age"]').forEach(el => {
                el.addEventListener("change", updateFormValidation);
            });

            // Consent listeners
            document.getElementById("consentData").addEventListener("change", updateConsentValidation);
            document.getElementById("consentAge").addEventListener("change", updateConsentValidation);

            // Modal listeners
            document.getElementById("btnMoreInfo").addEventListener("click", showInfoModal);
            document.getElementById("btnCloseModal").addEventListener("click", closeInfoModal);
            document.getElementById("btnCloseInfo").addEventListener("click", closeInfoModal);

            // Onboarding button listeners
            document.getElementById("btnOnboard").addEventListener("click", showOnboardWelcome);
            document.getElementById("btnFormStart").addEventListener("click", showOnboardForm);
            document.getElementById("btnFormBack").addEventListener("click", showOnboardWelcome);
            document.getElementById("btnFormNext").addEventListener("click", showOnboardConsent);
            document.getElementById("btnConsentBack").addEventListener("click", showOnboardForm);
            document.getElementById("btnActivate").addEventListener("click", completeOnboarding);

            // Close modal on background click
            document.getElementById("infoModal").addEventListener("click", (e) => {
                if (e.target.id === "infoModal") closeInfoModal();
            });

            // Game buttons
            $("#btnStart").addEventListener("click", async () => {
                // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å–µ—Å—Å–∏—é
                localStorage.removeItem("gameSessionId");
                
                const activeCases = getRandomCases();
                state = { 
                    idx: 0, 
                    rep: 0, 
                    answers: { ev: [], choice: null }, 
                    cases: activeCases,
                    startedAt: new Date().toISOString()
                };
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—á–∞–ª–æ –∏–≥—Ä–æ–≤–æ–π —Å–µ—Å—Å–∏–∏ –≤ Supabase
                console.log('–ù–∞—á–∞–ª–æ –Ω–æ–≤–æ–π –∏–≥—Ä—ã, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏...');
                const sessionResult = await saveGameSessionToSupabase(state);
                if (sessionResult.success) {
                    console.log('–ò–≥—Ä–æ–≤–∞—è —Å–µ—Å—Å–∏—è —Å–æ–∑–¥–∞–Ω–∞:', sessionResult.sessionId);
                } else {
                    console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∏–≥—Ä–æ–≤–æ–π —Å–µ—Å—Å–∏–∏:', sessionResult.error);
                }
                
                updateHeader();
                $("#start").style.display = "none";
                $("#case").style.display = "grid";
                renderCase();
            });

            $("#btnHow").addEventListener("click", () => {
                toast(t("toastHow"));
            });

            // Admin analytics button
            $("#btnAdminAnalytics").addEventListener("click", () => {
                showAdminAnalytics();
            });

            // Close admin modal
            $("#btnCloseAdminModal").addEventListener("click", () => {
                $("#adminModal").style.display = "none";
            });

            // Close admin modal on background click
            $("#adminModal").addEventListener("click", (e) => {
                if (e.target.id === "adminModal") {
                    $("#adminModal").style.display = "none";
                }
            });

            $("#evList").addEventListener("click", onEvidenceClick);
            $("#choiceBox").addEventListener("change", onChoiceChange);
            $("#btnCheck").addEventListener("click", checkCase);
            $("#btnSkip").addEventListener("click", () => { toast(t("toastSkipped")); nextCase(); });
            $("#btnRestart").addEventListener("click", restart);
            $("#btnShare").addEventListener("click", shareResult);
        });

        function updateHeader() {
            $("#rep").textContent = t("rep", { rep: state.rep });
            const totalCases = state.cases?.length || CASES_ALL.length;
            $("#caseNo").textContent = t("caseNo", { current: state.idx + 1, total: totalCases });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è
            updateLevelDisplay();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è –≤ header
        function updateLevelDisplay() {
            const levelBadge = $("#levelBadge");
            if (!levelBadge) return;

            // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —É—Ä–æ–≤–Ω—è –∏–∑ localStorage –∏–ª–∏ Supabase
            const levelDataStr = localStorage.getItem("agentLevelData");
            let levelData = null;
            
            if (levelDataStr) {
                try {
                    levelData = JSON.parse(levelDataStr);
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ agentLevelData:', e);
                }
            }

            // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç, –Ω–æ –µ—Å—Ç—å agentId, –∑–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ Supabase
            if (!levelData && supabase) {
                loadAgentDataFromSupabase().then(data => {
                    if (data) {
                        displayLevel(data);
                    }
                });
                return;
            }

            if (levelData) {
                displayLevel(levelData);
            } else {
                levelBadge.style.display = "none";
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –≤ badge
        function displayLevel(levelData) {
            const levelBadge = $("#levelBadge");
            if (!levelBadge || !levelData) return;

            const lang = getLang();
            const levelTitle = lang === "kk" 
                ? (levelData.level_title_kz || levelData.level_title_ru || "")
                : (levelData.level_title_ru || "");
            
            if (levelTitle && levelData.current_level) {
                levelBadge.textContent = `${levelData.current_level} ‚≠ê ${levelTitle}`;
                levelBadge.style.display = "block";
            } else {
                levelBadge.style.display = "none";
            }
        }

        // ========== –î–ï–¢–ï–ö–¢–ò–í ==========
        function showDetective() {
            const container = $("#detectiveContainer");
            if (container) {
                container.style.display = "block";
            }
        }

        function hideDetective() {
            const container = $("#detectiveContainer");
            if (container) {
                container.style.display = "none";
            }
        }

        function detectiveReact(type, text = null) {
            const avatar = $("#detectiveAvatar");
            const speech = $("#detectiveSpeech");
            const speechText = $("#detectiveText");
            const svg = $("#detectiveSvg");
            const eye1 = $("#detectiveEye1");
            const eye2 = $("#detectiveEye2");
            const pupil1 = $("#detectivePupil1");
            const pupil2 = $("#detectivePupil2");
            const brow1 = $("#detectiveBrow1");
            const brow2 = $("#detectiveBrow2");
            const mouth = $("#detectiveMouth");
            const tablet = $("#detectiveTablet");
            
            if (!avatar || !svg) return;

            // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∫–ª–∞—Å—Å—ã
            avatar.classList.remove("detective-positive", "detective-negative", "detective-thinking");
            tablet.classList.remove("tablet-scanning", "tablet-glow");

            const lang = getLang();
            let message = text;

            switch(type) {
                case "positive":
                    avatar.classList.add("detective-positive");
                    tablet.classList.add("tablet-glow");
                    // –£–ª—ã–±–∫–∞
                    if (mouth) mouth.setAttribute("d", "M 92 89 Q 100 93 108 89");
                    // –ü–æ–¥–Ω—è—Ç—ã–µ –±—Ä–æ–≤–∏
                    if (brow1) brow1.setAttribute("d", "M 85 67 Q 90 65 95 67");
                    if (brow2) brow2.setAttribute("d", "M 105 67 Q 110 65 115 67");
                    // –ì–ª–∞–∑–∞ —à–∏—Ä–µ (—Ä–∞–¥–æ—Å—Ç—å)
                    if (eye1) eye1.setAttribute("ry", "7");
                    if (eye2) eye2.setAttribute("ry", "7");
                    // –ó–µ–ª–µ–Ω—ã–π –ø–ª–∞–Ω—à–µ—Ç
                    if (tablet) {
                        tablet.setAttribute("fill", "#2b4");
                        tablet.setAttribute("stroke", "#4d8");
                    }
                    if (!message) {
                        message = lang === "kk" 
                            ? "–ö–µ—Ä–µ–º–µ—Ç –∂“±–º—ã—Å! –°–µ–Ω –Ω–µ–≥—ñ–∑–≥—ñ –Ω“Ø–∫—Ç–µ–Ω—ñ –±–∞–π“õ–∞–¥—ã“£."
                            : "–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞! –¢—ã –∑–∞–º–µ—Ç–∏–ª –≥–ª–∞–≤–Ω–æ–µ.";
                    }
                    break;
                case "negative":
                    avatar.classList.add("detective-negative");
                    // –ì—Ä—É—Å—Ç–Ω–æ–µ –ª–∏—Ü–æ
                    if (mouth) mouth.setAttribute("d", "M 92 90 Q 100 87 108 90");
                    // –û–ø—É—â–µ–Ω–Ω—ã–µ –±—Ä–æ–≤–∏
                    if (brow1) brow1.setAttribute("d", "M 85 70 Q 90 72 95 70");
                    if (brow2) brow2.setAttribute("d", "M 105 70 Q 110 72 115 70");
                    // –ì–ª–∞–∑–∞ —É–∂–µ (—Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω–∏–µ)
                    if (eye1) eye1.setAttribute("ry", "4");
                    if (eye2) eye2.setAttribute("ry", "4");
                    // –ó—Ä–∞—á–∫–∏ –≤–Ω–∏–∑
                    if (pupil1) pupil1.setAttribute("cy", "78");
                    if (pupil2) pupil2.setAttribute("cy", "78");
                    // –ö—Ä–∞—Å–Ω—ã–π –ø–ª–∞–Ω—à–µ—Ç
                    if (tablet) {
                        tablet.setAttribute("fill", "#b33");
                        tablet.setAttribute("stroke", "#d55");
                    }
                    if (!message) {
                        message = lang === "kk"
                            ? "–°”ô–ª “õ–∞—Ç–µ–ª–µ—Å—Ç—ñ“£. –ë“±–Ω—ã —Ç–æ–ª—ã“ì—ã—Ä–∞“õ “õ–∞—Ä–∞—Å—Ç—ã—Ä–∞–π—ã“õ."
                            : "–ù–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–∞—Ö–Ω—É–ª—Å—è. –î–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä—ë–º —ç—Ç–æ –ø–æ–¥—Ä–æ–±–Ω–µ–µ.";
                    }
                    break;
                case "thinking":
                    avatar.classList.add("detective-thinking");
                    tablet.classList.add("tablet-scanning");
                    // –ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ–µ –ª–∏—Ü–æ —Å –ª–µ–≥–∫–∏–º –Ω–∞–∫–ª–æ–Ω–æ–º
                    if (mouth) mouth.setAttribute("d", "M 92 88 Q 100 90 108 88");
                    // –ë—Ä–æ–≤–∏ —Å–≤–µ–¥–µ–Ω—ã
                    if (brow1) brow1.setAttribute("d", "M 85 68 Q 90 66 95 68");
                    if (brow2) brow2.setAttribute("d", "M 105 68 Q 110 66 115 68");
                    // –ó—Ä–∞—á–∫–∏ –≤ —Å—Ç–æ—Ä–æ–Ω—É (–¥—É–º–∞–µ—Ç)
                    if (pupil1) pupil1.setAttribute("cx", "88");
                    if (pupil2) pupil2.setAttribute("cx", "112");
                    // –ñ–µ–ª—Ç—ã–π –ø–ª–∞–Ω—à–µ—Ç
                    if (tablet) {
                        tablet.setAttribute("fill", "#ffc107");
                        tablet.setAttribute("stroke", "#ffd54f");
                    }
                    if (!message) {
                        message = lang === "kk"
                            ? "“ö—ã–∑—ã“õ—Ç—ã –∫”©–∑“õ–∞—Ä–∞—Å. –§–∞–∫—Ç—ñ–ª–µ—Ä–¥—ñ —Ç–µ–∫—Å–µ—Ä–µ–π—ñ–∫."
                            : "–ò–Ω—Ç–µ—Ä–µ—Å–Ω–∞—è —Ç–æ—á–∫–∞ –∑—Ä–µ–Ω–∏—è. –î–∞–≤–∞–π –ø—Ä–æ–≤–µ—Ä–∏–º —Ñ–∞–∫—Ç—ã.";
                    }
                    break;
                case "transition":
                    tablet.classList.add("tablet-scanning", "tablet-glow");
                    // –£–ª—ã–±–∫–∞
                    if (mouth) mouth.setAttribute("d", "M 92 89 Q 100 92 108 89");
                    if (tablet) {
                        tablet.setAttribute("fill", "#53e2ae");
                        tablet.setAttribute("stroke", "#7aa9ff");
                    }
                    if (!message) {
                        message = lang === "kk"
                            ? "–ñ–∞“õ—Å—ã. –ö–µ–ª–µ—Å—ñ —ñ—Å–∫–µ –∫”©—à–µ–π—ñ–∫."
                            : "–û—Ç–ª–∏—á–Ω–æ. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –∫–µ–π—Å—É.";
                    }
                    break;
                case "quick":
                    avatar.classList.add("detective-positive");
                    // –£–¥–∏–≤–ª–µ–Ω–Ω—ã–µ –≥–ª–∞–∑–∞
                    if (eye1) eye1.setAttribute("ry", "8");
                    if (eye2) eye2.setAttribute("ry", "8");
                    // –ü–æ–¥–Ω—è—Ç—ã–µ –±—Ä–æ–≤–∏
                    if (brow1) brow1.setAttribute("d", "M 85 66 Q 90 64 95 66");
                    if (brow2) brow2.setAttribute("d", "M 105 66 Q 110 64 115 66");
                    if (!message) {
                        message = lang === "kk"
                            ? "–ñ—ã–ª–¥–∞–º —Ä–µ–∞–∫—Ü–∏—è! –ë“±–ª –∂–∞“õ—Å—ã."
                            : "–ë—ã—Å—Ç—Ä–æ —Ä–µ–∞–≥–∏—Ä—É–µ—à—å! –≠—Ç–æ —Ö–æ—Ä–æ—à–æ.";
                    }
                    break;
                case "series":
                    avatar.classList.add("detective-positive");
                    tablet.classList.add("tablet-glow");
                    // –®–∏—Ä–æ–∫–∞—è —É–ª—ã–±–∫–∞
                    if (mouth) mouth.setAttribute("d", "M 90 89 Q 100 94 110 89");
                    // –ü–æ–¥–Ω—è—Ç—ã–µ –±—Ä–æ–≤–∏
                    if (brow1) brow1.setAttribute("d", "M 85 67 Q 90 65 95 67");
                    if (brow2) brow2.setAttribute("d", "M 105 67 Q 110 65 115 67");
                    // –®–∏—Ä–æ–∫–∏–µ –≥–ª–∞–∑–∞
                    if (eye1) eye1.setAttribute("ry", "7");
                    if (eye2) eye2.setAttribute("ry", "7");
                    if (tablet) {
                        tablet.setAttribute("fill", "#53e2ae");
                        tablet.setAttribute("stroke", "#7aa9ff");
                    }
                    if (!message) {
                        message = lang === "kk"
                            ? "–°–µ–Ω —Ç–∞–º–∞—à–∞ –¥–µ“£–≥–µ–π–¥–µ—Å—ñ“£! –û—Å—ã–ª–∞–π –∂–∞–ª“ì–∞—Å—Ç—ã—Ä."
                            : "–¢—ã –Ω–∞ –æ—Ç–ª–∏—á–Ω–æ–º —É—Ä–æ–≤–Ω–µ! –ü—Ä–æ–¥–æ–ª–∂–∞–π –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ.";
                    }
                    break;
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–ø–ª–∏–∫—É
            if (speech && speechText && message) {
                speechText.textContent = message;
                speech.style.display = "block";
                setTimeout(() => {
                    if (speech) speech.style.display = "none";
                }, 3000);
            }

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è
            setTimeout(() => {
                if (avatar) {
                    avatar.classList.remove("detective-positive", "detective-negative", "detective-thinking");
                }
                if (tablet) {
                    tablet.classList.remove("tablet-scanning", "tablet-glow");
                    tablet.setAttribute("fill", "#0a0f1a");
                    tablet.setAttribute("stroke", "#53e2ae");
                }
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ª–∏—Ü–æ –≤ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                if (mouth) mouth.setAttribute("d", "M 92 88 Q 100 91 108 88");
                if (brow1) brow1.setAttribute("d", "M 85 68 Q 90 66 95 68");
                if (brow2) brow2.setAttribute("d", "M 105 68 Q 110 66 115 68");
                if (eye1) eye1.setAttribute("ry", "6");
                if (eye2) eye2.setAttribute("ry", "6");
                if (pupil1) {
                    pupil1.setAttribute("cx", "90");
                    pupil1.setAttribute("cy", "76");
                }
                if (pupil2) {
                    pupil2.setAttribute("cx", "110");
                    pupil2.setAttribute("cy", "76");
                }
            }, 2000);
        }

        async function showCaseTransition() {
            const transition = document.createElement("div");
            transition.className = "case-transition";
            transition.id = "caseTransition";
            
            const lang = getLang();
            const text = lang === "kk" ? "–ö–µ–ª–µ—Å—ñ —ñ—Å–∫–µ –∫”©—à—É..." : "–ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –¥–µ–ª—É...";
            
            transition.innerHTML = `
                <div class="transition-detective">
                    <svg viewBox="0 0 200 300" xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;">
                        <circle cx="100" cy="80" r="35" fill="#d4a574"/>
                        <rect x="70" y="115" width="60" height="80" rx="5" fill="#1a1f3a"/>
                        <rect x="75" y="120" width="50" height="75" rx="3" fill="#e8e8e8"/>
                        <rect x="85" y="130" width="30" height="40" rx="3" fill="#0a0f1a" stroke="#53e2ae" stroke-width="2" opacity="0.9">
                            <animate attributeName="opacity" values="0.5;1;0.5" dur="1s" repeatCount="indefinite"/>
                        </rect>
                        <line x1="100" y1="140" x2="100" y2="160" stroke="#53e2ae" stroke-width="2">
                            <animate attributeName="opacity" values="0;1;0" dur="1.5s" repeatCount="indefinite"/>
                        </line>
                        <line x1="90" y1="150" x2="110" y2="150" stroke="#53e2ae" stroke-width="2">
                            <animate attributeName="opacity" values="0;1;0" dur="1.5s" repeatCount="indefinite" begin="0.5s"/>
                        </line>
                    </svg>
                </div>
                <div class="transition-text">${text}</div>
            `;
            
            document.body.appendChild(transition);
            
            // –ê–Ω–∏–º–∞—Ü–∏—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            transition.remove();
        }

        function renderCase() {
            const c = state.cases[state.idx];
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ—Ç–µ–∫—Ç–∏–≤–∞ –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–µ –∫–µ–π—Å–∞
            showDetective();
            $("#caseTag").textContent = c.tag;
            $("#caseDifficulty").textContent = c.difficulty;
            $("#caseTitle").textContent = c.title;
            $("#caseNarrative").textContent = c.narrative;

            // Evidence list
            const evBox = $("#evList"); evBox.innerHTML = "";
            // –í—Å–µ–≥–¥–∞ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –¥–ª—è –Ω–æ–≤–æ–≥–æ –∫–µ–π—Å–∞
            state.answers = { ev: Array(c.evidence.length).fill(null), choice: null };

            c.evidence.forEach((ev, i) => {
                const hasAnswer = false; // –í—Å–µ–≥–¥–∞ false –¥–ª—è –Ω–æ–≤–æ–≥–æ –∫–µ–π—Å–∞
                const isTruth = false;
                const isLie = false;
                
                const card = document.createElement("div");
                card.className = "card";
                card.innerHTML = `
      <div class="meta"><span class="tag">${t("evidence")} #${i + 1}</span></div>
      <div class="text">${ev.text}</div>
      <div class="controls">
        <button class="truth" data-kind="truth" data-i="${i}" ${hasAnswer ? 'disabled' : ''} ${isTruth ? 'style="outline:2px solid #88c; filter:brightness(1.1); opacity:1"' : ''}>${t("truthBtn")}</button>
        <button class="lie" data-kind="lie" data-i="${i}" ${hasAnswer ? 'disabled' : ''} ${isLie ? 'style="outline:2px solid #88c; filter:brightness(1.1); opacity:1"' : ''}>${t("lieBtn")}</button>
        <button class="ghost" data-kind="hint" data-i="${i}">${t("hintBtn")}</button>
      </div>
    `;
                evBox.appendChild(card);
            });

            // Choices - —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä
            const choiceBox = $("#choiceBox"); choiceBox.innerHTML = "";
            c.choices.forEach((opt) => {
                const row = document.createElement("label");
                row.className = "opt";
                row.innerHTML = `
      <input type="radio" name="who" value="${opt.id}">
      <div><div style="font-weight:700; margin-bottom:4px">${opt.label}</div>
      <div style="color:var(--muted); font-size:13px">${t("choiceReputation")}</div></div>
    `;
                choiceBox.appendChild(row);
            });

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä —Ä–µ—à–µ–Ω–∏—è
            state.answers.choice = null;
            
            // –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Å–µ–≥–¥–∞ disabled –ø—Ä–∏ –Ω–∞—á–∞–ª–µ –Ω–æ–≤–æ–≥–æ –∫–µ–π—Å–∞
            $("#btnCheck").disabled = true;
            updateEvScore();
            updateHeader();
        }

        function updateEvScore() {
            const c = state.cases[state.idx];
            const done = state.answers.ev.filter(v => v !== null).length;
            $("#evScore").textContent = t("evScore", { done, total: c.evidence.length });
            maybeEnableCheck();
        }

        function maybeEnableCheck() {
            const c = state.cases[state.idx];
            const allEv = state.answers.ev.every(v => v !== null);
            const hasChoice = !!state.answers.choice;
            $("#btnCheck").disabled = !(allEv && hasChoice);
        }

        let lastClickTime = 0;
        let correctStreak = 0;

        function onEvidenceClick(e) {
            const btn = e.target.closest("button");
            if (!btn) return;
            const i = Number(btn.dataset.i);
            const kind = btn.dataset.kind;

            if (kind === "hint") {
                toast(state.cases[state.idx].evidence[i].hint || t("toastHintUnavailable"));
                detectiveReact("thinking", getLang() === "kk"
                    ? "–ö–µ“£–µ—Å –ø–∞–π–¥–∞–ª—ã –±–æ–ª–¥—ã –º–∞?"
                    : "–ü–æ–¥—Å–∫–∞–∑–∫–∞ –ø–æ–º–æ–≥–ª–∞?");
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–µ–∞–∫—Ü–∏–∏
            const now = Date.now();
            const timeSinceLastClick = now - lastClickTime;
            lastClickTime = now;
            
            // truth/lie
            const isCorrect = state.cases[state.idx].evidence[i].isTruth === (kind === "truth");
            state.answers.ev[i] = (kind === "truth");
            
            // –†–µ–∞–∫—Ü–∏—è –¥–µ—Ç–µ–∫—Ç–∏–≤–∞ –Ω–∞ –æ—Ç–≤–µ—Ç
            if (timeSinceLastClick < 500 && timeSinceLastClick > 0) {
                detectiveReact("quick");
            } else if (isCorrect) {
                correctStreak += 1;
                if (correctStreak >= 3) {
                    detectiveReact("series");
                    correctStreak = 0;
                } else {
                    detectiveReact("positive");
                }
            } else {
                correctStreak = 0;
                detectiveReact("negative");
            }
            
            // –≤–∏–∑—É–∞–ª –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è: –≤—ã–¥–µ–ª–∏–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
            const card = btn.parentElement;
            const allButtons = card.querySelectorAll("button.truth,button.lie");
            [...allButtons].forEach(b => {
                b.style.outline = "";
                b.style.filter = "";
                b.style.opacity = ".8";
                // –û—Ç–∫–ª—é—á–∞–µ–º –≤—Å–µ –∫–Ω–æ–ø–∫–∏ –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞
                b.disabled = true;
            });
            btn.style.outline = "2px solid #88c";
            btn.style.filter = "brightness(1.1)";
            btn.style.opacity = "1";
            updateEvScore();
        }

        function onChoiceChange(e) {
            if (e.target && e.target.name === "who") {
                state.answers.choice = e.target.value;
                // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏—Ö —Ä–∞–¥–∏–æ–∫–Ω–æ–ø–æ–∫
                document.querySelectorAll('input[name="who"]').forEach(radio => {
                    if (radio !== e.target) {
                        radio.checked = false;
                    }
                });
                maybeEnableCheck();
            }
        }

        async function checkCase() {
            const c = state.cases[state.idx];
            let points = 0;
            let correctEvidence = 0;
            
            // –∑–∞ –∫–∞–∂–¥–æ–µ –≤–µ—Ä–Ω–æ–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ +1
            c.evidence.forEach((ev, i) => {
                if (state.answers.ev[i] === ev.isTruth) {
                    points += 1;
                    correctEvidence += 1;
                }
            });
            // –∑–∞ –≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä +2
            const correctChoice = state.answers.choice === c.correctChoice;
            if (correctChoice) points += 2;

            // –†–µ–∞–∫—Ü–∏—è –¥–µ—Ç–µ–∫—Ç–∏–≤–∞
            const totalEvidence = c.evidence.length;
            const evidenceRatio = correctEvidence / totalEvidence;
            
            if (correctChoice && evidenceRatio >= 0.8) {
                // –û—Ç–ª–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                detectiveReact("positive");
            } else if (correctChoice && evidenceRatio >= 0.5) {
                // –•–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                detectiveReact("positive", getLang() === "kk" 
                    ? "–ñ–∞“õ—Å—ã –∂“±–º—ã—Å! –î“±—Ä—ã—Å –±–∞“ì—ã—Ç—Ç–∞—Å—ã“£."
                    : "–•–æ—Ä–æ—à–∞—è —Ä–∞–±–æ—Ç–∞! –ò–¥—ë—à—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏.");
            } else if (!correctChoice && evidenceRatio < 0.5) {
                // –ü–ª–æ—Ö–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                detectiveReact("negative");
            } else {
                // –°–º–µ—à–∞–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                detectiveReact("thinking", getLang() === "kk"
                    ? "–ö–µ–π–±—ñ—Ä –Ω“Ø–∫—Ç–µ–ª–µ—Ä –¥“±—Ä—ã—Å, –±—ñ—Ä–∞“õ “õ–æ—Å—ã–º—à–∞ —Ç–µ–∫—Å–µ—Ä—É “õ–∞–∂–µ—Ç."
                    : "–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –º–æ–º–µ–Ω—Ç—ã –≤–µ—Ä–Ω—ã, –Ω–æ –Ω—É–∂–Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞.");
            }

            state.rep += points;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–≤–µ—Ç –Ω–∞ –¥–µ–ª–æ –≤ Supabase
            const caseAnswerData = {
                tag: c.tag,
                title: c.title,
                difficulty: c.difficulty,
                evidenceAnswers: state.answers.ev,
                choice: state.answers.choice,
                correctChoice: c.correctChoice,
                points: points
            };
            await saveCaseAnswerToSupabase(caseAnswerData);
            
            toast(t("toastCaseClosed", { points }));
            
            // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º
            await new Promise(resolve => setTimeout(resolve, 1500));
            nextCase();
        }

        async function nextCase() {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–µ—Ö–æ–¥ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π –¥–µ—Ç–µ–∫—Ç–∏–≤–∞
            if (state.idx < state.cases.length - 1) {
                detectiveReact("transition");
                await showCaseTransition();
            }
            
            state.idx += 1;
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–µ—Å—Å–∏—é –≤ Supabase –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –¥–µ–ª—É
            if (state.idx < state.cases.length) {
                await saveGameSessionToSupabase(state);
            }
            
            if (state.idx >= state.cases.length) {
                hideDetective();
                await endGame();
            } else {
                renderCase();
            }
        }

        async function endGame() {
            $("#case").style.display = "none";
            $("#end").style.display = "grid";
            updateHeader();

            const maxRep = state.cases.reduce((acc, c) => acc + c.evidence.length + 2, 0);
            const ratio = state.rep / maxRep;

            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —É—Ä–æ–≤–µ–Ω—å –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Ä–µ–ø—É—Ç–∞—Ü–∏–∏ —ç—Ç–æ–π –∏–≥—Ä—ã
            const currentGameLevel = calculateLevel(state.rep);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–≥—Ä—ã –≤ Supabase
            const gameResultData = {
                rep: state.rep,
                totalCases: state.cases.length,
                maxRep: maxRep,
                ratio: ratio,
                rank: currentGameLevel.title_ru // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–∏—Ç—É–ª —É—Ä–æ–≤–Ω—è –∫–∞–∫ rank
            };
            const saveResult = await saveGameResultToSupabase(gameResultData);
            
            // –ü–æ–ª—É—á–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∞–≥–µ–Ω—Ç–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ–±—â–µ–≥–æ —É—Ä–æ–≤–Ω—è
            let totalLevelInfo = currentGameLevel;
            if (saveResult && saveResult.levelInfo) {
                // –ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∞–≥–µ–Ω—Ç–∞
                const agentData = await loadAgentDataFromSupabase();
                if (agentData) {
                    totalLevelInfo = calculateLevel(agentData.total_reputation || state.rep);
                }
            }

            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —É—Ä–æ–≤–µ–Ω—å –∏ –ø–æ—Ö–≤–∞–ª—É
            const lang = getLang();
            const levelTitle = lang === "kk" ? totalLevelInfo.title_kz : totalLevelInfo.title_ru;
            const praise = lang === "kk" ? totalLevelInfo.praise_kz : totalLevelInfo.praise_ru;

            $("#rank").textContent = `${totalLevelInfo.level} ‚≠ê ${levelTitle}`;
            $("#endTitle").textContent = t("endTitle");
            $("#endText").textContent = `${t("endResult")}: ${state.rep} –±–∞–ª–ª–æ–≤.\n\n${praise}`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –≤ header
            updateLevelDisplay();
        }

        function shareResult() {
            const text = getLang() === "kk"
                ? `–ú–µ–Ω Digital Truth –æ–π—ã–Ω—ã–Ω ”©—Ç—ñ–ø, ${state.rep} —Ä–µ–ø—É—Ç–∞—Ü–∏—è –∂–∏–Ω–∞–¥—ã–º! #–®—ã–Ω–¥—ã“õ—Ç—ã“ö“±—Ç“õ–∞—Ä`
                : `–Ø –ø—Ä–æ—à—ë–ª Digital Truth –∏ –ø–æ–ª—É—á–∏–ª —Ä–µ–ø—É—Ç–∞—Ü–∏—é ${state.rep}! #–°–ø–∞—Å–∏–ü—Ä–∞–≤–¥—É`;
            navigator.clipboard.writeText(text).then(() => toast(t("toastCopied")));
        }

        function restart() {
            // –û—á–∏—â–∞–µ–º —Å–µ—Å—Å–∏—é –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ
            localStorage.removeItem("gameSessionId");
            correctStreak = 0;
            lastClickTime = 0;
            state = { idx: 0, rep: 0, answers: { ev: [], choice: null } };
            hideDetective();
            $("#end").style.display = "none";
            $("#start").style.display = "block";
            updateHeader();
        }


        // ========== INTRO VIDEO ==========
        function initIntroVideo() {
            const introVideo = document.getElementById("introVideo");
            const playBtn = document.getElementById("videoPlayBtn");

            if (introVideo && playBtn) {
                introVideo.currentTime = 0;
                introVideo.style.display = "block";
                playBtn.style.display = "flex";

                function startVideo() {
                    introVideo.play();
                    playBtn.style.display = "none";
                }

                playBtn.addEventListener("click", startVideo);

                introVideo.addEventListener("ended", () => {
                    introVideo.style.display = "none";
                    playBtn.style.display = "none";
                    showOnboardWelcome();
                }, { once: true });

                // Try autoplay
                introVideo.play().catch(() => {
                    // Autoplay failed, user must click
                });
            }
        }

        // ========== INIT ==========
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ localStorage –∏ –ø–æ–∫–∞–∑–∞ —Ñ–æ—Ä–º—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        function clearStorageAndShowOnboarding() {
            console.log('–û—á–∏—Å—Ç–∫–∞ localStorage –∏ –ø–æ–∫–∞–∑ —Ñ–æ—Ä–º—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏');
            localStorage.removeItem("agentData");
            localStorage.removeItem("agentId");
            localStorage.removeItem("agentLevelData");
            localStorage.removeItem("gameSessionId");
            agentData = null;
            hideAllSections();
            $("#splash").style.display = "block";
            initIntroVideo();
        }

        // –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∞–≥–µ–Ω—Ç–∞
        (async function initApp() {
            // Show onboarding if not completed
            if (!agentData || !agentData.completedAt) {
                hideAllSections();
                $("#splash").style.display = "block";
                initIntroVideo();
            } else {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞ –≤ Supabase
                const agentId = localStorage.getItem("agentId");
                if (agentId && supabase) {
                    const agentExists = await checkAgentExistsInSupabase(agentId);
                    if (!agentExists) {
                        console.warn('–ê–≥–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ Supabase, –æ—á–∏—â–∞–µ–º localStorage');
                        clearStorageAndShowOnboarding();
                        updateHeader();
                        updateI18nUI();
                        return;
                    }
                }

                hideAllSections();
                $("#start").style.display = "block";
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –∞–¥–º–∏–Ω–∞, –µ—Å–ª–∏ callsign —Å–æ–¥–µ—Ä–∂–∏—Ç "admin"
                const isAdmin = agentData.callsign && agentData.callsign.toLowerCase().includes('admin');
                $("#btnAdminAnalytics").style.display = isAdmin ? "inline-block" : "none";
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ —É—Ä–æ–≤–Ω—è –∞–≥–µ–Ω—Ç–∞ –∏–∑ Supabase
                loadAgentDataFromSupabase().then(data => {
                    if (data) {
                        console.log('–î–∞–Ω–Ω—ã–µ —É—Ä–æ–≤–Ω—è –∞–≥–µ–Ω—Ç–∞ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏');
                        updateLevelDisplay();
                    }
                });
            }
            updateHeader();
            updateI18nUI();
        })();
    </script>
</body>

</html>